<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Challenge your performance intuition with C++ operators</title>
    <meta name="keywords" content="cpp,quiz,game,learning,c++">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
    <style>
body{
    margin: 0 0 0 0;
}

a{
    text-decoration: none;
}

h1 {
    padding-top: 32pt;
    font-size: 24pt;
    width: 600pt;
    text-align: left;
}

h2 {
    padding-top: 64pt;
    font-size: 20pt;
    width: 555pt;
    text-align: left;
}

p {
    font-size: 16pt;
    width: 505pt;
    text-align: left;
}

.comment {
    font-size: 14pt;
    text-align:center;
    font-family: sans-serif;
    padding-bottom: 24pt;
}

table.footer {
    padding: 64pt 0pt 32pt 0pt;
    background-color: transparent;
    width: 505pt;
}

td.footer {
    font-family: sans-serif;
    font-size: 16pt;
    font-style: normal;
    padding: 0;
    margin: 0;
    border: 0;
}

pre {
    margin: 0 0 0 0;
    padding-top: 12pt;
    padding-left: 12pt;
    padding-right: 12pt;
    padding-bottom: 12pt;
    font-size: 12pt;
    text-align: left;
    width: 360pt;
}

table {
    text-align: center;
    border-width: 0pt;
}

td {
    padding: 6pt 12pt 6pt 12pt;
    font-size: 16pt;
    border: 1px solid black;
}

button{
    width: 304pt;
    height: 42pt;
    margin-left:4pt;
    margin-right:4pt;
    font-size: 18pt;
}

    </style>
    <script language="JavaScript">
var slider_set = [false, false, false, false,  false, false, false, false,  false, false];
var slider_true_xs = [
    7.6 / (7.6 + 7.6) * 512,
    7.6 / (7.6 + 8.2) * 512,
    7.6 / (7.6 + 3.1) * 512,
    3.1 / (3.1 + 4.2) * 512,

    7.6 / (7.6 + 7.7) * 512,
    3.1 / (3.1 + 4.2) * 512,
    7.7 / (7.6 + 7.6) * 512,
    7.6 / (7.6 + 7.6) * 512
    ];
var slider_user_xs = [256, 256, 256, 256,  256, 256, 256, 256];
var slider_xs = [256, 256, 256, 256,  256, 256, 256, 256];

var slider_down = false;

function comment_on_slider(no){
    var left = document.getElementById("left_" + (no + 1));
    var right = document.getElementById("right_" + (no + 1));
    var x = slider_xs[no]
    var xl = x;
    var xr = 511 - x;
    if(x < 255){
        left.style.backgroundColor = "#" + (Math.round(xl)).toString(16) + "ff" + (Math.round(xl)).toString(16);
        right.style.backgroundColor = "#ff" + (Math.round(xl)).toString(16) + (Math.round(xl)).toString(16);
    }else{
        right.style.backgroundColor = "#" + (Math.round(xr)).toString(16) + "ff" + (Math.round(xr)).toString(16);
        left.style.backgroundColor = "#ff" + (Math.round(xr)).toString(16) + (Math.round(xr)).toString(16);
    }

    var comment = document.getElementById("comment_" + (no + 1));
    if(Math.abs(xl - xr) < 3){
        comment.innerHTML = "They are almost the same.";
    }else if(xl > xr){
        if(xl > 20*xr){
            comment.innerHTML = "Right is more than 20 times faster!";
        }else if(xl > 10*xr){
            comment.innerHTML = "Right is more than 10 times faster!";
        }else if(xl > 5*xr){
            comment.innerHTML = "Right is more than 5 times faster!";
        }else if(xl > 3*xr){
            comment.innerHTML = "Right is more than 3 times faster!";
        }else if(xl > 2*xr){
            comment.innerHTML = "Right is more than 2 times faster!";
        }else if(xl > 1.5*xr){
            comment.innerHTML = "Right is more than 50% faster.";
        }else if(xl > 1.25*xr){
            comment.innerHTML = "Right is more than 25% faster.";
        }else if(xl > 1.1*xr){
            comment.innerHTML = "Right is more than 10% faster.";
        }else{
            comment.innerHTML = "Right is slightly faster.";
        }
    }else if(xr > xl){
        if(xr > 20*xl){
            comment.innerHTML = "Left is more than 20 times faster!";
        }else if(xr > 10*xl){
            comment.innerHTML = "Left is more than 10 times faster!";
        }else if(xr > 5*xl){
            comment.innerHTML = "Left is more than 5 times faster!";
        }else if(xr > 3*xl){
            comment.innerHTML = "Left is more than 3 times faster!";
        }else if(xr > 2*xl){
            comment.innerHTML = "Left is more than 2 times faster!";
        }else if(xr > 1.5*xl){
            comment.innerHTML = "Left is more than 50% faster.";
        }else if(xr > 1.25*xl){
            comment.innerHTML = "Left is more than 25% faster.";
        }else if(xr > 1.1*xl){
            comment.innerHTML = "Left is more than 10% faster.";
        }else{
            comment.innerHTML = "Left is slightly faster.";
        }
    }
}

function position_slider(no, client_x){
    if(!slider_set[no]){
        var slider = document.getElementById("slider_" + (no + 1));
        var canvas_rect = slider.getBoundingClientRect();
        var x = client_x - canvas_rect.left - 48;
        if(x < 16)
            x = 16;
        if(x > 511 - 16)
            x = 511 - 16;
        slider_xs[no] = x;

        comment_on_slider(no);
    }
}

function init_slider(no){
    draw_slider(no);
    var slider = document.getElementById("slider_" + (no + 1));

    slider.addEventListener('mouseleave', function(e){
        slider_down = false;
    }, false);

    slider.addEventListener('mouseup', function(e){
        slider_down = false;
    }, false);

    slider.addEventListener('mousedown', function(e){
        slider_down = true;
        position_slider(no, e.clientX);
        draw_slider(no);
    }, false);

    slider.addEventListener('mousemove', function(e){
        if(slider_down){
            position_slider(no, e.clientX);
            draw_slider(no);
        }
    }, false);
}

function draw_slider(no){
    ctx = document.getElementById("slider_" + (no + 1)).getContext("2d");
    x = slider_xs[no] + 48 + 0.5;

    ctx.clearRect(0, 0, 608, 128);
    ctx.beginPath();
    ctx.moveTo(64.5-16, 32.5);
    ctx.lineTo(0.5 + 16, 127.5 - 32);
    ctx.lineTo(607.5 - 16, 127.5 - 32);
    ctx.lineTo(607.5 - 64 + 16, 32.5);
    ctx.lineTo(64.5-16, 32.5);
    ctx.strokeStyle="#000000";
    ctx.stroke();
    ctx.closePath();
    ctx.fillStyle="#999999";
    ctx.fill();

    if(slider_set[no]){
        x_red = slider_user_xs[no] + 48 + 0.5;
        ctx.beginPath();
        ctx.moveTo(x_red, 0);
        ctx.lineTo(x_red - 64, 127);
        ctx.lineTo(x_red + 64, 127);
        ctx.lineTo(x_red, 0);
        ctx.strokeStyle="#660000";
        ctx.stroke();
        ctx.closePath();
        ctx.fillStyle="#ffcccc";
        ctx.fill();
    }

    ctx.beginPath();
    ctx.moveTo(x, 0);
    ctx.lineTo(x - 64, 127);
    ctx.lineTo(x + 64, 127);
    ctx.lineTo(x, 0);
    ctx.strokeStyle="#000000";
    ctx.stroke();
    ctx.closePath();
    ctx.fillStyle="#cccccc";
    ctx.fill();
}

function reveal(no){
    slider_set[no] = true;
    slider_user_xs[no] = slider_xs[no];
    slider_xs[no] = slider_true_xs[no];
    draw_slider(no);
    comment_on_slider(no);
    document.getElementById("the_truth_" + (no + 1)).style.display = "block";
    document.getElementById("button_" + (no + 1)).style.display = "none";

    for(var i = 0; i < 8; i++){
        if(slider_set[i] == false)
            return;
    }

    document.getElementById("show_in_the_end").style.display = "block";
    var score = 0;
    var default_score = 0;
    for(var i = 0; i < 8; i++){
        score += Math.abs(slider_user_xs[i] - slider_xs[i]);
        default_score += Math.abs(256 - slider_xs[i]);
    }

    document.getElementById("score").innerHTML = "<b>" + score.toFixed(0) + "</b>";
    document.getElementById("default_score").innerHTML = "<b>" + default_score.toFixed(0) + "</b>";
}
    </script>
  </head>
  <body>
    <center>
    <h1>
Challenge your performance intuition with C++ operators
    </h1>
    <p>
I made a mistake one day. More of a typo really. I used “bitwise and” instead of “logical and” in the code. A colleague of mine noticed that during the review and said something like this. “You shouldn't use bitwise operators instead of logical ones, the latter do <a href="https://en.wikipedia.org/wiki/Short-circuit_evaluation">short-circuiting</a>.”
    </p>
    <p>
Yes. Both parts of that sentence are valid. You shouldn't use bitwise operators instead of logical ones. Logical operators in C++ perform short-circuit evaluation. That's true. But the invisible implication between the two parts is wrong.
    </p>
    <p>
Short-circuiting may be or may be not beneficial for the performance. It may be or may be not performed on bitwise operators too. And sometimes you're better off not doing logic the most logical way to begin with.
    </p>
    <p>
I want to propose a game. Let's measure things and see if we can predict the measurements before they come. We did <a href="https://wordsandbuttons.online/challenge_your_performance_intuition_with_cpp_magic_squares.html">a similar thing</a> last year, and that was fun, so why not?
    </p>
    <p>
So here is the benchmark example.
    </p>
    <table><tr>
    <td>
    <pre style="width: 505pt;">
#include &lt;chrono&gt;
#include &lt;iostream&gt;
#include &lt;random&gt;
#include &lt;array&gt;

int main() {
  using <b>TheType</b> = int;
  constexpr auto <b>TheSize</b> = 16 * 10000000;
  std::mt19937 rng(0);
  std::uniform_int_distribution&lt;<b>TheType</b>&gt; distribution(0, 1);
  std::vector&lt;<b>TheType</b>&gt; xs(<b>TheSize</b>);
  for (auto& digit : xs) {
    digit = distribution(rng);
  }

  volatile auto four_1_in_a_row = 0u;
  auto start = std::chrono::system_clock::now();
  <b>for (auto i = 0u; i &lt; TheSize - 3; ++i)
    if(xs[i] == 1 && xs[i+1] == 1 && xs[i+2] == 1 && xs[i+3] == 1)
      ++four_1_in_a_row;</b>
  auto end = std::chrono::system_clock::now();

  std::cout &lt;&lt; "time: " &lt;&lt; (end-start).count() * 1e-9
    &lt;&lt; "  1111s: " &lt;&lt; four_1_in_a_row &lt;&lt; "\n";
}</pre>
    </td></tr></table>
    <p>
I've made several variants of this code, compiled it with clang 3.8.0-2ubuntu4 -std=c++14 -O2, and measured their run time on Intel(R) Core(TM) i7-7700HQ CPU @ 2.80GHz.
    </p>
    <p>
Using your intuition and best judgment, please estimate their relative performance. Please use the slider below the code samples.
    </p>

    <h2>
Round 1. && vs &
    </h1>
    <p>
The main question. Is && generally more performant than &?
    </p>
    <table><tr>
    <td id="left_1">
    <pre>
  for (auto i = 0u; i &lt; TheSize - 3; ++i)
    if(xs[i] == 1
    && xs[i+1] == 1
    && xs[i+2] == 1
    && xs[i+3] == 1)
      ++four_1_in_a_row;
    </pre>
    </td>
    <td id="right_1">
    <pre>
  for (auto i = 0u; i &lt; TheSize - 3; ++i)
    if(xs[i] == 1
     & xs[i+1] == 1
     & xs[i+2] == 1
     & xs[i+3] == 1)
      ++four_1_in_a_row;
    </pre>
    </td></tr></table>
    <canvas id="slider_1" width=608 height=128></canvas>
    <p class="comment" id="comment_1">
They are almost the same.
    </p>
    <button type="button" onclick="reveal(0)" id="button_1">Reveal the truth</button>
    <div id="the_truth_1" style="display:none;">
    <p>
They are almost the same. In fact, they generate almost the same code.
    </p>
    <table><tr>
    <td>
    <pre>
  <span style="color: #3e312d">movq</span>  %<span style="color: #631f45">rax</span>, %<span style="color: #1c301d">r</span>14
  .<span style="color: #204104">align</span>  16, 0<span style="color: #390958">x</span>90
.<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>6:
<span style="color: #778877">  # =&gt;This Inner Loop Header: Depth=1</span>
  <span style="color: #025d32">cmpl</span>  <span style="color: #417802">$</span>1, -12(%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4)
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11
<span style="color: #778877"># BB#7:    #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #025d32">cmpl</span>  <span style="color: #417802">$</span>1, -8(%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4)
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11
<span style="color: #778877"># BB#8:    #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #025d32">cmpl</span>  <span style="color: #417802">$</span>1, -4(%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4)
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11
<span style="color: #778877"># BB#9:    #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #025d32">cmpl</span>  <span style="color: #417802">$</span>1, (%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4)
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11
<span style="color: #778877"># BB#10:   #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #140e66">incl</span>  4(%<span style="color: #104e13">rsp</span>)
  .<span style="color: #204104">align</span>  16, 0<span style="color: #390958">x</span>90
.<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11:  # %.<span style="color: #5e7876">_crit_edge</span>
<span style="color: #778877">           #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #4d357a">addq</span>  <span style="color: #417802">$</span>1, %<span style="color: #322920">rbx</span>
  <span style="color: #4b5540">cmpq</span>  <span style="color: #417802">$</span>160000000, %<span style="color: #322920">rbx</span>
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>6
    </pre>
    </td>
    <td>
    <pre>
  <span style="color: #3e312d">movq</span>  %<span style="color: #631f45">rax</span>, %<span style="color: #1c301d">r</span>14
  .<span style="color: #204104">align</span>  16, 0<span style="color: #390958">x</span>90
.<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>6:
<span style="color: #778877">  # =&gt;This Inner Loop Header: Depth=1</span>
  <span style="color: #025d32">cmpl</span>  <span style="color: #417802">$</span>1, -12(%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4)
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>10
<span style="color: #778877"># BB#7:    #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #025d32">cmpl</span>  <span style="color: #417802">$</span>1, -8(%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4)
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>10
<span style="color: #778877"># BB#8:    #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #025d32">cmpl</span>  <span style="color: #417802">$</span>1, -4(%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4)
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>10
<span style="color: #778877"># BB#9:    #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #025d32">cmpl</span>  <span style="color: #417802">$</span>1, (%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4)
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>10
<span style="color: #778877"># BB#20:   #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #140e66">incl</span>  4(%<span style="color: #104e13">rsp</span>)
.<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>10:  # %.<span style="color: #04175e">backedge</span>
<span style="color: #778877">           #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #4d357a">addq</span>  <span style="color: #417802">$</span>1, %<span style="color: #322920">rbx</span>
  <span style="color: #4b5540">cmpq</span>  <span style="color: #417802">$</span>160000000, %<span style="color: #322920">rbx</span>
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>6
    </pre>
    </td></tr></table>
    <p>
The trick is in the context. Since == generates only 0 or 1, the short-circuiting for 0 and & is still possible. 0 & anything is still 0. Although, the same trick <a href="https://godbolt.org/z/0eEz_G">doesn't work with |</a> anymore.
    </p>
    </div>
    <script language="JavaScript">
    init_slider(0);
    </script>

    <h2>
Round 2. & vs *
    </h1>
    <p>
“Logical and” can also be substituted with a multiplication operator. It has the same truth table on 0 and 1.
    </p>
    <table><tr>
    <td id="left_2">
    <pre>
  for (auto i = 0u; i &lt; TheSize - 3; ++i)
    if(xs[i] == 1
     & xs[i+1] == 1
     & xs[i+2] == 1
     & xs[i+3] == 1)
      ++four_1_in_a_row;
    </pre>
    </td>
    <td id="right_2">
    <pre>
  for (auto i = 0u; i &lt; TheSize - 3; ++i)
    if((xs[i] == 1)
     * (xs[i+1] == 1)
     * (xs[i+2] == 1)
     * (xs[i+3] == 1))
      ++four_1_in_a_row;
    </pre>
    </td></tr></table>
    <canvas id="slider_2" width=608 height=128></canvas>
    <p class="comment" id="comment_2">
They are almost the same.
    </p>
    <button type="button" onclick="reveal(1)" id="button_2">Reveal the truth</button>
    <div id="the_truth_2" style="display:none;">
    <p>
Surprisingly, they perform almost the same while their code is completely different.
    </p>
    <table><tr>
    <td>
    <pre>
  <span style="color: #3e312d">movq</span>  %<span style="color: #631f45">rax</span>, %<span style="color: #1c301d">r</span>14
  .<span style="color: #204104">align</span>  16, 0<span style="color: #390958">x</span>90
.<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>6:
<span style="color: #778877">  # =&gt;This Inner Loop Header: Depth=1</span>
  <span style="color: #025d32">cmpl</span>  <span style="color: #417802">$</span>1, -12(%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4)
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>10
<span style="color: #778877"># BB#7:    #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #025d32">cmpl</span>  <span style="color: #417802">$</span>1, -8(%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4)
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>10
<span style="color: #778877"># BB#8:    #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #025d32">cmpl</span>  <span style="color: #417802">$</span>1, -4(%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4)
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>10
<span style="color: #778877"># BB#9:    #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #025d32">cmpl</span>  <span style="color: #417802">$</span>1, (%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4)
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>10
<span style="color: #778877"># BB#20:   #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #140e66">incl</span>  4(%<span style="color: #104e13">rsp</span>)
.<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>10:  # %.<span style="color: #04175e">backedge</span>
<span style="color: #778877">           #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #4d357a">addq</span>  <span style="color: #417802">$</span>1, %<span style="color: #322920">rbx</span>
  <span style="color: #4b5540">cmpq</span>  <span style="color: #417802">$</span>160000000, %<span style="color: #322920">rbx</span>
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>6
    </pre>
    </td>
    <td>
    <pre>
  <span style="color: #3e312d">movq</span>  %<span style="color: #631f45">rax</span>, %<span style="color: #1c301d">r</span>14
  <span style="color: #665002">movl</span>  <span style="color: #417802">$</span>-1, %<span style="color: #052546">eax</span>
  .<span style="color: #204104">align</span>  16, 0<span style="color: #390958">x</span>90
.<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>6:
<span style="color: #778877">  # =&gt;This Inner Loop Header: Depth=1</span>
  <span style="color: #025d32">cmpl</span>  <span style="color: #417802">$</span>1, -4(%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4)
  <span style="color: #317c62">sete</span>  %<span style="color: #2b3133">cl</span>
  <span style="color: #025d32">cmpl</span>  <span style="color: #417802">$</span>1, -8(%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4)
  <span style="color: #665002">movl</span>  <span style="color: #417802">$</span>0, %<span style="color: #354a6d">edx</span>
  <span style="color: #1b796f">cmovel</span>  %<span style="color: #052546">eax</span>, %<span style="color: #354a6d">edx</span>
  <span style="color: #025d32">cmpl</span>  <span style="color: #417802">$</span>1, -12(%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4)
  <span style="color: #0b6721">movzbl</span>  %<span style="color: #2b3133">cl</span>, %<span style="color: #473411">ecx</span>
  <span style="color: #661f21">je</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>8
<span style="color: #778877"># BB#7:    # %select.false</span>
<span style="color: #778877">           #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #3b152f">xorl</span>  %<span style="color: #354a6d">edx</span>, %<span style="color: #354a6d">edx</span>
.<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>8:   # %<span style="color: #64757f">select</span>.<span style="color: #1d3f2b">end</span>
<span style="color: #778877">           #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #3d7d51">andl</span>  %<span style="color: #354a6d">edx</span>, %<span style="color: #473411">ecx</span>
  <span style="color: #025d32">cmpl</span>  <span style="color: #417802">$</span>1, (%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4)
  <span style="color: #317c62">sete</span>  %<span style="color: #0e1070">dl</span>
  <span style="color: #0b6721">movzbl</span>  %<span style="color: #0e1070">dl</span>, %<span style="color: #354a6d">edx</span>
  <span style="color: #265c2a">negl</span>  %<span style="color: #473411">ecx</span>
  <span style="color: #7b6d19">testl</span>  %<span style="color: #473411">ecx</span>, %<span style="color: #354a6d">edx</span>
  <span style="color: #661f21">je</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>9
<span style="color: #778877"># BB#19:   #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #140e66">incl</span>  4(%<span style="color: #104e13">rsp</span>)
.<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>9:   # %.<span style="color: #04175e">backedge</span>
<span style="color: #778877">           #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #4d357a">addq</span>  <span style="color: #417802">$</span>1, %<span style="color: #322920">rbx</span>
  <span style="color: #4b5540">cmpq</span>  <span style="color: #417802">$</span>160000000, %<span style="color: #322920">rbx</span>
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>6
    </pre>
    </td></tr></table>
    <p>
There are 4 comparisons and the rest is just about turning flags into registers. I think we can get rid of that.
    </p>
    </div>
    <script language="JavaScript">
    init_slider(1);
    </script>

    <h2>
Round 3. ==, && vs *, +, -
    </h1>
    <p>
In this simple example, we can substitute almost all the logic with computation. Instead of comparing each value separately we can calculate the squared error for the whole 4-tuple.
    </p>
    <table><tr>
    <td id="left_3">
    <pre>
  for (auto i = 0u; i &lt; TheSize - 3; ++i)
    if(xs[i] == 1
    && xs[i+1] == 1
    && xs[i+2] == 1
    && xs[i+3] == 1)
      ++four_1_in_a_row;
    </pre>
    </td>
    <td id="right_3">
    <pre>
...
inline int sq(int x) {
  return x*x;
}
...
  for (auto i = 0u; i &lt; TheSize - 3; ++i)
    if(sq(xs[i] - 1)
     + sq(xs[i+1] - 1)
     + sq(xs[i+2] - 1)
     + sq(xs[i+3] - 1) == 0)
      ++four_1_in_a_row;
    </pre>
    </td></tr></table>
    <canvas id="slider_3" width=608 height=128></canvas>
    <p class="comment" id="comment_3">
They are almost the same.
    </p>
    <button type="button" onclick="reveal(2)" id="button_3">Reveal the truth</button>
    <div id="the_truth_3" style="display:none;">
    <p>
And this works perfectly. The code is a few lines longer, but there are no comparisons until the very end. Everything is blunt number crunching. Computers love this kind of code.
    </p>
    <table><tr>
    <td>
    <pre>
  <span style="color: #3e312d">movq</span>  %<span style="color: #631f45">rax</span>, %<span style="color: #1c301d">r</span>14
  .<span style="color: #204104">align</span>  16, 0<span style="color: #390958">x</span>90
.<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>6:
<span style="color: #778877">  # =&gt;This Inner Loop Header: Depth=1</span>
  <span style="color: #025d32">cmpl</span>  <span style="color: #417802">$</span>1, -12(%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4)
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11
<span style="color: #778877"># BB#7:    #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #025d32">cmpl</span>  <span style="color: #417802">$</span>1, -8(%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4)
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11
<span style="color: #778877"># BB#8:    #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #025d32">cmpl</span>  <span style="color: #417802">$</span>1, -4(%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4)
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11
<span style="color: #778877"># BB#9:    #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #025d32">cmpl</span>  <span style="color: #417802">$</span>1, (%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4)
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11
<span style="color: #778877"># BB#10:   #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #140e66">incl</span>  4(%<span style="color: #104e13">rsp</span>)
  .<span style="color: #204104">align</span>  16, 0<span style="color: #390958">x</span>90
.<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11:  # %.<span style="color: #5e7876">_crit_edge</span>
<span style="color: #778877">           #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #4d357a">addq</span>  <span style="color: #417802">$</span>1, %<span style="color: #322920">rbx</span>
  <span style="color: #4b5540">cmpq</span>  <span style="color: #417802">$</span>160000000, %<span style="color: #322920">rbx</span>
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>6
    </pre>
    </td>
    <td>
    <pre>
  <span style="color: #3e312d">movq</span>  %<span style="color: #631f45">rax</span>, %<span style="color: #1c301d">r</span>14
  .<span style="color: #204104">align</span>  16, 0<span style="color: #390958">x</span>90
.<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>6:
<span style="color: #778877">  # =&gt;This Inner Loop Header: Depth=1</span>
  <span style="color: #665002">movl</span>  -12(%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4), %<span style="color: #052546">eax</span>
  <span style="color: #7b0d35">addl</span>  <span style="color: #417802">$</span>-1, %<span style="color: #052546">eax</span>
  <span style="color: #744661">imull</span>  %<span style="color: #052546">eax</span>, %<span style="color: #052546">eax</span>
  <span style="color: #665002">movl</span>  -8(%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4), %<span style="color: #473411">ecx</span>
  <span style="color: #7b0d35">addl</span>  <span style="color: #417802">$</span>-1, %<span style="color: #473411">ecx</span>
  <span style="color: #744661">imull</span>  %<span style="color: #473411">ecx</span>, %<span style="color: #473411">ecx</span>
  <span style="color: #7b0d35">addl</span>  %<span style="color: #052546">eax</span>, %<span style="color: #473411">ecx</span>
  <span style="color: #665002">movl</span>  -4(%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4), %<span style="color: #052546">eax</span>
  <span style="color: #7b0d35">addl</span>  <span style="color: #417802">$</span>-1, %<span style="color: #052546">eax</span>
  <span style="color: #744661">imull</span>  %<span style="color: #052546">eax</span>, %<span style="color: #052546">eax</span>
  <span style="color: #7b0d35">addl</span>  %<span style="color: #473411">ecx</span>, %<span style="color: #052546">eax</span>
  <span style="color: #665002">movl</span>  (%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4), %<span style="color: #473411">ecx</span>
  <span style="color: #665002">movl</span>  <span style="color: #417802">$</span>1, %<span style="color: #354a6d">edx</span>
  <span style="color: #24690f">subl</span>  %<span style="color: #473411">ecx</span>, %<span style="color: #354a6d">edx</span>
  <span style="color: #7b0d35">addl</span>  <span style="color: #417802">$</span>-1, %<span style="color: #473411">ecx</span>
  <span style="color: #744661">imull</span>  %<span style="color: #354a6d">edx</span>, %<span style="color: #473411">ecx</span>
  <span style="color: #025d32">cmpl</span>  %<span style="color: #473411">ecx</span>, %<span style="color: #052546">eax</span>
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>7
<span style="color: #778877"># BB#17:   #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #140e66">incl</span>  4(%<span style="color: #104e13">rsp</span>)
.<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>7:   # %.<span style="color: #04175e">backedge</span>
<span style="color: #778877">           #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #4d357a">addq</span>  <span style="color: #417802">$</span>1, %<span style="color: #322920">rbx</span>
  <span style="color: #4b5540">cmpq</span>  <span style="color: #417802">$</span>160000000, %<span style="color: #322920">rbx</span>
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>6
    </pre>
    </td></tr></table>
    </div>
    <script language="JavaScript">
    init_slider(2);
    </script>

    <h2>
Round 4. * vs abs
    </h1>
    <p>
We don't really need multiplications. We don't really need squared error. Why don't we calculate an absolute error instead?
    </p>
    <table><tr>
    <td id="left_4">
    <pre>
...
inline int sq(int x) {
  return x*x;
}
...
  for (auto i = 0u; i &lt; TheSize - 3; ++i)
    if(sq(xs[i] - 1)
     + sq(xs[i+1] - 1)
     + sq(xs[i+2] - 1)
     + sq(xs[i+3] - 1) == 0)
      ++four_1_in_a_row;
    </pre>
    </td>
    <td id="right_4">
    <pre>
  for (auto i = 0u; i &lt; TheSize - 3; ++i)
    if(std::abs(xs[i] - 1)
     + std::abs(xs[i+1] - 1)
     + std::abs(xs[i+2] - 1)
     + std::abs(xs[i+3] - 1) == 0)
      ++four_1_in_a_row;
    </pre>
    </td></tr></table>
    <canvas id="slider_4" width=608 height=128></canvas>
    <p class="comment" id="comment_4">
They are almost the same.
    </p>
    <button type="button" onclick="reveal(3)" id="button_4">Reveal the truth</button>
    <div id="the_truth_4" style="display:none;">
    <p>
That's why. Getting an absolute value of an int is not a trivial job. It's not about clipping a bit off; it is a fair comparison and a conditional move. This pair is heavier than a simple multiplication.
    </p>
    <table><tr>
    <td>
    <pre>
  <span style="color: #3e312d">movq</span>  %<span style="color: #631f45">rax</span>, %<span style="color: #1c301d">r</span>14
  .<span style="color: #204104">align</span>  16, 0<span style="color: #390958">x</span>90
.<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>6:
<span style="color: #778877">  # =&gt;This Inner Loop Header: Depth=1</span>
  <span style="color: #665002">movl</span>  -12(%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4), %<span style="color: #052546">eax</span>
  <span style="color: #7b0d35">addl</span>  <span style="color: #417802">$</span>-1, %<span style="color: #052546">eax</span>
  <span style="color: #744661">imull</span>  %<span style="color: #052546">eax</span>, %<span style="color: #052546">eax</span>
  <span style="color: #665002">movl</span>  -8(%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4), %<span style="color: #473411">ecx</span>
  <span style="color: #7b0d35">addl</span>  <span style="color: #417802">$</span>-1, %<span style="color: #473411">ecx</span>
  <span style="color: #744661">imull</span>  %<span style="color: #473411">ecx</span>, %<span style="color: #473411">ecx</span>
  <span style="color: #7b0d35">addl</span>  %<span style="color: #052546">eax</span>, %<span style="color: #473411">ecx</span>
  <span style="color: #665002">movl</span>  -4(%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4), %<span style="color: #052546">eax</span>
  <span style="color: #7b0d35">addl</span>  <span style="color: #417802">$</span>-1, %<span style="color: #052546">eax</span>
  <span style="color: #744661">imull</span>  %<span style="color: #052546">eax</span>, %<span style="color: #052546">eax</span>
  <span style="color: #7b0d35">addl</span>  %<span style="color: #473411">ecx</span>, %<span style="color: #052546">eax</span>
  <span style="color: #665002">movl</span>  (%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4), %<span style="color: #473411">ecx</span>
  <span style="color: #665002">movl</span>  <span style="color: #417802">$</span>1, %<span style="color: #354a6d">edx</span>
  <span style="color: #24690f">subl</span>  %<span style="color: #473411">ecx</span>, %<span style="color: #354a6d">edx</span>
  <span style="color: #7b0d35">addl</span>  <span style="color: #417802">$</span>-1, %<span style="color: #473411">ecx</span>
  <span style="color: #744661">imull</span>  %<span style="color: #354a6d">edx</span>, %<span style="color: #473411">ecx</span>
  <span style="color: #025d32">cmpl</span>  %<span style="color: #473411">ecx</span>, %<span style="color: #052546">eax</span>
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>7
<span style="color: #778877"># BB#17:   #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #140e66">incl</span>  4(%<span style="color: #104e13">rsp</span>)
.<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>7:   # %.<span style="color: #04175e">backedge</span>
<span style="color: #778877">           #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #4d357a">addq</span>  <span style="color: #417802">$</span>1, %<span style="color: #322920">rbx</span>
  <span style="color: #4b5540">cmpq</span>  <span style="color: #417802">$</span>160000000, %<span style="color: #322920">rbx</span>
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>6
    </pre>
    </td>
    <td>
    <pre>
  <span style="color: #3e312d">movq</span>  %<span style="color: #631f45">rax</span>, %<span style="color: #1c301d">r</span>14
  .<span style="color: #204104">align</span>  16, 0<span style="color: #390958">x</span>90
.<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>6:
<span style="color: #778877">  # =&gt;This Inner Loop Header: Depth=1</span>
  <span style="color: #665002">movl</span>  -12(%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4), %<span style="color: #052546">eax</span>
  <span style="color: #265e08">leal</span>  -1(%<span style="color: #631f45">rax</span>), %<span style="color: #473411">ecx</span>
  <span style="color: #665002">movl</span>  <span style="color: #417802">$</span>1, %<span style="color: #354a6d">edx</span>
  <span style="color: #24690f">subl</span>  %<span style="color: #052546">eax</span>, %<span style="color: #354a6d">edx</span>
  <span style="color: #7b6d19">testl</span>  %<span style="color: #052546">eax</span>, %<span style="color: #052546">eax</span>
  <span style="color: #072c34">cmovgl</span>  %<span style="color: #473411">ecx</span>, %<span style="color: #354a6d">edx</span>
  <span style="color: #665002">movl</span>  -8(%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4), %<span style="color: #052546">eax</span>
  <span style="color: #265e08">leal</span>  -1(%<span style="color: #631f45">rax</span>), %<span style="color: #473411">ecx</span>
  <span style="color: #665002">movl</span>  <span style="color: #417802">$</span>1, %<span style="color: #4d4767">esi</span>
  <span style="color: #24690f">subl</span>  %<span style="color: #052546">eax</span>, %<span style="color: #4d4767">esi</span>
  <span style="color: #7b6d19">testl</span>  %<span style="color: #052546">eax</span>, %<span style="color: #052546">eax</span>
  <span style="color: #072c34">cmovgl</span>  %<span style="color: #473411">ecx</span>, %<span style="color: #4d4767">esi</span>
  <span style="color: #7b0d35">addl</span>  %<span style="color: #354a6d">edx</span>, %<span style="color: #4d4767">esi</span>
  <span style="color: #665002">movl</span>  -4(%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4), %<span style="color: #052546">eax</span>
  <span style="color: #265e08">leal</span>  -1(%<span style="color: #631f45">rax</span>), %<span style="color: #473411">ecx</span>
  <span style="color: #665002">movl</span>  <span style="color: #417802">$</span>1, %<span style="color: #354a6d">edx</span>
  <span style="color: #24690f">subl</span>  %<span style="color: #052546">eax</span>, %<span style="color: #354a6d">edx</span>
  <span style="color: #7b6d19">testl</span>  %<span style="color: #052546">eax</span>, %<span style="color: #052546">eax</span>
  <span style="color: #072c34">cmovgl</span>  %<span style="color: #473411">ecx</span>, %<span style="color: #354a6d">edx</span>
  <span style="color: #7b0d35">addl</span>  %<span style="color: #4d4767">esi</span>, %<span style="color: #354a6d">edx</span>
  <span style="color: #665002">movl</span>  (%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4), %<span style="color: #052546">eax</span>
  <span style="color: #265e08">leal</span>  -1(%<span style="color: #631f45">rax</span>), %<span style="color: #473411">ecx</span>
  <span style="color: #665002">movl</span>  <span style="color: #417802">$</span>1, %<span style="color: #4d4767">esi</span>
  <span style="color: #24690f">subl</span>  %<span style="color: #052546">eax</span>, %<span style="color: #4d4767">esi</span>
  <span style="color: #7b6d19">testl</span>  %<span style="color: #052546">eax</span>, %<span style="color: #052546">eax</span>
  <span style="color: #072c34">cmovgl</span>  %<span style="color: #473411">ecx</span>, %<span style="color: #4d4767">esi</span>
  <span style="color: #7b0d35">addl</span>  %<span style="color: #354a6d">edx</span>, %<span style="color: #4d4767">esi</span>
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>7
<span style="color: #778877"># BB#17:   #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #140e66">incl</span>  4(%<span style="color: #104e13">rsp</span>)
.<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>7:   # %.<span style="color: #04175e">backedge</span>
<span style="color: #778877">           #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #4d357a">addq</span>  <span style="color: #417802">$</span>1, %<span style="color: #322920">rbx</span>
  <span style="color: #4b5540">cmpq</span>  <span style="color: #417802">$</span>160000000, %<span style="color: #322920">rbx</span>
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>6
    </pre>
    </td></tr></table>
    <p>
What's interesting, in floating point numbers, when getting an absolute value <i>is</i> about clipping a bit off, <a href="https://godbolt.org/z/ZoFInw">there are no tests or conditions</a>.
    </p>
    </div>
    <script language="JavaScript">
    init_slider(3);
    </script>

    <h2>
Round 5. int vs double
    </h1>
    <p>
The question is, will there be any gain if we simply translate our code to work with doubles?
    </p>
    <table><tr>
    <td id="left_5">
    <pre>
...
  using TheType = int;
...
  for (auto i = 0u; i &lt; TheSize - 3; ++i)
    if(xs[i] == 1
    && xs[i+1] == 1
    && xs[i+2] == 1
    && xs[i+3] == 1)
      ++four_1_in_a_row;
    </pre>
    </td>
    <td id="right_5">
    <pre>
...
  using TheType = double;
...
  for (auto i = 0u; i &lt; TheSize - 3; ++i)
    if(xs[i] == 1
    && xs[i+1] == 1
    && xs[i+2] == 1
    && xs[i+3] == 1)
      ++four_1_in_a_row;
    </pre>
    </td></tr></table>
    <canvas id="slider_5" width=608 height=128></canvas>
    <p class="comment" id="comment_5">
They are almost the same.
    </p>
    <button type="button" onclick="reveal(4)" id="button_5">Reveal the truth</button>
    <div id="the_truth_5" style="display:none;">
    <p>
Not really, no. The operations are different, but essentially the code is the same. It's still about comparing and jumping.
    </p>
    <table><tr>
    <td>
    <pre>
  <span style="color: #3e312d">movq</span>  %<span style="color: #631f45">rax</span>, %<span style="color: #1c301d">r</span>14
  .<span style="color: #204104">align</span>  16, 0<span style="color: #390958">x</span>90
.<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>6:
<span style="color: #778877">  # =&gt;This Inner Loop Header: Depth=1</span>
  <span style="color: #025d32">cmpl</span>  <span style="color: #417802">$</span>1, -12(%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4)
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11
<span style="color: #778877"># BB#7:    #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #025d32">cmpl</span>  <span style="color: #417802">$</span>1, -8(%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4)
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11
<span style="color: #778877"># BB#8:    #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #025d32">cmpl</span>  <span style="color: #417802">$</span>1, -4(%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4)
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11
<span style="color: #778877"># BB#9:    #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #025d32">cmpl</span>  <span style="color: #417802">$</span>1, (%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4)
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11
<span style="color: #778877"># BB#10:   #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #140e66">incl</span>  4(%<span style="color: #104e13">rsp</span>)
  .<span style="color: #204104">align</span>  16, 0<span style="color: #390958">x</span>90
.<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11:  # %.<span style="color: #5e7876">_crit_edge</span>
<span style="color: #778877">           #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #4d357a">addq</span>  <span style="color: #417802">$</span>1, %<span style="color: #322920">rbx</span>
  <span style="color: #4b5540">cmpq</span>  <span style="color: #417802">$</span>160000000, %<span style="color: #322920">rbx</span>
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>6
    </pre>
    </td>
    <td>
    <pre>
  <span style="color: #3e312d">movq</span>  %<span style="color: #631f45">rax</span>, %<span style="color: #1c301d">r</span>14
  .<span style="color: #204104">align</span>  16, 0<span style="color: #390958">x</span>90
.<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>6:
<span style="color: #778877">  # =&gt;This Inner Loop Header: Depth=1</span>
  <span style="color: #621369">vmovsd</span>  -24(%<span style="color: #1c301d">r</span>15,%<span style="color: #322920">rbx</span>,8), %<span style="color: #356259">xmm</span>0
  <span style="color: #4d3309">vucomisd</span>  .<span style="color: #3a453d">LCPI</span>0<span style="color: #077d4b">_</span>0(%<span style="color: #782724">rip</span>), %<span style="color: #356259">xmm</span>0
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11
  <span style="color: #3e0e69">jp</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11
<span style="color: #778877"># BB#7:    #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #621369">vmovsd</span>  -16(%<span style="color: #1c301d">r</span>15,%<span style="color: #322920">rbx</span>,8), %<span style="color: #356259">xmm</span>0
  <span style="color: #4d3309">vucomisd</span>  .<span style="color: #3a453d">LCPI</span>0<span style="color: #077d4b">_</span>0(%<span style="color: #782724">rip</span>), %<span style="color: #356259">xmm</span>0
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11
  <span style="color: #3e0e69">jp</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11
<span style="color: #778877"># BB#8:    #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #621369">vmovsd</span>  -8(%<span style="color: #1c301d">r</span>15,%<span style="color: #322920">rbx</span>,8), %<span style="color: #356259">xmm</span>0
  <span style="color: #4d3309">vucomisd</span>  .<span style="color: #3a453d">LCPI</span>0<span style="color: #077d4b">_</span>0(%<span style="color: #782724">rip</span>), %<span style="color: #356259">xmm</span>0
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11
  <span style="color: #3e0e69">jp</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11
<span style="color: #778877"># BB#9:    #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #621369">vmovsd</span>  (%<span style="color: #1c301d">r</span>15,%<span style="color: #322920">rbx</span>,8), %<span style="color: #356259">xmm</span>0
  <span style="color: #4d3309">vucomisd</span>  .<span style="color: #3a453d">LCPI</span>0<span style="color: #077d4b">_</span>0(%<span style="color: #782724">rip</span>), %<span style="color: #356259">xmm</span>0
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11
  <span style="color: #3e0e69">jp</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11
<span style="color: #778877"># BB#10:   #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #140e66">incl</span>  4(%<span style="color: #104e13">rsp</span>)
  .<span style="color: #204104">align</span>  16, 0<span style="color: #390958">x</span>90
.<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11:  # %.<span style="color: #5e7876">_crit_edge</span>
<span style="color: #778877">           #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #4d357a">addq</span>  <span style="color: #417802">$</span>1, %<span style="color: #322920">rbx</span>
  <span style="color: #4b5540">cmpq</span>  <span style="color: #417802">$</span>160000000, %<span style="color: #322920">rbx</span>
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>6
    </pre>
    </td></tr></table>
    </div>
    <script language="JavaScript">
    init_slider(4);
    </script>

    <h2>
Round 6. *, +, - int vs double
    </h1>
    <p>
But if we change the code to avoid logic, will there be any gain?
    </p>
    <table><tr>
    <td id="left_6">
    <pre>
...
inline int sq(int x) {
  return x*x;
}
...
  using TheType = int;
...
  for (auto i = 0u; i &lt; TheSize - 3; ++i)
    if(sq(xs[i] - 1)
     + sq(xs[i+1] - 1)
     + sq(xs[i+2] - 1)
     + sq(xs[i+3] - 1) == 0)
      ++four_1_in_a_row;
    </pre>
    </td>
    <td id="right_6">
    <pre>
...
inline double sq(int x) {
  return x*x;
}
...
  using TheType = double;
...
  for (auto i = 0u; i &lt; TheSize - 3; ++i)
    if(sq(xs[i] - 1)
     + sq(xs[i+1] - 1)
     + sq(xs[i+2] - 1)
     + sq(xs[i+3] - 1) == 0)
      ++four_1_in_a_row;
    </pre>
    </td></tr></table>
    <canvas id="slider_6" width=608 height=128></canvas>
    <p class="comment" id="comment_6">
They are almost the same.
    </p>
    <button type="button" onclick="reveal(5)" id="button_6">Reveal the truth</button>
    <div id="the_truth_6" style="display:none;">
    <p>
No. The code is conceptually the same though, so the loss is also not that drastic.
    </p>
    <table><tr>
    <td>
    <pre>
  <span style="color: #3e312d">movq</span>  %<span style="color: #631f45">rax</span>, %<span style="color: #1c301d">r</span>14
  .<span style="color: #204104">align</span>  16, 0<span style="color: #390958">x</span>90
.<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>6:
<span style="color: #778877">  # =&gt;This Inner Loop Header: Depth=1</span>
  <span style="color: #665002">movl</span>  -12(%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4), %<span style="color: #052546">eax</span>
  <span style="color: #7b0d35">addl</span>  <span style="color: #417802">$</span>-1, %<span style="color: #052546">eax</span>
  <span style="color: #744661">imull</span>  %<span style="color: #052546">eax</span>, %<span style="color: #052546">eax</span>
  <span style="color: #665002">movl</span>  -8(%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4), %<span style="color: #473411">ecx</span>
  <span style="color: #7b0d35">addl</span>  <span style="color: #417802">$</span>-1, %<span style="color: #473411">ecx</span>
  <span style="color: #744661">imull</span>  %<span style="color: #473411">ecx</span>, %<span style="color: #473411">ecx</span>
  <span style="color: #7b0d35">addl</span>  %<span style="color: #052546">eax</span>, %<span style="color: #473411">ecx</span>
  <span style="color: #665002">movl</span>  -4(%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4), %<span style="color: #052546">eax</span>
  <span style="color: #7b0d35">addl</span>  <span style="color: #417802">$</span>-1, %<span style="color: #052546">eax</span>
  <span style="color: #744661">imull</span>  %<span style="color: #052546">eax</span>, %<span style="color: #052546">eax</span>
  <span style="color: #7b0d35">addl</span>  %<span style="color: #473411">ecx</span>, %<span style="color: #052546">eax</span>
  <span style="color: #665002">movl</span>  (%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4), %<span style="color: #473411">ecx</span>
  <span style="color: #665002">movl</span>  <span style="color: #417802">$</span>1, %<span style="color: #354a6d">edx</span>
  <span style="color: #24690f">subl</span>  %<span style="color: #473411">ecx</span>, %<span style="color: #354a6d">edx</span>
  <span style="color: #7b0d35">addl</span>  <span style="color: #417802">$</span>-1, %<span style="color: #473411">ecx</span>
  <span style="color: #744661">imull</span>  %<span style="color: #354a6d">edx</span>, %<span style="color: #473411">ecx</span>
  <span style="color: #025d32">cmpl</span>  %<span style="color: #473411">ecx</span>, %<span style="color: #052546">eax</span>
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>7
<span style="color: #778877"># BB#17:   #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #140e66">incl</span>  4(%<span style="color: #104e13">rsp</span>)
.<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>7:   # %.<span style="color: #04175e">backedge</span>
<span style="color: #778877">           #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #4d357a">addq</span>  <span style="color: #417802">$</span>1, %<span style="color: #322920">rbx</span>
  <span style="color: #4b5540">cmpq</span>  <span style="color: #417802">$</span>160000000, %<span style="color: #322920">rbx</span>
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>6
    </pre>
    </td>
    <td>
    <pre>
  <span style="color: #3e312d">movq</span>  %<span style="color: #631f45">rax</span>, %<span style="color: #1c301d">r</span>14
  <span style="color: #621369">vmovsd</span>  .<span style="color: #3a453d">LCPI</span>1<span style="color: #077d4b">_</span>0(%<span style="color: #782724">rip</span>), %<span style="color: #356259">xmm</span>0
  <span style="color: #122f54">vxorps</span>  %<span style="color: #356259">xmm</span>1, %<span style="color: #356259">xmm</span>1, %<span style="color: #356259">xmm</span>1
  .<span style="color: #204104">align</span>  16, 0<span style="color: #390958">x</span>90
.<span style="color: #500864">LBB</span>1<span style="color: #077d4b">_</span>6:
<span style="color: #778877">  # =&gt;This Inner Loop Header: Depth=1</span>
  <span style="color: #364c41">vaddsd</span>  -24(%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,8), %<span style="color: #356259">xmm</span>0, %<span style="color: #356259">xmm</span>2
  <span style="color: #5b081d">vmulsd</span>  %<span style="color: #356259">xmm</span>2, %<span style="color: #356259">xmm</span>2, %<span style="color: #356259">xmm</span>2
  <span style="color: #364c41">vaddsd</span>  -16(%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,8), %<span style="color: #356259">xmm</span>0, %<span style="color: #356259">xmm</span>3
  <span style="color: #5b081d">vmulsd</span>  %<span style="color: #356259">xmm</span>3, %<span style="color: #356259">xmm</span>3, %<span style="color: #356259">xmm</span>3
  <span style="color: #364c41">vaddsd</span>  %<span style="color: #356259">xmm</span>3, %<span style="color: #356259">xmm</span>2, %<span style="color: #356259">xmm</span>2
  <span style="color: #364c41">vaddsd</span>  -8(%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,8), %<span style="color: #356259">xmm</span>0, %<span style="color: #356259">xmm</span>3
  <span style="color: #5b081d">vmulsd</span>  %<span style="color: #356259">xmm</span>3, %<span style="color: #356259">xmm</span>3, %<span style="color: #356259">xmm</span>3
  <span style="color: #364c41">vaddsd</span>  %<span style="color: #356259">xmm</span>3, %<span style="color: #356259">xmm</span>2, %<span style="color: #356259">xmm</span>2
  <span style="color: #364c41">vaddsd</span>  (%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,8), %<span style="color: #356259">xmm</span>0, %<span style="color: #356259">xmm</span>3
  <span style="color: #5b081d">vmulsd</span>  %<span style="color: #356259">xmm</span>3, %<span style="color: #356259">xmm</span>3, %<span style="color: #356259">xmm</span>3
  <span style="color: #364c41">vaddsd</span>  %<span style="color: #356259">xmm</span>3, %<span style="color: #356259">xmm</span>2, %<span style="color: #356259">xmm</span>2
  <span style="color: #4d3309">vucomisd</span>  %<span style="color: #356259">xmm</span>1, %<span style="color: #356259">xmm</span>2
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>1<span style="color: #077d4b">_</span>9
  <span style="color: #40165a">jnp</span>  .<span style="color: #500864">LBB</span>1<span style="color: #077d4b">_</span>8
  <span style="color: #2b7409">jmp</span>  .<span style="color: #500864">LBB</span>1<span style="color: #077d4b">_</span>9
.<span style="color: #500864">LBB</span>1<span style="color: #077d4b">_</span>8:   #   <span style="color: #59483a">in</span> <span style="color: #2d7955">Loop</span>: <span style="color: #08403e">Header</span>=<span style="color: #341059">BB</span>1<span style="color: #077d4b">_</span>6 <span style="color: #063135">Depth</span>=1
  <span style="color: #140e66">incl</span>  4(%<span style="color: #104e13">rsp</span>)
.<span style="color: #500864">LBB</span>1<span style="color: #077d4b">_</span>9:   # %.<span style="color: #04175e">backedge</span>
<span style="color: #778877">           #   in Loop: Header=BB1_6 Depth=1</span>
  <span style="color: #4d357a">addq</span>  <span style="color: #417802">$</span>1, %<span style="color: #322920">rbx</span>
  <span style="color: #4b5540">cmpq</span>  <span style="color: #417802">$</span>160000000, %<span style="color: #322920">rbx</span>
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>1<span style="color: #077d4b">_</span>6
    </pre>
    </td></tr></table>
    </div>
    <script language="JavaScript">
    init_slider(5);
    </script>

    <h2>
Round 7. double vs float
    </h1>
    <p>
That sound a bit like cheating because with single precision types we would have to read two times less from the memory but let's give it a go.
    </p>
    <table><tr>
    <td id="left_7">
    <pre>
...
  using TheType = double;
...
  for (auto i = 0u; i &lt; TheSize - 3; ++i)
    if(xs[i] == 1
    && xs[i+1] == 1
    && xs[i+2] == 1
    && xs[i+3] == 1)
      ++four_1_in_a_row;
    </pre>
    </td>
    <td id="right_7">
    <pre>
...
  using TheType = float;
...
  for (auto i = 0u; i &lt; TheSize - 3; ++i)
    if(xs[i] == 1
    && xs[i+1] == 1
    && xs[i+2] == 1
    && xs[i+3] == 1)
      ++four_1_in_a_row;
    </pre>
    </td></tr></table>
    <canvas id="slider_7" width=608 height=128></canvas>
    <p class="comment" id="comment_7">
They are almost the same.
    </p>
    <button type="button" onclick="reveal(6)" id="button_7">Reveal the truth</button>
    <div id="the_truth_7" style="display:none;">
    <p>
And that's the most peculiar thing. Although the code now reads much less from the memory, performance wise it's almost identical to its original form.
    </p>
    <table><tr>
    <td>
    <pre>
  <span style="color: #3e312d">movq</span>  %<span style="color: #631f45">rax</span>, %<span style="color: #1c301d">r</span>14
  .<span style="color: #204104">align</span>  16, 0<span style="color: #390958">x</span>90
.<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>6:
<span style="color: #778877">  # =&gt;This Inner Loop Header: Depth=1</span>
  <span style="color: #621369">vmovsd</span>  -24(%<span style="color: #1c301d">r</span>15,%<span style="color: #322920">rbx</span>,8), %<span style="color: #356259">xmm</span>0
  <span style="color: #4d3309">vucomisd</span>  .<span style="color: #3a453d">LCPI</span>0<span style="color: #077d4b">_</span>0(%<span style="color: #782724">rip</span>), %<span style="color: #356259">xmm</span>0
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11
  <span style="color: #3e0e69">jp</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11
<span style="color: #778877"># BB#7:    #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #621369">vmovsd</span>  -16(%<span style="color: #1c301d">r</span>15,%<span style="color: #322920">rbx</span>,8), %<span style="color: #356259">xmm</span>0
  <span style="color: #4d3309">vucomisd</span>  .<span style="color: #3a453d">LCPI</span>0<span style="color: #077d4b">_</span>0(%<span style="color: #782724">rip</span>), %<span style="color: #356259">xmm</span>0
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11
  <span style="color: #3e0e69">jp</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11
<span style="color: #778877"># BB#8:    #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #621369">vmovsd</span>  -8(%<span style="color: #1c301d">r</span>15,%<span style="color: #322920">rbx</span>,8), %<span style="color: #356259">xmm</span>0
  <span style="color: #4d3309">vucomisd</span>  .<span style="color: #3a453d">LCPI</span>0<span style="color: #077d4b">_</span>0(%<span style="color: #782724">rip</span>), %<span style="color: #356259">xmm</span>0
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11
  <span style="color: #3e0e69">jp</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11
<span style="color: #778877"># BB#9:    #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #621369">vmovsd</span>  (%<span style="color: #1c301d">r</span>15,%<span style="color: #322920">rbx</span>,8), %<span style="color: #356259">xmm</span>0
  <span style="color: #4d3309">vucomisd</span>  .<span style="color: #3a453d">LCPI</span>0<span style="color: #077d4b">_</span>0(%<span style="color: #782724">rip</span>), %<span style="color: #356259">xmm</span>0
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11
  <span style="color: #3e0e69">jp</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11
<span style="color: #778877"># BB#10:   #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #140e66">incl</span>  4(%<span style="color: #104e13">rsp</span>)
  .<span style="color: #204104">align</span>  16, 0<span style="color: #390958">x</span>90
.<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11:  # %.<span style="color: #5e7876">_crit_edge</span>
<span style="color: #778877">           #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #4d357a">addq</span>  <span style="color: #417802">$</span>1, %<span style="color: #322920">rbx</span>
  <span style="color: #4b5540">cmpq</span>  <span style="color: #417802">$</span>160000000, %<span style="color: #322920">rbx</span>
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>6
    </pre>
    </td>
    <td>
    <pre>
  <span style="color: #3e312d">movq</span>  %<span style="color: #631f45">rax</span>, %<span style="color: #1c301d">r</span>14
  .<span style="color: #204104">align</span>  16, 0<span style="color: #390958">x</span>90
.<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>6:
<span style="color: #778877">  # =&gt;This Inner Loop Header: Depth=1</span>
  <span style="color: #383463">vmovss</span>  -12(%<span style="color: #1c301d">r</span>15,%<span style="color: #322920">rbx</span>,4), %<span style="color: #356259">xmm</span>0
  <span style="color: #467402">vucomiss</span>  .<span style="color: #3a453d">LCPI</span>0<span style="color: #077d4b">_</span>0(%<span style="color: #782724">rip</span>), %<span style="color: #356259">xmm</span>0
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11
  <span style="color: #3e0e69">jp</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11
<span style="color: #778877"># BB#7:    #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #383463">vmovss</span>  -8(%<span style="color: #1c301d">r</span>15,%<span style="color: #322920">rbx</span>,4), %<span style="color: #356259">xmm</span>0
  <span style="color: #467402">vucomiss</span>  .<span style="color: #3a453d">LCPI</span>0<span style="color: #077d4b">_</span>0(%<span style="color: #782724">rip</span>), %<span style="color: #356259">xmm</span>0
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11
  <span style="color: #3e0e69">jp</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11
<span style="color: #778877"># BB#8:    #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #383463">vmovss</span>  -4(%<span style="color: #1c301d">r</span>15,%<span style="color: #322920">rbx</span>,4), %<span style="color: #356259">xmm</span>0
  <span style="color: #467402">vucomiss</span>  .<span style="color: #3a453d">LCPI</span>0<span style="color: #077d4b">_</span>0(%<span style="color: #782724">rip</span>), %<span style="color: #356259">xmm</span>0
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11
  <span style="color: #3e0e69">jp</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11
<span style="color: #778877"># BB#9:    #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #383463">vmovss</span>  (%<span style="color: #1c301d">r</span>15,%<span style="color: #322920">rbx</span>,4), %<span style="color: #356259">xmm</span>0
  <span style="color: #467402">vucomiss</span>  .<span style="color: #3a453d">LCPI</span>0<span style="color: #077d4b">_</span>0(%<span style="color: #782724">rip</span>), %<span style="color: #356259">xmm</span>0
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11
  <span style="color: #3e0e69">jp</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11
<span style="color: #778877"># BB#10:   #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #140e66">incl</span>  4(%<span style="color: #104e13">rsp</span>)
  .<span style="color: #204104">align</span>  16, 0<span style="color: #390958">x</span>90
.<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11:  # %.<span style="color: #5e7876">_crit_edge</span>
<span style="color: #778877">           #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #4d357a">addq</span>  <span style="color: #417802">$</span>1, %<span style="color: #322920">rbx</span>
  <span style="color: #4b5540">cmpq</span>  <span style="color: #417802">$</span>160000000, %<span style="color: #322920">rbx</span>
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>6
    </pre>
    </td></tr></table>
    <p>
This has probably something to do with the bus and the CPU working asynchronously. If the CPU is busy enough, the bus load doesn't matter.
    </p>
    </div>
    <script language="JavaScript">
    init_slider(6);
    </script>

    <h2>
Round 8. 1 vs 0
    </h1>
    <p>
This is the bonus round. There is a notion, right along with the short-circuiting being good for performance, that the comparison with zero is cheaper than any other comparison. Let's try it out.
    </p>
    <table><tr>
    <td id="left_8">
    <pre>
  for (auto i = 0u; i &lt; TheSize - 3; ++i)
    if(xs[i] == 1
    && xs[i+1] == 1
    && xs[i+2] == 1
    && xs[i+3] == 1)
      ++four_1_in_a_row;
    </pre>
    </td>
    <td id="right_8">
    <pre>
  for (auto i = 0u; i &lt; TheSize - 3; ++i)
    if(xs[i] == 0
    && xs[i+1] == 0
    && xs[i+2] == 0
    && xs[i+3] == 0)
      four_0_in_a_row++;
    </pre>
    </td></tr></table>
    <canvas id="slider_8" width=608 height=128></canvas>
    <p class="comment" id="comment_8">
They are almost the same.
    </p>
    <button type="button" onclick="reveal(7)" id="button_8">Reveal the truth</button>
    <div id="the_truth_8" style="display:none;">
    <p>
Of course, it isn't. It may be contextually beneficial to check against zero because with Intel architecture there is a dedicated zero flag, and most of the time you can read it from the previous operation skipping the comparison part altogether. But in our example, there is no operation to load the zero flag so the code on both sides is almost identical.
    </p>
    <table><tr>
    <td>
    <pre>
  <span style="color: #3e312d">movq</span>  %<span style="color: #631f45">rax</span>, %<span style="color: #1c301d">r</span>14
  .<span style="color: #204104">align</span>  16, 0<span style="color: #390958">x</span>90
.<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>6:
<span style="color: #778877">  # =&gt;This Inner Loop Header: Depth=1</span>
  <span style="color: #025d32">cmpl</span>  <span style="color: #417802">$</span>1, -12(%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4)
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11
<span style="color: #778877"># BB#7:    #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #025d32">cmpl</span>  <span style="color: #417802">$</span>1, -8(%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4)
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11
<span style="color: #778877"># BB#8:    #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #025d32">cmpl</span>  <span style="color: #417802">$</span>1, -4(%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4)
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11
<span style="color: #778877"># BB#9:    #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #025d32">cmpl</span>  <span style="color: #417802">$</span>1, (%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4)
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11
<span style="color: #778877"># BB#10:   #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #140e66">incl</span>  4(%<span style="color: #104e13">rsp</span>)
  .<span style="color: #204104">align</span>  16, 0<span style="color: #390958">x</span>90
.<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11:  # %.<span style="color: #5e7876">_crit_edge</span>
<span style="color: #778877">           #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #4d357a">addq</span>  <span style="color: #417802">$</span>1, %<span style="color: #322920">rbx</span>
  <span style="color: #4b5540">cmpq</span>  <span style="color: #417802">$</span>160000000, %<span style="color: #322920">rbx</span>
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>6
    </pre>
    </td>
    <td>
    <pre>
  <span style="color: #3e312d">movq</span>  %<span style="color: #631f45">rax</span>, %<span style="color: #1c301d">r</span>14
  .<span style="color: #204104">align</span>  16, 0<span style="color: #390958">x</span>90
.<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>6:
<span style="color: #778877">  # =&gt;This Inner Loop Header: Depth=1</span>
  <span style="color: #025d32">cmpl</span>  <span style="color: #417802">$</span>0, -12(%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4)
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11
<span style="color: #778877"># BB#7:    #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #025d32">cmpl</span>  <span style="color: #417802">$</span>0, -8(%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4)
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11
<span style="color: #778877"># BB#8:    #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #025d32">cmpl</span>  <span style="color: #417802">$</span>0, -4(%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4)
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11
<span style="color: #778877"># BB#9:    #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #025d32">cmpl</span>  <span style="color: #417802">$</span>0, (%<span style="color: #1c301d">r</span>12,%<span style="color: #322920">rbx</span>,4)
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11
<span style="color: #778877"># BB#10:   #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #140e66">incl</span>  4(%<span style="color: #104e13">rsp</span>)
  .<span style="color: #204104">align</span>  16, 0<span style="color: #390958">x</span>90
.<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>11:  # %.<span style="color: #5e7876">_crit_edge</span>
<span style="color: #778877">           #   in Loop: Header=BB0_6 Depth=1</span>
  <span style="color: #4d357a">addq</span>  <span style="color: #417802">$</span>1, %<span style="color: #322920">rbx</span>
  <span style="color: #4b5540">cmpq</span>  <span style="color: #417802">$</span>160000000, %<span style="color: #322920">rbx</span>
  <span style="color: #672e2d">jne</span>  .<span style="color: #500864">LBB</span>0<span style="color: #077d4b">_</span>6
    </pre>
    </td></tr></table>
    </div>
    <script language="JavaScript">
    init_slider(7);
    </script>

    <div id="show_in_the_end" style="display:none;">
    <h2>
Congratulations!
    </h2>
    <p>
You scored <span id="score"></span> pixels of error. As a reference, if you leave every slider untouched there would be exactly <span id="default_score"></span> pixels of error.
    </p>

    <h2>
Conclusion
    </h2>
    <p>
Truisms don't help performance. That's my conclusion. We all know that logical operations perform short-circuiting; that floats are shorter than doubles; that throwing away a sign from a number is easier than computing its square. It's all true. It's all irrelevant without a proper context.
    </p>
    </div>


    <table class="footer" style="width: 555pt; padding: 64pt 0pt 32pt 0pt; background-color: transparent; font-family: sans-serif; font-size: 16pt; font-style: normal;">
    <tr>
    <td class="footer" style="vertical-align: middle; text-align: left; width: 64px; padding: 0; margin: 0; border: 0;">
        <a href="index.html"><img src="favicon.ico"></a>
    </td>
    <td class="footer" style="vertical-align: middle; text-align: left; width: 200pt; padding: 0; margin: 0; border: 0;">
        &nbsp;&larr; there's more.
    </td>
    <td class="footer" style="vertical-align: middle; text-align: right; width: 300pt; padding: 0; margin: 0; border: 0;">
        +
        <a href="https://github.com/akalenuk/wordsandbuttons">Github</a> &
        <a href="https://twitter.com/wordsandbuttons">Twitter</a> &
        <a href="https://news.ycombinator.com/from?site=wordsandbuttons.online">Hacker News</a>
    </td>
    </tr>
    </table>
    </center>
  </body>
</html>
