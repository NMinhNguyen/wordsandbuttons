<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Interactive introduction to iterative algorithms</title>
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
    <style>
body{
    margin: 0 0 0 0;
}

a{
    text-decoration: none;
}

h1 {
    padding-top: 32pt;
    font-size: 24pt;
    width: 600pt;
    text-align: left;
}

h2 {
    padding-top: 16pt;
    font-size: 20pt;
    width: 555pt;
    text-align: left;
}

p {
    font-size: 16pt;
    width: 505pt;
    text-align: left;
}

.footer {
    margin-top: 64pt;
    padding-bottom: 32pt;
    font-family: sans-serif;
    font-size: 14pt;
}

pre {
    margin: 0 0 0 0;
    padding-top: 12pt;
    padding-left: 12pt;
    padding-right: 12pt;
    padding-bottom: 12pt;
    font-size: 16pt;
    text-align: left;
    width: 505pt;
}

.code {
    background-color: #bbbbff;
}

.code_piece {
    background-color: #bbbbff;
    font-family: monospace;
    padding-left: 2pt;
    padding-right: 2pt;
}

form {
    margin: 0 0 0 0;
    padding-top: 12pt;
    padding-left: 12pt;
    padding-right: 12pt;
    padding-bottom: 12pt;
    font-size: 16pt;
    text-align: left;
    width: 505pt;
    background-color: #eeee99;
}

input[type="text"] {
    width: 100pt;
    height: 22pt;
    margin: 8pt 8pt 8pt 8pt;
    padding-left: 3pt;
    font-size: 16pt;
}

button {
    width: 100pt;
    height: 22pt;
    margin-left:8pt;
    margin-right:8pt;
    font-size: 16pt;
}

input[type="radio"]{
    width: 22pt;
    height: 22pt;
    margin: 8pt 8pt 8pt 8pt;
}
    </style>
    <script language="JavaScript">

function client_to_x(client_x){
    return (client_x - 256.) / 32.;
}

function client_to_y(client_y){
    return (256 - client_y) / 32.;
}

function x_to_client(x){
    return x * 32. + 256;
}

function y_to_client(y){
    return 256 - y * 32.;
}

function draw_grid_on(context){
	// grid
 	context.beginPath();
	context.moveTo(0, 256);
	context.lineTo(512, 256);
	context.lineTo(500, 251);
	context.moveTo(512, 256);
	context.lineTo(500, 261);
	context.moveTo(256, 512);
	context.lineTo(256, 0);
	context.lineTo(251, 12);
	context.moveTo(256, 0);
	context.lineTo(261, 12);
    context.fillStyle="#000000";
	for(var i = -7; i <= 7; i++){
	    context.moveTo(256 + i*32, 256);
		context.lineTo(256 + i*32, 251);
		context.fillText(i, 256 + i*32 + 4, 256 + 16);
	    context.moveTo(256, 256 - i*32);
		context.lineTo(261, 256 - i*32);
		context.fillText(i, 261, 256 - i*32 + 16);
	}
	context.strokeStyle="#000000";
    context.stroke();
    context.closePath();
}

var a11 = -0.5;
var a12 = 1.0;
var b1 = -4.0;
var a21 = 0.5;
var a22 = 1.0;
var b2 = 4.0;

var start_x = -2.0;
var start_y = 0.0;

var end_step_length = 0.5;


var temp_a11 = 0.0;
var temp_a12 = 0.0;
var temp_b1 = 0.0;

function dot_of(a11, a12, a21, a22){
    return a11*a21 + a12*a22;
}

function length_of(a1, a2){
    return Math.sqrt(dot_of(a1, a2, a1, a2));
}

function projected_x(x, y, a1, a2, b){
    return x + a1 * (b - dot_of(x, y, a1, a2)) / dot_of(a1, a2, a1, a2);
}

function projected_y(x, y, a1, a2, b){
    return y + a2 * (b - dot_of(x, y, a1, a2)) / dot_of(a1, a2, a1, a2);
}

function init_solver(){
    solver = document.getElementById("solver");
    var canvas_rect = solver.getBoundingClientRect();
    solver_draw(0, 0, false);
    
    solver.addEventListener('mousemove', function(e){
        var canvas_rect = solver.getBoundingClientRect();
   	    solver_draw(e.clientX - canvas_rect.left, e.clientY - canvas_rect.top, true);
    }, false);

    solver.addEventListener('mousedown', function(e){
        var canvas_rect = solver.getBoundingClientRect();
       	if(document.getElementById("button_1").disabled){
       	    a11 = temp_a11;
       	    a12 = temp_a12;
       	    b1 = temp_b1;
       	}
       	if(document.getElementById("button_3").disabled){
       	    start_x = client_to_x(e.clientX - canvas_rect.left);
       	    start_y = client_to_y(e.clientY - canvas_rect.top);
       	}
	    solver_draw(0, 0, false);        
    }, false);
    
    solver.addEventListener('mouseleave', function(e){
	    solver_draw(0, 0, false);        
    }, false);    
}

function solver_draw(client_x, client_y, do_guides){
    solver = document.getElementById("solver");
    var solver_context = solver.getContext("2d"); 
    solver_context.font = "16px sans-serif";
    // background
    solver_context.fillStyle="#eeeeee";
	solver_context.fillRect(0,0,512,512);
	
	// red line
	solver_context.beginPath();
	solver_context.moveTo(x_to_client(-8), y_to_client((b1 - a11*(-8))/a12));
	solver_context.lineTo(x_to_client(8), y_to_client((b1 - a11*(8))/a12));
	solver_context.strokeStyle="#dd6644";
    solver_context.stroke();
    solver_context.closePath();
    // red margin
	solver_context.beginPath();
    solver_context.setLineDash([3, 6]);	
	solver_context.moveTo(x_to_client(-8), y_to_client((b1 - end_step_length - a11*(-8))/a12));
	solver_context.lineTo(x_to_client(8), y_to_client((b1 - end_step_length - a11*(8))/a12));
	solver_context.moveTo(x_to_client(-8), y_to_client((b1 + end_step_length - a11*(-8))/a12));
	solver_context.lineTo(x_to_client(8), y_to_client((b1 + end_step_length - a11*(8))/a12));
    solver_context.strokeStyle="#ff8866";
    solver_context.stroke();
    solver_context.setLineDash([]);    
    solver_context.closePath();
	
	// blue line
	solver_context.beginPath();
	solver_context.moveTo(x_to_client(-8), y_to_client((b2 - a21*(-8))/a22));
	solver_context.lineTo(x_to_client(8), y_to_client((b2 - a21*(8))/a22));
	solver_context.strokeStyle="#3366dd";
    solver_context.stroke();
    solver_context.closePath();
    // blue margin
   	solver_context.beginPath();
    solver_context.setLineDash([3, 6]);	
	solver_context.moveTo(x_to_client(-8), y_to_client((b2 - end_step_length - a21*(-8))/a22));
	solver_context.lineTo(x_to_client(8), y_to_client((b2 - end_step_length - a21*(8))/a22));
	solver_context.moveTo(x_to_client(-8), y_to_client((b2 + end_step_length - a21*(-8))/a22));
	solver_context.lineTo(x_to_client(8), y_to_client((b2 + end_step_length - a21*(8))/a22));
    solver_context.strokeStyle="#6699ff";
    solver_context.stroke();
    solver_context.setLineDash([]);    
    solver_context.closePath();

    // solver
    solver_context.beginPath();
	solver_context.moveTo(x_to_client(start_x), y_to_client(start_y));
	var prev_x = start_x + end_step_length + 1.;    // not to fall as done
	var prev_y = start_y;
	var cur_x = start_x;
	var cur_y = start_y;
	var i;
	for(i = 0; i <= 100; i++) // max iterations = 100
	{
	    if(length_of(prev_x - cur_x, prev_y - cur_y) < end_step_length)
	        break;  // done
	    prev_x = cur_x;
	    prev_y = cur_y;
	    if(i % 2 == 0){
    	    cur_x = projected_x(prev_x, prev_y, a11, a12, b1);
    	    cur_y = projected_y(prev_x, prev_y, a11, a12, b1);
    	}else{
    	    cur_x = projected_x(prev_x, prev_y, a21, a22, b2);
    	    cur_y = projected_y(prev_x, prev_y, a21, a22, b2);
    	}
    	solver_context.lineTo(x_to_client(cur_x), y_to_client(cur_y));
	}
	solver_context.strokeStyle="#446644";
    solver_context.stroke();
    solver_context.closePath();
    
	// grid
	draw_grid_on(solver_context);
	

	// mouse move
	if(do_guides){
    	if(document.getElementById("button_1").disabled){
            var x = client_to_x(client_x);
            var y = client_to_y(client_y);
            var x0 = - x - 0.001;
            var y0 = (b1 - a11*x0/a12);
            temp_a11 = (y - y0)/(-x + x0);
            temp_a12 = 1.0;
            temp_b1 = (x*y0 - x0*y)/(x - x0);
   	        solver_context.beginPath();
   	        solver_context.setLineDash([6, 3]);	
	        solver_context.moveTo(x_to_client(-8), y_to_client((temp_b1 - temp_a11*(-8))/temp_a12));
	        solver_context.lineTo(x_to_client(8), y_to_client((temp_b1 - temp_a11*(8))/temp_a12));
            solver_context.strokeStyle="#dd6644";
            solver_context.stroke();
            solver_context.setLineDash([]);	
            solver_context.closePath();  
    	}
	    if(document.getElementById("button_3").disabled){
	        solver_context.beginPath();
        	solver_context.moveTo(x_to_client(start_x), y_to_client(start_y));
        	solver_context.lineTo(client_x, client_y);
            solver_context.strokeStyle="#ff6688";
            solver_context.stroke();
            solver_context.closePath();   
        }
	}
	
	// iteration count
	if(i > 100){
    	solver_context.fillText("Iterations > 100", 32, 480);
    }else{
        solver_context.fillText("Iterations = " + i, 32, 480);
    }
}

function radio(n){
    for(var i = 1; i <=4; i++){
        radio_i = document.getElementById("button_" + i);
        radio_i.disabled = false;
    }
    radio_n = document.getElementById("button_" + n);
    radio_n.disabled = true; 
}
    </script>
  </head>
  <body>
    <center>
    <h1>
Interactive introduction to iterative algorithms
    </h1>
    <p>
This is not only a tongue-twister, but an actual interactice introduction.
    </p>

    <canvas id="solver" width=512 height=512></canvas>
    <form>
        <center>
            <button type="button" id="button_1" onclick="radio(1)" disabled="true">Red line</button>
            <button type="button" id="button_2" onclick="radio(2)">Blue line</button>
            <button type="button" id="button_3" onclick="radio(3)">Start point</button>
            <button type="button" id="button_4" onclick="radio(4)">End criteria</button>
        </center>
    </form> 
    <script language="JavaScript">
    init_solver();
    </script>

    
    <p class="footer">
    There are more words and plots on <a href="index.html">wordsandbuttons.online</a>.<br>
    Also please follow us on <a href="https://twitter.com/wordsandbuttons">Twitter</a>.
    </p>
    </center>
  </body>
</html>
