<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Interactive introduction to iterative algorithms</title>
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
    <style>
body{
    margin: 0 0 0 0;
}

a{
    text-decoration: none;
}

h1 {
    padding-top: 32pt;
    font-size: 24pt;
    width: 600pt;
    text-align: left;
}

h2 {
    padding-top: 16pt;
    font-size: 20pt;
    width: 555pt;
    text-align: left;
}

p {
    font-size: 16pt;
    width: 505pt;
    text-align: left;
}

.footer {
    margin-top: 64pt;
    padding-bottom: 32pt;
    font-family: sans-serif;
    font-size: 14pt;
}

pre {
    margin: 0 0 0 0;
    padding-top: 12pt;
    padding-left: 12pt;
    padding-right: 12pt;
    padding-bottom: 12pt;
    font-size: 16pt;
    text-align: left;
    width: 505pt;
}

.code {
    background-color: #bbbbff;
}

.code_piece {
    background-color: #bbbbff;
    font-family: monospace;
    padding-left: 2pt;
    padding-right: 2pt;
}

form {
    margin: 0 0 0 0;
    padding-top: 12pt;
    padding-left: 12pt;
    padding-right: 12pt;
    padding-bottom: 12pt;
    font-size: 16pt;
    text-align: left;
    width: 505pt;
    background-color: #eeee99;
}

input[type="text"] {
    width: 100pt;
    height: 22pt;
    margin: 8pt 8pt 8pt 8pt;
    padding-left: 3pt;
    font-size: 16pt;
}

button {
    width: 100pt;
    height: 22pt;
    margin-left:8pt;
    margin-right:8pt;
    font-size: 16pt;
}

input[type="radio"]{
    width: 22pt;
    height: 22pt;
    margin: 8pt 8pt 8pt 8pt;
}
    </style>
    <script language="JavaScript">

// client
var w = 512.0;
var h = 512.0;

// visible region
var x_min = -1.0;
var y_min = -1.0;
var x_max = 7.0;
var y_max = 7.0;

var client_x_center = w*(0-x_min)/(x_max-x_min);
var client_x_step = (w/(x_max-x_min));

var client_y_center = h - h*(0-y_min)/(y_max-y_min);
var client_y_step = (h/(y_max-y_min));

function client_to_x(client_x){
    return (client_x - client_x_center) / client_x_step;
}

function client_to_y(client_y){
    return (client_y_center - client_y) / client_y_step;
}

function x_to_client(x){
    return x * client_x_step + client_x_center;
}

function y_to_client(y){
    return client_y_center - y * client_y_step;
}

function draw_grid_on(context){
	// grid
 	context.beginPath();
	context.moveTo(0, client_y_center);
	context.lineTo(w, client_y_center);
	context.lineTo(w - 12, client_y_center - 5);
	context.moveTo(w, client_y_center);
	context.lineTo(w - 12, client_y_center + 5);
	context.moveTo(client_x_center, h);
	context.lineTo(client_x_center, 0);
	context.lineTo(client_x_center - 5, 12);
	context.moveTo(client_x_center, 0);
	context.lineTo(client_x_center + 5, 12);
    context.fillStyle="#000000";
	for(var i = x_min + 1; i <= x_max - 1; i++){
	    context.moveTo(client_x_center + i*client_x_step, client_y_center);
		context.lineTo(client_x_center + i*client_x_step, client_y_center - 5);
		context.fillText(i, client_x_center + i*client_x_step + 4, client_y_center + 16);
	}
	for(var i = y_min + 1; i <= y_max - 1; i++){
	    context.moveTo(client_x_center, client_y_center - i*client_y_step);
		context.lineTo(client_x_center + 5, client_y_center - i*client_y_step);
		context.fillText(i, client_x_center + 5, client_y_center - i*client_y_step + 16);
	}
	context.strokeStyle="#000000";
    context.stroke();
    context.closePath();
}

// lines
var a11 = -1.25;
var a12 = 1.0;
var b1 = -1.0;
var a21 = -0.25;
var a22 = 1.0;
var b2 = 4.0;

// start
var start_x = 2.0;
var start_y = 3.0;

// margin
var end_step_length = 0.5;

// temps
var temp_a11 = 0.0;
var temp_a12 = 0.0;
var temp_b1 = 0.0;
var temp_a21 = 0.0;
var temp_a22 = 0.0;
var temp_b2 = 0.0;

var temp_end_step_length = 0.5;

function dot_of(a11, a12, a21, a22){
    return a11*a21 + a12*a22;
}

function length_of(a1, a2){
    return Math.sqrt(dot_of(a1, a2, a1, a2));
}

function projected_x(x, y, a1, a2, b){
    return x + a1 * (b - dot_of(x, y, a1, a2)) / dot_of(a1, a2, a1, a2);
}

function projected_y(x, y, a1, a2, b){
    return y + a2 * (b - dot_of(x, y, a1, a2)) / dot_of(a1, a2, a1, a2);
}

function init_solver(){
    solver = document.getElementById("solver");
    var canvas_rect = solver.getBoundingClientRect();
    solver_draw(0, 0, false);
    
    solver.addEventListener('mousemove', function(e){
        var canvas_rect = solver.getBoundingClientRect();
   	    solver_draw(e.clientX - canvas_rect.left, e.clientY - canvas_rect.top, true);
    }, false);

    solver.addEventListener('mousedown', function(e){
        var canvas_rect = solver.getBoundingClientRect();
       	if(document.getElementById("button_1").disabled){
       	    a11 = temp_a11;
       	    a12 = temp_a12;
       	    b1 = temp_b1;
       	}else if(document.getElementById("button_2").disabled){
       	    a21 = temp_a21;
       	    a22 = temp_a22;
       	    b2 = temp_b2;
       	}else if(document.getElementById("button_3").disabled){
       	    start_x = client_to_x(e.clientX - canvas_rect.left);
       	    start_y = client_to_y(e.clientY - canvas_rect.top);
       	}else if(document.getElementById("button_4").disabled){
       	    end_step_length = temp_end_step_length;
       	}
	    solver_draw(0, 0, false);        
    }, false);
    
    solver.addEventListener('mouseleave', function(e){
	    solver_draw(0, 0, false);        
    }, false);    
}

function solver_draw(client_x, client_y, do_guides){
    solver = document.getElementById("solver");
    var solver_context = solver.getContext("2d"); 
    solver_context.font = "16px sans-serif";
    // background
    solver_context.fillStyle="#eeeeee";
	solver_context.fillRect(0,0,512,512);
	
    // red margin
	solver_context.beginPath();
	var db1 = end_step_length * length_of(a11, a12);
	solver_context.moveTo(x_to_client(x_min), y_to_client((b1 - db1 - a11*(y_min))/a12));
	solver_context.lineTo(x_to_client(x_max), y_to_client((b1 - db1 - a11*(y_max))/a12));
	solver_context.lineTo(x_to_client(x_max), y_to_client((b1 + db1 - a11*(y_max))/a12));
	solver_context.lineTo(x_to_client(x_min), y_to_client((b1 + db1 - a11*(y_min))/a12));
	solver_context.lineTo(x_to_client(x_min), y_to_client((b1 - db1 - a11*(y_min))/a12));
    solver_context.strokeStyle="#ff8866";
    solver_context.stroke();   
    solver_context.closePath();
    solver_context.fillStyle="#ffccaa";
    solver_context.fill();

    // blue margin
   	solver_context.beginPath();
   	var db2 = end_step_length * length_of(a21, a22);
	solver_context.moveTo(x_to_client(x_min), y_to_client((b2 - db2 - a21*(y_min))/a22));
	solver_context.lineTo(x_to_client(x_max), y_to_client((b2 - db2 - a21*(y_max))/a22));
	solver_context.lineTo(x_to_client(x_max), y_to_client((b2 + db2 - a21*(y_max))/a22));
	solver_context.lineTo(x_to_client(x_min), y_to_client((b2 + db2 - a21*(y_min))/a22));
	solver_context.lineTo(x_to_client(x_min), y_to_client((b2 - db2 - a21*(y_min))/a22));
    solver_context.strokeStyle="#6699ff";
    solver_context.stroke();    
    solver_context.closePath();
    solver_context.fillStyle="#aaccff";
    solver_context.fill();
    
	// red line
	solver_context.beginPath();
	solver_context.moveTo(x_to_client(x_min), y_to_client((b1 - a11*(y_min))/a12));
	solver_context.lineTo(x_to_client(x_max), y_to_client((b1 - a11*(y_max))/a12));
	solver_context.strokeStyle="#dd6644";
    solver_context.stroke();
    solver_context.closePath();
    	    
	// blue line
	solver_context.beginPath();
	solver_context.moveTo(x_to_client(x_min), y_to_client((b2 - a21*(y_min))/a22));
	solver_context.lineTo(x_to_client(x_max), y_to_client((b2 - a21*(y_max))/a22));
	solver_context.strokeStyle="#3366dd";
    solver_context.stroke();
    solver_context.closePath();
    
    // solver
    solver_context.beginPath();
	solver_context.moveTo(x_to_client(start_x), y_to_client(start_y));
	var prev_x = start_x + end_step_length + 1.;    // not to fall as done
	var prev_y = start_y;
	var cur_x = start_x;
	var cur_y = start_y;
	var i;
	for(i = 0; i <= 100; i++) // max iterations = 100
	{
	    if(length_of(prev_x - cur_x, prev_y - cur_y) < end_step_length)
	        break;  // done
	    prev_x = cur_x;
	    prev_y = cur_y;
	    if(i % 2 == 0){
    	    cur_x = projected_x(prev_x, prev_y, a11, a12, b1);
    	    cur_y = projected_y(prev_x, prev_y, a11, a12, b1);
    	}else{
    	    cur_x = projected_x(prev_x, prev_y, a21, a22, b2);
    	    cur_y = projected_y(prev_x, prev_y, a21, a22, b2);
    	}
    	solver_context.lineTo(x_to_client(cur_x), y_to_client(cur_y));
	}
	solver_context.strokeStyle="#446644";
    solver_context.stroke();
    solver_context.closePath();
    
	// grid
	draw_grid_on(solver_context);
	

	// mouse move
	if(do_guides){
    	if(document.getElementById("button_1").disabled){
            var x = client_to_x(client_x);
            var y = client_to_y(client_y);
            var x0 = x_max - (x-x_min) - 0.001;
            var y0 = (b1 - a11*x0/a12);
            temp_a11 = (y - y0)/(-x + x0);
            temp_a12 = 1.0;
            temp_b1 = (x*y0 - x0*y)/(x - x0);
   	        solver_context.beginPath();
   	        solver_context.setLineDash([6, 3]);	
	        solver_context.moveTo(x_to_client(x_min), y_to_client((temp_b1 - temp_a11*(y_min))/temp_a12));
	        solver_context.lineTo(x_to_client(x_max), y_to_client((temp_b1 - temp_a11*(y_max))/temp_a12));
            solver_context.strokeStyle="#dd6644";
            solver_context.stroke();
            solver_context.setLineDash([]);	
            solver_context.closePath();  
    	}else if(document.getElementById("button_2").disabled){
            var x = client_to_x(client_x);
            var y = client_to_y(client_y);
            var x0 = x_max - (x-x_min) - 0.001;
            var y0 = (b2 - a21*x0/a22);
            temp_a21 = (y - y0)/(-x + x0);
            temp_a22 = 1.0;
            temp_b2 = (x*y0 - x0*y)/(x - x0);
   	        solver_context.beginPath();
   	        solver_context.setLineDash([6, 3]);	
	        solver_context.moveTo(x_to_client(x_min), y_to_client((temp_b2 - temp_a21*(y_min))/temp_a22));
	        solver_context.lineTo(x_to_client(x_max), y_to_client((temp_b2 - temp_a21*(y_max))/temp_a22));
            solver_context.strokeStyle="#3366dd";
            solver_context.stroke();
            solver_context.setLineDash([]);
            solver_context.closePath();      	
	    }else if(document.getElementById("button_3").disabled){
	        solver_context.beginPath();
        	solver_context.moveTo(x_to_client(start_x), y_to_client(start_y));
        	solver_context.lineTo(client_x, client_y);
            solver_context.strokeStyle="#ff6688";
            solver_context.stroke();
            solver_context.closePath();   
   	    }else if(document.getElementById("button_4").disabled){
            var x = client_to_x(client_x);
            var y = client_to_y(client_y);
            var x1 = projected_x(x, y, a11, a12, b1);
            var y1 = projected_y(x, y, a11, a12, b1);
            var x2 = projected_x(x, y, a21, a22, b2);
            var y2 = projected_y(x, y, a21, a22, b2);
            var d1 = length_of(x-x1, y-y1);
            var d2 = length_of(x-x2, y-y2);
            if(d1<d2){
                temp_end_step_length = d1;
            }else{
                temp_end_step_length = d2;
            }
       	    // red
   	    	solver_context.beginPath();
            solver_context.setLineDash([4, 4]);
            var db1 = temp_end_step_length * length_of(a11, a12);
	        solver_context.moveTo(x_to_client(x_min), y_to_client((b1 - db1 - a11*(y_min))/a12));
	        solver_context.lineTo(x_to_client(x_max), y_to_client((b1 - db1 - a11*(y_max))/a12));
	        solver_context.moveTo(x_to_client(x_min), y_to_client((b1 + db1 - a11*(y_min))/a12));
	        solver_context.lineTo(x_to_client(x_max), y_to_client((b1 + db1 - a11*(y_max))/a12));
            solver_context.strokeStyle="#ff8866";
            solver_context.stroke();
            solver_context.setLineDash([]);    
            solver_context.closePath();
            // blue
            solver_context.beginPath();
            solver_context.setLineDash([4, 4]);
            var db2 = temp_end_step_length * length_of(a21, a22);
	        solver_context.moveTo(x_to_client(x_min), y_to_client((b2 - db2 - a21*(y_min))/a22));
	        solver_context.lineTo(x_to_client(x_max), y_to_client((b2 - db2 - a21*(y_max))/a22));
	        solver_context.moveTo(x_to_client(x_min), y_to_client((b2 + db2 - a21*(y_min))/a22));
	        solver_context.lineTo(x_to_client(x_max), y_to_client((b2 + db2 - a21*(y_max))/a22));
            solver_context.strokeStyle="#6699ff";
            solver_context.stroke();
            solver_context.setLineDash([]);    
            solver_context.closePath();
        }
	}
	
	// iteration count
	results = document.getElementById("results");
	if(i > 100){
    	results.innerHTML = "Iterations > 100";
    }else{
        results.innerHTML = "Iterations = " + i;
    }
}

function radio(n){
    for(var i = 1; i <=4; i++){
        radio_i = document.getElementById("button_" + i);
        radio_i.disabled = false;
    }
    radio_n = document.getElementById("button_" + n);
    radio_n.disabled = true; 
}
    </script>
  </head>
  <body>
    <center>
    <h1>
Interactive introduction to iterative algorithms
    </h1>
    <p>
This is not only a tongue-twister, but an actual interactice introduction.
    </p>

    <canvas id="solver" width=512 height=512></canvas>
    <p style="comment" id="results">
    </p>
    <form>
        <center>
            <button type="button" id="button_1" onclick="radio(1)" disabled="true">Red line</button>
            <button type="button" id="button_2" onclick="radio(2)">Blue line</button>
            <button type="button" id="button_3" onclick="radio(3)">Start point</button>
            <button type="button" id="button_4" onclick="radio(4)">End criteria</button>
        </center>
    </form> 
    <script language="JavaScript">
    init_solver();
    </script>

    
    <p class="footer">
    There are more words and plots on <a href="index.html">wordsandbuttons.online</a>.<br>
    Also please follow us on <a href="https://twitter.com/wordsandbuttons">Twitter</a>.
    </p>
    </center>
  </body>
</html>
