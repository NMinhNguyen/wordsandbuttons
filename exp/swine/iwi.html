<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Inverse-weight interpolation</title>
    <meta name="keywords" content="iterative,algorithms,guide,tutorial,learning">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
    <style>
body{
    margin: 0 0 0 0;
}

a{
    text-decoration: none;
}

h1 {
    padding-top: 32pt;
    font-size: 24pt;
    width: 600pt;
    text-align: left;
}

h2 {
    padding-top: 16pt;
    font-size: 20pt;
    width: 555pt;
    text-align: left;
}

p {
    font-size: 16pt;
    width: 505pt;
    text-align: left;
}

.results {
    font-family: sans-serif;
    font-size: 14pt;
    width: 505pt;
    text-align: left;
}

.formula {
    font-family: sans-serif;
    font-size: 16pt;
    font-style: italic;
    width: 505pt;
    text-align: center;
    padding-top: 6pt;
    padding-bottom: 6pt;
}

table.footer {
    padding: 64pt 0pt 32pt 0pt;
    background-color: transparent;
    width: 505pt;
}

td.footer {
    font-family: sans-serif;
    font-size: 16pt;
    font-style: normal;
    padding: 0;
    margin: 0;
    border: 0;
}

li {
    font-size: 16pt;
    width: 505pt;
    text-align: left;
    padding-bottom: 6pt;
}

form {
    margin: 0 0 0 0;
    padding-top: 12pt;
    padding-left: 12pt;
    padding-right: 12pt;
    padding-bottom: 12pt;
    font-size: 16pt;
    text-align: left;
    width: 505pt;
    background-color: #eeee99;
}

input[type="text"] {
    width: 48pt;
    height: 22pt;
    font-size: 16pt;
    text-align: center;
}

input[type="radio"] {
    height: 16pt;
    width: 16pt;
    font-size: 16pt;
}

input[type="checkbox"] {
    height: 16pt;
    width: 16pt;
    font-size: 16pt;
    margin-bottom: 16pt;
}

button {
    width: 128pt;
    height: 26pt;
    font-size: 16pt;
    text-align: center;
}

textarea {
    width: 600pt;
    font-size: 12pt;
    font-family: monospace;
}

.comment {
    font-size: 12pt;
    text-align:center;
    font-family: sans-serif;
    padding-bottom: 24pt;
}
    </style>
    <script language="JavaScript">

// client
var w = 1024.0;
var h = 1024.0;

// pixels
var pixels = [];
var pixel_size;

function reset_pixels() {
    pixels = [];
    for(var i = 0; i < h; ++i) {
        pixelsi = []
        for(var j = 0; j < w; ++j)
            pixelsi.push([0., 0., 0.]);
        pixels.push(pixelsi);
    }
}

reset_pixels();


function load_pixels_from(url) {
    fetch(url).then(function(response) {
        var blob = response.blob().then(function(blob) {
            var img = createImageBitmap(blob);
            var canvas = document.createElement('canvas');
            var context = canvas.getContext('2d');
            var img = document.getElementById('myimg');
            canvas.width = img.width;
            canvas.height = img.height;
            context.drawImage(img, 0, 0 );
            var image_data = context.getImageData(0, 0, img.width, img.height);
            for (var i = 0; i < img.height; ++i) {
                for (var j = 0; j < img.width; ++j) {
                    pixels[i][j][0] = pixel_field.data[(i*w + j)*4 + 0];
                    pixels[i][j][1] = pixel_field.data[(i*w + j)*4 + 1];
                    pixels[i][j][2] = pixel_field.data[(i*w + j)*4 + 2];
                }
            }
        });
    });
}

function interval(a, b) {
    if (a == b) 
        return [a];
    return [a].concat(interval(a + 1, b));
}

function darn(pixels, i0, j0, i1, j1) {
    const w = pixels[0].length;
    const h = pixels.length;
    for(var i = i0; i <= i1; ++i) {
        // weight coefficients for column
        const ki0 = (i0 == 0) ? 0 : 1. / (i - (i0 - 1));
        const ki1 = (i1 == h) ? 0 : 1. / (i1 + 1 - i);
        for(var j = j0; j <= j1; ++j) {
            // weight coefficients for row
            const kj0 = (j0 == 0) ? 0 : 1. / (j - (j0 - 1));
            const kj1 = (j1 == w) ? 0 : 1. / (j1 + 1 - j);
            // donor pixel values
            const pi0 = (i0 == 0) ? 0x000000 : pixels[i0 - 1][j];
            const pi1 = (i1 == h) ? 0x000000 : pixels[i1 + 1][j];
            const pj0 = (j0 == 0) ? 0x000000 : pixels[i][j0 - 1];
            const pj1 = (j1 == w) ? 0x000000 : pixels[i][j1 + 1];
            // blending
            const d = ki0 + ki1 + kj0 + kj1;
            const r = (pi0[0] * ki0 + pi1[0] * ki1 + pj0[0] * kj0 + pj1[0] * kj1) / d;
            const g = (pi0[1] * ki0 + pi1[1] * ki1 + pj0[1] * kj0 + pj1[1] * kj1) / d;
            const b = (pi0[2] * ki0 + pi1[2] * ki1 + pj0[2] * kj0 + pj1[2] * kj1) / d;
            pixels[i][j] = [r, g, b];
        }
    }
}


function draw_canvas(){
    var canvas = document.getElementById("canvas");
    var context = canvas.getContext("2d");
    // background
    context.fillStyle="#eeeeee";
    context.fillRect(0, 0, w, h);
    
    // pixels
    var pixel_field = context.createImageData(w, h);
    for (var i = 0; i < h; ++i) {
        for (var j = 0; j < w; ++j) {
            pixel_field.data[(i*w + j)*4 + 0] = pixels[i][j][0];
            pixel_field.data[(i*w + j)*4 + 1] = pixels[i][j][1];
            pixel_field.data[(i*w + j)*4 + 2] = pixels[i][j][2];
            pixel_field.data[(i*w + j)*4 + 3] = 0xFF;
        }
    }
    context.putImageData(pixel_field, -0.5, -0.5);
}


  </script>
  </head>
  <body>
    <center>
    <h1>
Inverse weight inerpolation
    </h1>

    <canvas id="canvas" width=1024 height=1024></canvas>
    <script language="JavaScript">
    load_pixels_from('https://upload.wikimedia.org/wikipedia/commons/thumb/0/02/Ancient_Greece_Northern_Part_Map.jpg/800px-Ancient_Greece_Northern_Part_Map.jpg');
    draw_canvas();
    </script>


    </center>
  </body>
</html>
