<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Lexical highlighting vs. syntax highlighting</title>
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
    <style>
body{
    margin: 0 0 0 0;
}

a{
    text-decoration: none;
}

h1 {
    padding-top: 32pt;
    font-size: 24pt;
    width: 600pt;
    text-align: left;
}

h2 {
    padding-top: 16pt;
    font-size: 20pt;
    width: 555pt;
    text-align: left;
}

p {
    font-size: 16pt;
    width: 505pt;
    text-align: left;
}

pre {
    margin: 0 0 0 0;
    padding-top: 12pt;
    padding-left: 12pt;
    padding-right: 12pt;
    padding-bottom: 12pt;
    font-size: 12pt;
    text-align: left;
}

table {
    border-width: 0pt;
}

td {
    vertical-align: top;
    padding: 6pt 12pt 6pt 12pt;
    font-size: 16pt;
    border: 1px solid black;
    width: 100%;
}

form {
    margin: 0 0 0 0;
    padding-top: 12pt;
    padding-left: 12pt;
    padding-right: 12pt;
    padding-bottom: 12pt;
    font-size: 16pt;
    text-align: left;
    width: 505pt;
    background-color: #eeee99;
}

input[type="checkbox"] {
    height: 16pt;
    width: 16pt;
    font-size: 16pt;
    margin-bottom: 16pt;
}

input[type="radio"] {
    height: 16pt;
    width: 16pt;
    font-size: 16pt;
}

label {
    font-size: 16pt;
}

input[type="text"] {
    width: 100%;
    height: 22pt;
    font-size: 16pt;
    text-align: left;
}

button {
    width: 128pt;
    height: 26pt;
    font-size: 16pt;
    text-align: center;
}

textarea {
    width: 100%;
    font-size: 14pt;
    font-family: monospace;
}

    </style>
    <script language="JavaScript">
function generate_highlighter_code() {
    var function_name = document.getElementById("function_name").value;
    var do_quotes = document.getElementById("do_quotes").checked;
    var do_brackets = document.getElementById("do_brackets").checked;
    
    var code = "\n";
    code += "function " + function_name + "(text) {\n";
    code += "   const separators = " + document.getElementById("separators_list").value + ";\n"
    if(do_quotes)
        code += "   const quotes = " + document.getElementById("quotes_list").value + ";\n"
    if(do_brackets)
        code += "   const brackets = " + document.getElementById("brackets_list").value + ";\n"    

    code += "\n";
    code += "    function painted_in(line, color) {\n";
    code += "        return line.length == 0 ? \"\" : \"&lt;span style=\\\"color:#\" + color + \"\\\"&gt;\" + line + \"&lt;/span&gt;\";\n";
    code += "    }\n"

    code += "\n";
    code += "    function colorized(token) {\n";
    code += "        var code_sum = 0;\n";
    code += "        for(var i = 0; i < token.length; ++i)\n";
    code += "            code_sum += ((i+1) * token.charCodeAt(i));\n";
    code += "        var color = '' + ((code_sum % 4) * 2) + (2 + (code_sum % 3) * 2) + (2 + (code_sum % 2) * 4);\n";
    code += "        return painted_in(token, color);\n";
    code += "    }\n";
        

    code += "\n";
    code += "    function separated(line, i) {\n";
    code += "        if(i == separators.length)\n";
    code += "            return colorized(line);\n";
    code += "        return line.split(separators[i]).map(function(subline) {\n";
    code += "            return separated(subline, i + 1);}).join(separators[i]);\n";
    code += "    }\n";

    if(do_quotes) {
        code += "\n";    
        code += "    function unquoted(line, i) {\n";
        code += "        if(i == quotes.length)\n"; 
        code += "            return separated(line, 0);\n";
        code += "        var chunk_no = 0;\n";
        code += "        return line.split('\\\\' + quotes[i]).join('\\0').split(quotes[i]).map(function (chunk) {\n";
        code += "            return chunk.split('\\0').join('\\\\' + quotes[i]);}).map(function (chunk) {\n";
        code += "                return ++chunk_no % 2  == 1 ? unquoted(chunk, i + 1) : painted_in(quotes[i] + chunk + quotes[i], \"888\");}).join('');\n";
        code += "    }\n";
    }
    
    if(do_brackets) {
        code += "\n";
        code += "    function unbracketed(line, i) {\n";
        code += "        if(i == brackets.length)\n";
        if(do_quotes) 
            code += "            return unquoted(line, 0);\n";
        else
            code += "            return separated(line, 0);\n";
        code += "        var chunks = line.split(brackets[i][0]);\n";
        code += "        return unbracketed(chunks[0], i + 1) + chunks.slice(1).map( function(chunk) {\n";
        code += "            var in_out_bracket = chunk.split(brackets[i][1]);\n";
        code += "            return painted_in(brackets[i][0] + in_out_bracket[0] + (in_out_bracket.length > 1 ? brackets[i][1] : ''), \"888\") \n";
        code += "                + unbracketed(in_out_bracket.slice(1).join(brackets[i][1]), i + 1);}).join('');\n";
        code += "    }\n";
    }
    
    code += "\n";
    if(do_brackets)
        code += "    return unbracketed(text, 0);\n";
    else if(do_quotes)
        code += "    return unquoted(text, 0);\n";
    else 
        code += "    return separated(text, 0);\n";        
    code += "}\n";

    document.getElementById("highlighter_code").innerHTML = code;
    highlight_test_area();
}

function highlight_test_area() {
    var code = document.getElementById("highlighter_code").innerHTML;
    code = code.split('&lt;').join('<').split('&gt;').join('>');
    var function_name_context = code.split('function ');
    if(function_name_context.length == 1) 
        return
    function_name = function_name_context[1].split('(')[0];
    eval(code);
    
    var text = document.getElementById("testing_area").value;
    chunks = text.split('<')
    plain_text = chunks[0] + chunks.slice(1).map(function(chunk) {return chunk.split('>')[1]}).join('');
    document.getElementById("testing_pre").innerHTML = eval(function_name + '(plain_text);');
}
    </script>
  </head>
  <body>
    <center>
    <h1>
Lexical highlighting vs. syntax highlighting
    </h1>
    <p>
...
    </p>
    <form>
    Separators:
    <br>
    <textarea id="separators_list" rows=2>['\n', ' ', '\t', '.', ',', ':', '=', '[', ']']</textarea>
    <br>
    <br>
    <input type="checkbox" id="do_quotes" checked /><label for="do_quotes">Quotes</label>
    <br>
    <textarea id="quotes_list" rows=2>['\'', '"']</textarea>
    <br>
    <br>
    <input type="checkbox" id="do_brackets" checked /><label for="do_brackets">Brackets</label>
    <br>
    <textarea id="brackets_list" rows=2>[['/*', '*/'], [';', '\n']]</textarea>
    <br>
    <br>
    Function name:
    <br>
    <input type="text" id="function_name" value="colorized">
    <br>
    <br>
    <button type="button" style="width: auto;" onclick="generate_highlighter_code()">Generate the highlighter</button><br>
    </form>
    
    <table><tr>
    <td>
    <pre id="highlighter_code">
... here will be the highlighter code...
    </pre>
    </td></tr></table>
    
    <form>
    Testing area:
    <textarea id="testing_area" rows=25 onInput="highlight_test_area()">
.data 
/* some sample strings */
ClassName db "SimpleWinClass", 0
AppName  db " ", 0

.code
/* some sample code */

; increment counter
.elseif wParam=='I'
    mov esi, offset counter_values
    mov ecx, i
    mov eax, [esi + ecx*4]
    inc eax
    mov [esi + ecx*4], eax
; decrement counter
.elseif wParam=='D'
    mov esi, offset counter_values
    mov ecx, i
    mov eax, [esi + ecx*4]
    dec eax
    mov [esi + ecx*4], eax
</textarea>
    <pre id="testing_pre"></pre>
    </form>

    <script language="JavaScript">
    generate_highlighter_code();
    </script>


    <table class="footer" style="width: 555pt; padding: 64pt 0pt 32pt 0pt; background-color: transparent; font-family: sans-serif; font-size: 16pt; font-style: normal;">
    <tr>
    <td class="footer" style="vertical-align: middle; text-align: left; width: 64px; padding: 0; margin: 0; border: 0;">
        <a href="index.html"><img src="favicon.ico"></a>
    </td>
    <td class="footer" style="vertical-align: middle; text-align: left; width: 200pt; padding: 0; margin: 0; border: 0;">
        &nbsp;&larr; there's more.
    </td>
    <td class="footer" style="vertical-align: middle; text-align: right; width: 300pt; padding: 0; margin: 0; border: 0;">
        +
        <a href="https://github.com/akalenuk/wordsandbuttons">Github</a> &
        <a href="https://twitter.com/wordsandbuttons">Twitter</a> &
        <a href="https://news.ycombinator.com/from?site=wordsandbuttons.online">Hacker News</a>
    </td>
    </tr>
    </table>
    </center>
  </body>
</html>
