<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Can you tell an assembly code when you see one?</title>
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
    <style>
body{
    margin: 0 0 0 0;
}

a{
    text-decoration: none;
}

h1 {
    padding-top: 32pt;
    font-size: 24pt;
    width: 600pt;
    text-align: left;
}

h2 {
    padding-top: 16pt;
    font-size: 20pt;
    width: 555pt;
    text-align: left;
}

p {
    font-size: 16pt;
    width: 505pt;
    text-align: left;
}

.footer {
    margin-top: 64pt;
    padding-bottom: 32pt;
    font-family: sans-serif;
    font-size: 14pt;
}

pre {
    margin: 0 0 0 0;
    padding-top: 12pt;
    padding-left: 12pt;
    padding-right: 12pt;
    padding-bottom: 12pt;
    font-size: 12pt;
    text-align: left;
    width: 300pt;
}

.code_piece {
    font-family: monospace;
    padding-left: 4pt;
    padding-right: 4pt;
}


table {
    border-width: 0pt;
}

td {
    vertical-align: top;
    padding: 6pt 12pt 6pt 12pt;
    font-size: 16pt;
    border: 1px solid black;
    width: 600pt;
}

button{
    width: 248pt;
    height: 42pt;
    margin-left:4pt;
    margin-right:4pt;
    font-size: 16pt;
}

u {
    border-bottom: 1px dotted #000;
    text-decoration: none;
    cursor: pointer;
}
    </style>
    <script language="JavaScript">
function show(n){
    document.getElementById("shown_" + n).style.display = "none";
    document.getElementById("hidden_" + n).style.display = "inline";
}
    </script>
  </head>
  <body>
    <center>
    <h1>
Can you tell an assembly code when you see one?
    </h1>
    <p>
Assembly programming is nowadays seen as niche at best. And more often than not as needlessly meticulous, demanding, and wasteful even for its niches. 
    </p>
    <p>
Assembly is hard. It is unfriendly. Programming in assembly is slow and error-prone. This is the conventional wisdom.
    </p>
    <p>
Unfortunately, this wisdom is mostly nurtured by people who have little or none idea of what modern assembly programming looks like. Assembly programming didn't stay in the 50s, it evolved along with high-level languages incorporating structural, functional, and objective-oriented programming elements. It plays well with modern APIs and DOMs. It is, of course, conceptually low-level but you can build rather high-level abstractions on top of it.
    </p>
    <p>
In fact, I'm not even sure that one can always tell assembly code from some high-level source without googling. Can you?
    </p>

    <h2>
GUI with WinAPI
    </h2>
    <p>
Here is a piece of code. The task is simple. Look at it and decide if it is some variant of assembly or is it written in some high-level language.
    </p>    
    <table><tr>
    <td>
    <pre>
nMain proc hInst:HINSTANCE,hPrevInst:HINSTANCE,CmdLine:LPSTR,CmdShow:DWORD 
    LOCAL wc:WNDCLASSEX       ; create local variables on stack 
    LOCAL msg:MSG 
    LOCAL hwnd:HWND

    mov   wc.cbSize,SIZEOF WNDCLASSEX      ; fill values in members of wc 
    mov   wc.style, CS_HREDRAW or CS_VREDRAW 
    mov   wc.lpfnWndProc, OFFSET WndProc 
    mov   wc.cbClsExtra,NULL 
    mov   wc.cbWndExtra,NULL 
    push  hInstance 
    pop   wc.hInstance 
    mov   wc.hbrBackground,COLOR_WINDOW+1 
    mov   wc.lpszMenuName,NULL 
    mov   wc.lpszClassName,OFFSET ClassName 
    invoke LoadIcon,NULL,IDI_APPLICATION 
    mov   wc.hIcon,eax 
    mov   wc.hIconSm,eax 
    invoke LoadCursor,NULL,IDC_ARROW 
    mov   wc.hCursor,eax 
    invoke RegisterClassEx, addr wc        ; register our window class 
    invoke CreateWindowEx,NULL, 
        ADDR ClassName, ADDR AppName,\ 
        WS_OVERLAPPEDWINDOW,\ 
        CW_USEDEFAULT, CW_USEDEFAULT,\ 
        CW_USEDEFAULT, CW_USEDEFAULT,\ 
        NULL, NULL, hInst, NULL 
    mov   hwnd,eax 
    invoke ShowWindow, hwnd,CmdShow        ; display our window on desktop 
    invoke UpdateWindow, hwnd              ; refresh the client area

    .WHILE TRUE                            ; Enter message loop 
                invoke GetMessage, ADDR msg,NULL,0,0 
                .BREAK .IF (!eax) 
                invoke TranslateMessage, ADDR msg 
                invoke DispatchMessage, ADDR msg 
   .ENDW 
    mov     eax,msg.wParam                 ; return exit code in eax 
    ret 
WinMain endp
    </pre>
    </td>
    </td></tr></table>
    <p>
    <div id="shown_1">
        <button type="button" onclick="show(1)">This is assembly</button>
        <button type="button" onclick="show(1)">This is something else</button>
    </div>
    <div id="hidden_1" style="display:none;">
        <p>
This is written in <a href="http://www.masm32.com/">MASM32</a>. It is a set of macroses and libraries over Microsoft Assembler. It works wonders with WinAPI and it is relatively simple. You can get started with it rather easily, and while creating and mantaining huge applications remains an issue, making simple, clean and fast things with it is a pleasure not a burden. 
        </p>
        <p>
Source: Iczelion's Win32 Assembly Homepage, Tutorial 3: A Simple Window. <a href="http://win32assembly.programminghorizon.com/tut3.html">http://win32assembly.programminghorizon.com/tut3.html</a>
        </p>
    </div>

    <h2>
Functional interface
    </h2>
    <p>
This is a one function library. The function “add” adds two integer numbers and returns their sum.
    </p>    
    <table><tr>
    <td>
    <pre>
(module
  (func $add (param $lhs i32) (param $rhs i32) (result i32)
    get_local $lhs
    get_local $rhs
    i32.add)
  (export "add" (func $add))
)
    </pre>
    </td>
    </td></tr></table>
    <p>
    <div id="shown_2">
        <button type="button" onclick="show(2)">This is assembly</button>
        <button type="button" onclick="show(2)">This is something else</button>
    </div>
    <div id="hidden_2" style="display:none;">
        <p>
This is WebAssembly. Although the main idea behind it is providing binary code for the web regardless of the source language, it is also a legitimate assembly language. You can write programms for the web in it.
        </p>
        <p>
Source: WebAssembly <a href="https://github.com/mdn/webassembly-examples/blob/master/understanding-text-format/add.wat">examples</a> referenced from the official site: <a href="https://developer.mozilla.org/en-US/docs/WebAssembly">https://developer.mozilla.org/en-US/docs/WebAssembly</a>.
        </p>
    </div>

    <h2>
Algorithms
    </h2>
    <p>
This is a TPK algorithm implementation. I contains a function, a few loops, an array, and some console output.
    </p>    
    <table><tr>
    <td>
    <pre>
1   c@VA t@IC x@½C y@RC z@NC
2   INTEGERS +5 →c
3           →t
4       +t      TESTA Z
5       -t
6               ENTRY Z
7   SUBROUTINE 6→z
8       +tt→y→z
9       +tx→y→x
10  +z+cx   CLOSE WRITE 1

11  a@/½ b@MA c@GA d@OA e@PA f#HA i@VE x@ME
12  INTEGERS +20 →b +10 →c +400 →d +999 →e +1 →f
13  LOOP 10n
14      n→x
15  +b-x→x
16      x→q
17  SUBROUTINE 5 →aq
18  REPEAT n
16      +c →i
20  LOOP 10n
21      +an SUBROUTINE 1 →y
22      +d-y TESTA Z
23      +i SUBROUTINE 3
24      +e SUBROUTINE 4
25              CONTROL X
26              ENTRY Z
27      +i SUBROUTINE 3
28      +y SUBROUTINE 4
29              ENTRY X
30      +i→f→i
31  REPEAT n
32  ENTRY A CONTROL A WRITE 2 START 2
    </pre>
    </td>
    </td></tr></table>
    <p>
    <div id="shown_3">
        <button type="button" onclick="show(3)">This is assembly</button>
        <button type="button" onclick="show(3)">This is something else</button>
    </div>
    <div id="hidden_3" style="display:none;">
        <p>
This is not an assembly. It is Glennie's AUTOCODE — one of the first high-level languages ever. 
        </p>
        <p>
Source: <a href="http://bitsavers.trailing-edge.com/pdf/stanford/cs_techReports/STAN-CS-76-562_EarlyDevelPgmgLang_Aug76.pdf">The Early Development Of Programming Languages</a> by Donald E. Knuth, Luis Trabb Pardo, 1976.
        </p>
        <p>
By the way, TPK stands for "Typical Pardo Knuth". It was deliberately made up to showcase a bunch of languages on a single example.
        </p>
    </div>

    <h2>
Structural programming
    </h2>
    <p>
Here is the example of super-scalar sum calculation.
    </p>    
    <table><tr>
    <td>
    <pre>
v0 = my_vector              // we want the horizontal sum of this
int64 r0 = get_len ( v0 )
int64 r0 = round_u2 ( r0 )
float v0 = set_len ( r0 , v0 )
while ( uint64 r0 > 4) {
	uint64 r0 > >= 1
	float v1 = shift_reduce ( r0 , v0 )
	float v0 = v1 + v0
}
// The sum is now a scalar in v0  
    </pre>
    </td>
    </td></tr></table>
    <p>
    <div id="shown_4">
        <button type="button" onclick="show(4)">This is assembly</button>
        <button type="button" onclick="show(4)">This is something else</button>
    </div>
    <div id="hidden_4" style="display:none;">
        <p>
This is ForwardCom assembly language. Agner Fog, who is among all other things the author of popular optimization manuals and a living inspiration for us all, proposes this syntax as more friendly to C programmers. Syntax is not essential for computers, but since this is more conventional for people, it probably is a good idea to make C-like assembly.
        </p>
        <p>
Source: code examples from <a href="https://github.com/ForwardCom/manual/blob/master/forwardcom.pdf">ForwardCom: An open-standard instruction set for high-performance microprocessors</a> by Agner Fog.
        </p>
    </div>

    <h2>
Classes and methods
    </h2>
    <p>
...    
    </p>    
    <table><tr>
    <td>
    <pre>
// Metadata version: v2.0.50215
.assembly extern mscorlib
{
  .publickeytoken = (B7 7A 5C 56 19 34 E0 89 )
  .ver 2:0:0:0
}
.assembly sample
{
  .custom instance void [mscorlib]System.Runtime.CompilerServices
    .CompilationRelaxationsAttribute::.ctor(int32) = 
      ( 01 00 08 00 00 00 00 00 )
  .hash algorithm 0x00008004
  .ver 0:0:0:0
}
.module sample.exe
// MVID: {A224F460-A049-4A03-9E71-80A36DBBBCD3}
.imagebase 0x00400000
.file alignment 0x00000200
.stackreserve 0x00100000
.subsystem 0x0003       // WINDOWS_CUI
.corflags 0x00000001    //  ILONLY
// Image base: 0x02F20000

// =============== CLASS MEMBERS DECLARATION ===================

.class public auto ansi beforefieldinit Hello
       extends [mscorlib]System.Object
{
  .method public hidebysig static void  Main(string[] args) cil managed
  {
    .entrypoint
    // Code size       13 (0xd)
    .maxstack  8
    IL_0000:  nop
    IL_0001:  ldstr      "Hello World!"
    IL_0006:  call       void [mscorlib]System.Console::WriteLine(string)
    IL_000b:  nop
    IL_000c:  ret
  } // end of method Hello::Main

  .method public hidebysig specialname rtspecialname
          instance void  .ctor() cil managed
  {
    // Code size       7 (0x7)
    .maxstack  8
    IL_0000:  ldarg.0
    IL_0001:  call       instance void [mscorlib]System.Object::.ctor()
    IL_0006:  ret
  } // end of method Hello::.ctor

} // end of class Hello
    </pre>
    </td>
    </td></tr></table>
    <p>
    <div id="shown_5">
        <button type="button" onclick="show(5)">This is assembly</button>
        <button type="button" onclick="show(5)">This is something else</button>
    </div>
    <div id="hidden_5" style="display:none;">
        <p>
ilasm
Source: <a href="https://docs.microsoft.com/en-us/dotnet/framework/tools/ilasm-exe-il-assembler">https://docs.microsoft.com/en-us/dotnet/framework/tools/ilasm-exe-il-assembler</a>
Examples
        </p>
    </div>

    <h2>
Objects and messages
    </h2>
    <p>
...    
    </p>    
    <table><tr>
    <td>
    <pre>
Namespace current addSubspace: #SimpleTCP!
Namespace current: SimpleTCP!

"A simple TCP server"
Object subclass: #Server
  instanceVariableNames: 'serverSocket socketHandler'
  classVariableNames: ''
  poolDictionaries: ''
  category: ''!

!Server class methodsFor: 'instance creation'!

new: aServerSocket handler: aHandler
  | simpleServer |
  simpleServer := super new.
  simpleServer socket: aServerSocket.
  simpleServer handler: aHandler.
  simpleServer init.
  ^simpleServer
!!

!Server methodsFor: 'initialization'!

init
  ^self
!!

!Server methodsFor: 'accessing'!

socket
  ^serverSocket
!

socket: aServerSocket
  serverSocket := aServerSocket.
  ^self
!

handler
  ^socketHandler
!

handler: aHandler
  socketHandler := aHandler.
  ^self
!!

!Server methodsFor: 'running'!

run
  | s |
  [
    serverSocket waitForConnection.
    s := (serverSocket accept).
    self handle: s
  ] repeat
!

!Server methodsFor: 'handling'!

handle: aSocket
  socketHandler handle: aSocket
!!
    </pre>
    </td>
    </td></tr></table>
    <p>
    <div id="shown_6">
        <button type="button" onclick="show(6)">This is assembly</button>
        <button type="button" onclick="show(6)">This is something else</button>
    </div>
    <div id="hidden_6" style="display:none;">
        <p>
GNU SmallTalk
Source: <a href="https://sblinn.jottit.com/gnu_smalltalk_simplechat_tcp_server">https://sblinn.jottit.com/gnu_smalltalk_simplechat_tcp_server</a>
<a href="http://smalltalk.gnu.org/wiki/examples">http://smalltalk.gnu.org/wiki/examples</a>
Building a simple chat server with GNU Smalltalk using class inheritance
        </p>
    </div>

    <h2>
Console application
    </h2>
    <p>
...    
    </p>    
    <table><tr>
    <td>
    <pre>
GET "LIBHDR"

GLOBAL $(
        COUNT: 200
        ALL: 201
$)

LET TRY(LD, ROW, RD) BE
        TEST ROW = ALL THEN
                COUNT := COUNT + 1
        ELSE $(
                LET POSS = ALL & ~(LD | ROW | RD)
                UNTIL POSS = 0 DO $(
                        LET P = POSS & -POSS
                        POSS := POSS - P
                        TRY(LD + P << 1, ROW + P, RD + P >> 1)
                $)
        $)

LET START() = VALOF $(
        ALL := 1
        FOR I = 1 TO 12 DO $(
                COUNT := 0
                TRY(0, 0, 0)
                WRITEF("%I2-QUEENS PROBLEM HAS %I5 SOLUTIONS*N", I, COUNT)
                ALL := 2 * ALL + 1
        $)
        RESULTIS 0
$)
    </pre>
    </td>
    </td></tr></table>
    <p>
    <div id="shown_7">
        <button type="button" onclick="show(7)">This is assembly</button>
        <button type="button" onclick="show(7)">This is something else</button>
    </div>
    <div id="hidden_7" style="display:none;">
        <p>
BCPL
Source: <a href="https://en.wikipedia.org/wiki/BCPL#Examples">https://en.wikipedia.org/wiki/BCPL#Examples</a>
BCPL From Wikipedia, the free encyclopedia
        </p>
    </div>

    <h2>
Another concole application
    </h2>
    <p>
...    
    </p>    
    <table><tr>
    <td>
    <pre>
<<console_input_output.min>>
<<branching.min>>
<<instructions.min>>

.assembly extern mscorlib {}

.assembly hello
{
    .ver 1:0:1:0
}

.module hello.exe

.method static void main() cil managed
{
        .maxstack 2
        .entrypoint
    
        .locals init (int32 a, int32 b)

        ((write: "Input positive x: "))
        ((read line))
        ((parse it as int32))
        ((store it as local a))
        ((check if ((local a)) > ((int32 0)) ))
        ((if so {{
                    ((write: "It is positive!\n")) 
                    ((load int32 2))
                    ((store it as local b))
                     
                    ((write: "x * 2 = "))

                    ((load local a))
                    ((load local b))
                    ((multiply them))

                    ((write int32))      
                    ((write line: ""))      
            }}else{{
                    ((write: "It isn't positive.\n"))
            }} 
        ))
        ((read line))           
        ((return))
}
    </pre>
    </td>
    </td></tr></table>
    <p>
    <div id="shown_8">
        <button type="button" onclick="show(8)">This is assembly</button>
        <button type="button" onclick="show(8)">This is something else</button>
    </div>
    <div id="hidden_8" style="display:none;">
        <p>
milasm
Source: <a href="https://github.com/akalenuk/milasm">https://github.com/akalenuk/milasm</a>
        </p>
    </div>

    <h2>
Conclusion
    </h2>
    <p>
...
    </p>


    <p class="footer">
    There are more words and buttons on <a href="index.html">wordsandbuttons.online</a>.<br>
    Also please follow us on <a href="https://twitter.com/wordsandbuttons">Twitter</a>.
    </p>
    </center>
  </body>
</html>
