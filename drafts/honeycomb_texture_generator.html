<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Honeycomb texture generator</title>
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
    <style>
body {
    margin: 0 0 0 0;
}

a {
    text-decoration: none;
}

h1 {
    padding-top: 36pt;
    font-size: 24pt;
    width: 600pt;
    text-align: left;
}

h2 {
    padding-top: 20pt;
    font-size: 20pt;
    width: 555pt;
    text-align: left;
}

p {
    line-height: 1.42;
    font-size: 16pt;
    width: 505pt;
    text-align: left;
}

pre {
    margin: 0 0 0 0;
    padding-top: 12pt;
    padding-left: 12pt;
    padding-right: 12pt;
    padding-bottom: 12pt;
    font-size: 12pt;
    text-align: left;
    width: 300pt;
}

table {
    border-width: 0pt;
}

td {
    vertical-align: top;
    padding: 6pt 12pt 6pt 12pt;
    font-size: 16pt;
    border: 1px solid black;
    width: 600pt;
}

button {
    width: 248pt;
    height: 42pt;
    margin-left:4pt;
    margin-right:4pt;
    font-size: 16pt;
}

u {
    border-bottom: 1px dotted #000;
    text-decoration: none;
    cursor: pointer;
}

textarea {
    width: 505pt;
    font-size: 12pt;
    font-family: monospace;
}

.comment {
    font-size: 12pt;
    text-align:center;
    font-family: sans-serif;
    padding-bottom: 24pt;
}

form {
    margin: 0 0 0 0;
    padding-top: 12pt;
    padding-left: 12pt;
    padding-right: 12pt;
    padding-bottom: 12pt;
    font-size: 16pt;
    text-align: left;
    width: 505pt;
    background-color: #eeee99;
    color: #000;
}

input[type="text"] {
    width: 32pt;
    height: 22pt;
    font-size: 16pt;
    text-align: center;
}

button {
    width: 32pt;
    height: 26pt;
    font-size: 16pt;
    text-align: center;
}

    </style>
    <script language="JavaScript">
const rational_a = 56;
const rational_b = 97;

// honecomb lines in a pixel grid
var lines_scale = 2;
var lines_do_flip = false;
function noheycomb_lines(scale, do_flip) {
    const sceleton = [
    [[0, 0], [1, 0]],
    [[1, 0], [2, 1]],
    [[2, 1], [4, 1]],
    [[4, 1], [5, 0]],
    [[5, 0], [6, 0]],

    [[0, 2], [1, 2]],
    [[1, 2], [2, 1]],
    [[1, 2], [2, 3]],
    [[4, 1], [5, 2]],
    [[4, 3], [5, 2]],
    [[5, 2], [6, 2]],

    [[0, 4], [1, 4]],
    [[1, 4], [2, 3]],
    [[2, 3], [4, 3]],
    [[4, 3], [5, 4]],
    [[5, 4], [6, 4]]]

    var lines = []
    for(var i = 0; i < sceleton.length; ++i) {
        const a1 = sceleton[i][0][0] * rational_a * scale;
        const b1 = sceleton[i][0][1] * rational_b * scale;
        const a2 = sceleton[i][1][0] * rational_a * scale;
        const b2 = sceleton[i][1][1] * rational_b * scale;
        if(do_flip) {
            lines.push([[b1,a1], [b2,a2]]);
        } else {
            lines.push([[a1,b1], [a2,b2]]);
        }
    }
    return lines;
}

function dot(a1, a2, b1, b2) {
    return a1 * b1 + a2 * b2;
}

function distance_to_segment(lp1x, lp1y, lp2x, lp2y, px, py) {
    var t_proj = dot(px - lp1x, py - lp1y, lp2x - lp1x, lp2y - lp1y) / dot(lp2x - lp1x, lp2y - lp1y, lp2x - lp1x, lp2y - lp1y);
    if (isNaN(t_proj))
        t_proj = 0.0;
    else if (t_proj < 0.0)
        t_proj = 0.0;
    else if (t_proj > 1.0)
        t_proj = 1.0;
    var p_proj_x = lp1x + (lp2x - lp1x) * t_proj;
    var p_proj_y = lp1y + (lp2y - lp1y) * t_proj;
    return Math.sqrt(dot(p_proj_x - px, p_proj_y - py, p_proj_x - px, p_proj_y - py));
}

function distance_to_line_segment(line, px, py) {
    return distance_to_segment(line[0][0], line[0][1], line[1][0], line[1][1], px, py);
}

function d_lines(x, y, lines) {
    var d = Number.MAX_VALUE; // everything is out
    for (var i = 0; i < lines.length; ++i)
        d = Math.min(d, distance_to_line_segment(lines[i], x, y));
    return d;
}

</script>
<script language="JavaScript" id="honeycomb_script">
function color_from_d(d) {
    return 0;
}
</script>
<script language="JavaScript">
function reevaluate(thing) {
    var script = document.getElementById(thing + "_script");
    if (script) {
        script.parentNode.removeChild(script);
    }
    // this may be overidden by the error
    document.getElementById(thing + "_comment").innerHTML = "This code is changeable.";

    var code = document.getElementById(thing + "_code");
    script = document.createElement('script');
    script.id = thing + "_script";

    script.text = "function color_from_d(d){"
    + "try{"
    + code.value
    + "}catch(error){"
    + "document.getElementById('" + thing + "_comment').innerHTML = '<b>Error:</b> ' + error.message;"
    + "}}";

    document.body.appendChild(script);
}

function draw_honeycomb(){
    var canvas = document.getElementById("honeycomb");
    var context = canvas.getContext("2d");

    // lines
    var lines = noheycomb_lines(lines_scale, lines_do_flip);
    var w = lines_do_flip ? (rational_b * 4 * lines_scale) : (rational_a * 6 * lines_scale);
    var h = lines_do_flip ? (rational_a * 6 * lines_scale) : (rational_b * 4 * lines_scale);
    canvas.width = w;
    canvas.height = h;

    // background
    context.fillStyle="#FFFFFF";
    context.fillRect(0, 0, w, h);

    // lines
    var pixel_field = context.createImageData(w, h);
    for (var i = 0; i < pixel_field.data.length; i += 4) {
        const x = (i / 4) % w;
        const y = (i / 4) / w;
        const d = d_lines(x, y, lines);
        const color = color_from_d(d);
        pixel_field.data[i + 0] = color;
        pixel_field.data[i + 1] = color;
        pixel_field.data[i + 2] = color;
        pixel_field.data[i + 3] = 0xFF;
    }
    context.putImageData(pixel_field, -0.5, -0.5);
}

function change_lines_scale() {
    lines_scale = Number(document.getElementById("lines_scale").value);
    if(isNaN(lines_scale) || lines_scale < 1.0) {
        lines_scale = 1.0;
    }
    document.getElementById("lines_scale").value = lines_scale;
    draw_honeycomb();
}

function change_line_width() {
    compose_the_code();
}

function change_line_attenuation() {
    compose_the_code();
}

function change_line_attenuation_function() {
    compose_the_code();
}

function inc(counter_name) {
    var counter = document.getElementById(counter_name);
    counter.value = Number(counter.value) + 1;
    eval('change_' + counter_name + '()');
}

function dec(counter_name) {
    var counter = document.getElementById(counter_name);
    counter.value = Number(counter.value) - 1;
    eval('change_' + counter_name + '()');
}

function compose_the_code() {
    var code = "// input: d - distance to the nearest honeycomb segment\n\
// output: color - a number in range [0..255]\n\
const black = 0x00;\n\
const white = 0xFF;\n\
const width = " + document.getElementById("line_width").value + ";\n\
const attenuation_width = " + document.getElementById("line_attenuation").value + ";\n\
function attenuation_f(d) {";
    if(document.getElementById("linear").checked) {
        code += "\n\
    const d_norm = d / attenuation_width;\n\
    const a_norm = d_norm;\n\
    return black + a_norm * (white - black);";  
    }
    if(document.getElementById("cos").checked) {
        code += "\n\
    const d_norm = d / attenuation_width;\n\
    const a_norm = (1 - Math.cos(d_norm * Math.PI)) / 2;\n\
    return black + a_norm * (white - black);";
    }
    code += "\n\
};\n\
if(d < width)\n\
    return black;\n\
d -= width;\n\
if(d < attenuation_width)\n\
    return attenuation_f(d);\n\
return white;\n";
    document.getElementById("honeycomb_code").value = code;
    reevaluate('honeycomb');
    draw_honeycomb();
}

function show(n){
    document.getElementById("shown_" + n).style.display = "none";
    document.getElementById("hidden_" + n).style.display = "inline";
}
    </script>
  </head>
  <body>
    <center>
    <h1>
Honeycomb texture generator
    </h1>
    <p>
...
    </p>
    <canvas id="honeycomb" width="672" height="776"></canvas>
    <br>
    <form id="interface" onsubmit="return false;">
    <span style="line-height: 2.0;">
    Canvas scale:
    <button type="button" onclick="dec('lines_scale')">-</button>
    <input type="text" id="lines_scale" value="2" oninput="change_lines_scale();">
    <button type="button" onclick="inc('lines_scale')">+</button>
    <br>
    Black line width:
    <button type="button" onclick="dec('line_width')">-</button>
    <input type="text" id="line_width" value="12" oninput="change_line_width();">
    <button type="button" onclick="inc('line_width')">+</button>
    <br>
    Black line attenuation:
    <button type="button" onclick="dec('line_attenuation')">-</button>
    <input type="text" id="line_attenuation" value="3" oninput="change_line_attenuation();">
    <button type="button" onclick="inc('line_attenuation')">+</button>
    <br>
    </span>
    <span style="line-height: 1.42;">
    Please select the attenuation function:
    <br>
    <input type="radio" name="af" id="linear" value="linear" onclick="change_line_attenuation_function();"><label for="linear">linear</label>;
    <br>
    <input type="radio" name="af" id="cos" value="cos" onclick="change_line_attenuation_function();" checked><label for="cos">cosine</label>.
    </span>
    <br>
    <textarea id="honeycomb_code" rows=22 onInput="reevaluate('honeycomb'); draw_honeycomb()">// input: d - distance to the nearest honeycomb segment
// output: color - a number in range [0..255]
const black = 0x00;
const white = 0xFF;
const width = 12;
const attenuation_width = 3;
function attenuation_f(d) {
    const d_norm = d / attenuation_width;
    const a_norm = (1 - Math.cos(d_norm * Math.PI)) / 2;
    return black + a_norm * (white - black);
};
if(d &lt; width)
    return black;
d -= width;
if(d &lt; attenuation_width)
    return attenuation_f(d);
return white;
</textarea>
    </form>
    <p id="honeycomb_comment" class="comment"></p>


    <p>
...
    </p>

    <script language="JavaScript">
reevaluate('honeycomb');
draw_honeycomb();
    </script>


    <table class="footer" style="width: 555pt; padding: 64pt 0pt 32pt 0pt; background-color: transparent; font-family: sans-serif; font-size: 16pt; font-style: normal;">
    <tr>
    <td class="footer" style="vertical-align: middle; text-align: left; width: 64px; padding: 0; margin: 0; border: 0;">
        <a href="index.html"><img src="favicon.ico"></a>
    </td>
    <td class="footer" style="vertical-align: middle; text-align: left; width: 200pt; padding: 0; margin: 0; border: 0;">
        &nbsp;&larr; there's more.
    </td>
    <td class="footer" style="vertical-align: middle; text-align: right; width: 300pt; padding: 0; margin: 0; border: 0;">
        +
        <a href="https://github.com/akalenuk/wordsandbuttons">Github</a> &
        <a href="https://twitter.com/wordsandbuttons">Twitter</a> &
        <a href="https://news.ycombinator.com/from?site=wordsandbuttons.online">Hacker News</a>
    </td>
    </tr>
    </table>
    </center>
  </body>
</html>
