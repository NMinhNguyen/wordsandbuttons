<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Binary search</title>
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
    <style>
body {
    margin: 0 0 0 0;
}

a {
    text-decoration: none;
}

h1 {
    padding-top: 36pt;
    font-size: 24pt;
    width: 600pt;
    text-align: left;
}

h2 {
    padding-top: 20pt;
    font-size: 20pt;
    width: 555pt;
    text-align: left;
}

p {
    line-height: 1.42;
    font-size: 16pt;
    width: 505pt;
    text-align: left;
}

form {
    margin: 0 0 0 0;
    padding-top: 12pt;
    padding-left: 12pt;
    padding-right: 12pt;
    padding-bottom: 12pt;
    font-size: 16pt;
    text-align: left;
    width: 505pt;
    background-color: #eeee99;
    color: #000;
}
    </style>
    <script language="JavaScript">
var values = [];
var target = 320;
var path = [];
var proportion = 0.5;

function uniform_ascending() {
    var values = [];
    for(var i = 0; i < 640; ++i)
        values.push(Math.floor(Math.random()*640));
    values.sort(function(a, b){return a - b});
    return values;
}

function scewed_to_high_ascending() {
    var values = [];
    for(var i = 0; i < 640; ++i)
        values.push(Math.floor(Math.sin(Math.random() * Math.PI / 2.) * 640));
    values.sort(function(a, b){return a - b});
    return values;
}

function less_in_the_middle_ascending() {
    var values = [];
    for(var i = 0; i < 640; ++i)
        values.push(Math.floor((Math.sin(Math.random() * Math.PI - Math.PI / 2.) + 1.) / 2. *640));
    values.sort(function(a, b){return a - b});
    return values;
}

var values = uniform_ascending();

function search_path(a, b, proportion) {
    if(a == b)
        return [[a, b]]
    const mid = Math.floor((a+b) * proportion);
    if(values[mid] < target)
        return [[a, b]].concat(search_path(mid + 1, b, proportion));
    else
        return [[a, b]].concat(search_path(a, mid, proportion));
}

path = search_path(0, 639, proportion);

function init_search() {
    var canvas = document.getElementById("search");
    canvas.addEventListener('mousedown', function(e){
        canvas_rect = canvas.getBoundingClientRect();
        const x = e.clientX - canvas_rect.left;
        const y = e.clientY - canvas_rect.top;
        target = Math.floor(640 - y);
        path = search_path(0, 639, proportion);
        draw_search();
    }, false);

    canvas.addEventListener('mousemove', function(e){
        canvas_rect = canvas.getBoundingClientRect();
        const x = e.clientX - canvas_rect.left;
        const y = e.clientY - canvas_rect.top;
        if(e.buttons == 1){
            target = Math.floor(640 - y);
            path = search_path(0, 639, proportion);
        }
        draw_search();
    }, false);

    canvas.addEventListener('mouseup', function(e){
        draw_search();
    }, false);

    canvas.addEventListener('mouseleave', function(e){
        draw_search();
    }, false);

    draw_search();
}

function draw_search(){
    var canvas = document.getElementById("search");
    var context = canvas.getContext("2d");

    // background
    context.fillStyle="#eeeeee";
    context.fillRect(0, 0, 640, 640);

    // data
    const light_gray = 11 * 8;
    context.strokeStyle='rgb('+light_gray+', '+light_gray+', '+light_gray+')';
    context.lineWidth = 1;
    context.beginPath()    
    for(var i = 0; i < 640; ++i) {
        context.moveTo(i, 640);
        context.lineTo(i, 640 - values[i]);
    }
    context.stroke();
    context.closePath();

    // path
    context.lineWidth = 1;
    for(var i = 0; i < path.length; ++i) {
        const gray = (11 - i) * 8;
        context.beginPath()
        context.strokeStyle='rgb('+gray+', '+gray+', '+gray+')';
        for(var j = path[i][0]; j <= path[i][1]; ++j) {
            const value_part = values[j] / Math.pow(1.5, i);
            context.moveTo(j, 640 - values[j]);
            context.lineTo(j, 640);
        }
        context.stroke();
        context.closePath();
    }

    // target
    context.strokeStyle="#000000";
    context.lineWidth = 1;
    context.beginPath()
    context.moveTo(0, 639.5 - target);
    context.lineTo(640, 639.5 - target);
    context.stroke();
    context.closePath();
    
    context.fillStyle="#000000";
    context.font = "16px sans-serif";
    context.textAlign = "left";
    context.textBaseline = "middle";
    context.fillText("Search for " + target + " takes " + path.length + " iterations.", 16, target > 120 ? 640 - target + 24 : 640 - target - 24);
}

    </script>
  </head>
  <body>
    <center>
    <h1>
Binary search
    </h1>
    <p>
...
    </p>
    <canvas id="search" width=640 height=640></canvas>
    <form onsubmit="return false;">
    Distribution: 
    <input type="radio" name="distribution" id="radio_1" onclick="values = uniform_ascending(); draw_search();" checked=true /><label for="radio_1">uniform;</label>
    <input type="radio" name="distribution" id="radio_2" onclick="values = scewed_to_high_ascending(); draw_search();" /><label for="radio_2">skewed;</label>
    <input type="radio" name="distribution" id="radio_3" onclick="values = less_in_the_middle_ascending(); draw_search();" /><label for="radio_3">bi-skewed;</label>
    </form>
    <p>
...
    </p>
    <script language="JavaScript">
    init_search();
    </script>


    <table class="footer" style="width: 555pt; padding: 64pt 0pt 32pt 0pt; background-color: transparent; font-family: sans-serif; font-size: 16pt; font-style: normal;">
    <tr>
    <td class="footer" style="vertical-align: middle; text-align: left; width: 64px; padding: 0; margin: 0; border: 0;">
        <a href="index.html"><img src="favicon.ico"></a>
    </td>
    <td class="footer" style="vertical-align: middle; text-align: left; width: 200pt; padding: 0; margin: 0; border: 0;">
        &nbsp;&larr; there's more.
    </td>
    <td class="footer" style="vertical-align: middle; text-align: right; width: 300pt; padding: 0; margin: 0; border: 0;">
        +
        <a href="https://github.com/akalenuk/wordsandbuttons">Github</a> &
        <a href="https://twitter.com/wordsandbuttons">Twitter</a> &
        <a href="https://news.ycombinator.com/from?site=wordsandbuttons.online">Hacker News</a>
    </td>
    </tr>
    </table>
    </center>
  </body>
</html>
