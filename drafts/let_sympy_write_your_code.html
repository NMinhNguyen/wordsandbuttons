<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Let sympy write your code</title>
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
    <style>
body{
    margin: 0 0 0 0;
}

a{
    text-decoration: none;
}

h1 {
    padding-top: 32pt;
    font-size: 24pt;
    width: 600pt;
    text-align: left;
}

h2 {
    padding-top: 16pt;
    font-size: 20pt;
    width: 555pt;
    text-align: left;
}

p {
    font-size: 16pt;
    width: 505pt;
    text-align: left;
}

pre {
    margin: 0 0 0 0;
    padding-top: 12pt;
    padding-left: 12pt;
    padding-right: 12pt;
    padding-bottom: 12pt;
    font-size: 12pt;
    text-align: left;
    width: 300pt;
}

table {
    border-width: 0pt;
}

td {
    vertical-align: top;
    padding: 6pt 12pt 6pt 12pt;
    font-size: 16pt;
    border: 1px solid black;
    width: 600pt;
}

.comment {
    font-size: 12pt;
    text-align:center;
    font-family: sans-serif;
    padding-bottom: 24pt;
}

button {
    width: 128pt;
    height: 26pt;
    font-size: 16pt;
    text-align: center;
}

textarea {
    width: 600pt;
    font-size: 12pt;
    font-family: monospace;
}

    </style>
    <script language="JavaScript">
function evaluated_sympy(expr) {
    var Symbol = function(x) {
        return x;
    }
    var Integer = function(x) {
        return x.toString();
    }
    var Float = function(x) {
        return parseFloat(x);
    }
    var Rational = function(x, y) {
        return x + '/' + y;
    }

    var Add = function() {
        var args = [];
        for(var i = 0; i < arguments.length; ++i)
            args.push(arguments[i].toString());
        return '(' + args.join('+') + ')';
    }
    var Mul = function() {
        var args = [];
        for(var i = 0; i < arguments.length; ++i)
            args.push(arguments[i].toString());
        return '(' + args.join('*') + ')';
    }
    var Mod = function(x, y) {
        return '(' + x + '%' + y + ')';
    }
    const math_fs = ['abs', 'acos', 'acosh', 'asin', 'asinh', 'atan', 'atanh', 'cbrt', 'ceil', 'clz32', 'cos', 'cosh', 'exp', 'expm1', 'floor', 'fround', 'log', 'log10', 'log1p', 'log2', 'random', 'round', 'sign', 'sin', 'sinh', 'sqrt', 'tan', 'tanh', 'trunc'];
    for(var i = 0; i < math_fs.length; ++i) {
        // abusing lexical scoping
        eval('var ' + math_fs[i] + ' = function(x) { return \'Math.' + math_fs[i] + '(\' + x + \')\'; }');
    }
    var atan2 = function(x, y) {
        return 'Math.atan(' + x + ',' + y + ')';;
    }
    return eval(expr);
}

function make_js() {
    var source = document.getElementById("exprs").value;
    var lines = source.split('\n');
    var js = [];
    try {
        for(var i = 0; i < lines.length; ++i) {
            if(lines[i].includes(',') && lines[i].split(',')[0].split('"').length == 1 && lines[i].includes('(') && lines[i].includes('"')) {
                var expr = lines[i].split('\"')[1];
                var name = lines[i].split(',')[0].split('(')[1].replace('\'', '');  // var name = expr;
                js.push('var ' + name + ' = ' + evaluated_sympy(expr) + ';');
            } else if(lines[i].includes('(') && lines[i].includes('\"')){
                js.push(evaluated_sympy(lines[i].split('\"')[1])); // expression in quotes
            } else if(lines[i].includes('(')){
                js.push(evaluated_sympy(lines[i])); // even without quotes
            } else if(lines[i].trim().length > 0) {
                document.getElementById("make_js_status").innerHTML = "Sorry, can't do this expression:<br>[" + lines[i] + "]";
                return;
            }
        }
        js.sort();
    } catch (error) {
        document.getElementById("make_js_status").innerHTML = "Sorry, can't do these expressions. " + error.message;
        return;
    }
    document.getElementById("exprs").value = js.join('\n');
    document.getElementById("make_js_status").innerHTML = "";
}

function colorized(text) {
    const separators = ['def ', ' for ', ' else', ' if ', ' break', 'return', 'class ', ' in ', 'global ', 
        '\n', ' ', '\t', '.', ',', ':', '=', '[', ']', '(', ')', '+', '-', '*', '/'];
    const quotes = ['\'', '"'];
    const comments = [['#', '\n']];

    function painted_in(line, color) {
        return line.length == 0 ? "" : "<span style=\"color:#" + color + "\">" + line + "</span>";
    }

    function colorized(token) {
        var code_sum = 0;
        for(var i = 0; i < token.length; ++i)
            code_sum += ([1, 7, 11, 13][i % 4] * token.charCodeAt(i));
        var zero_channel = code_sum % 3;
        var color = '' + (zero_channel == 0 ? '3' : '') + (1 + (code_sum % 5) * 2)
            + (zero_channel == 1 ? '3' : '') + (4 + (code_sum % 2) * 5)
            + (zero_channel == 2 ? '3' : '');
        return painted_in(token, color);
    }

    function separated(line, i) {
        if(i == separators.length)
            return colorized(line);
        return line.split(separators[i]).map(function(subline) {
            return separated(subline, i + 1);}).join(separators[i]);
    }

    function unquoted(line, i) {
        if(i == quotes.length)
            return separated(line, 0);
        var chunk_no = 0;
        return line.split('\\' + quotes[i]).join('\0').split(quotes[i]).map(function (chunk) {
            return chunk.split('\0').join('\\' + quotes[i]);}).map(function (chunk) {
                return ++chunk_no % 2  == 1 ? unquoted(chunk, i + 1) : painted_in(quotes[i] + chunk + quotes[i], "555");}).join('');
    }

    function uncommented(line, i) {
        if(i == comments.length)
            return unquoted(line, 0);
        var chunks = line.split(comments[i][0]);
        return uncommented(chunks[0], i + 1) + chunks.slice(1).map( function(chunk) {
            var in_out_comment = chunk.split(comments[i][1]);
            return painted_in(comments[i][0] + in_out_comment[0] + (in_out_comment.length > 1 ? comments[i][1] : ''), "555") 
                + uncommented(in_out_comment.slice(1).join(comments[i][1]), i + 1);}).join('');
    }

    return uncommented(text, 0);
}
    </script>
  </head>
  <body>
    <center>
    <h1>
Let sympy write your code
    </h1>
    <p>
I remember my own struggle with calculus at university. Limits, integrals, differential equiations. Lots of practice, lots of homework. Pages and pages of excercises. I loved the math, the connections between algebra and geometry, the very pleasure of solving the problems by making different concepts work together. But I hated doing the “paper work”.
    </p>
    <p>
Taking it seriously, I still studied through the semester, studied harder the week before the exam, studied even harder the night before. I got 62/100. That's 1 point above the lowest possible passing grade.
    </p>
    <p>
Well, maybe I just suck at math. Now wait a minute! The next semester I took part in a math competition, went through the faculty round, then throught the university round, and scored quite some points on the nationals. That counted as a pass on that semester's exam. 
    </p>
    <p>
Professors were proud of me. They thought that the first semester's score was a mistake. The third semester I scored 65/100.
    </p>
    <p class="comment">
¯\_(ツ)_/¯
    </p>
    <p>
Mathematics is a lot of things. It's a fun of problem solving, it's an excitement of discoveries, it's a pride of accomplishments, and it's a ton of tedious computations, too. I never liked the last part. That's why I'm so happy to live in the XXI century since I can give it away to computers and still enjoy the first three. 
    </p>
    <h2>
SymPy it is
    </h2>
    <p>
    </p>
    <h2>
Example 1.
    </h2>
    <table><tr>
    <td>
    <pre id="code_1">
from sympy import *

a, b, c, d, e, f, g, x = symbols('a b c d e f g x')

sine = a*x**6 + b*x**5 + c*x**4 + d*x**3 + e*x**2 + f*x + g
sine_d = diff(sine, x)
sine_i = integrate(sine, x)

the_system = [
    sine_i.subs(x, pi) - sine_i.subs(x, 0) - 1,  
    sine_d.subs(x, 0) - 1, 
    sine_d.subs(x, pi / 2), 
    sine_d.subs(x, pi) + 1, 
    sine.subs(x, 0), 
    sine.subs(x, pi / 2) - 1, 
    sine.subs(x, pi) 
]

res = solve(the_system, (a, b, c, d, e, f, g))

for var, exp in res.items():
    print(var, srepr(exp))
    </pre>
    </td>
    </tr></table>
    <table><tr>
    <td>
    <pre id="result_1">
(f, 'Integer(1)')
(c, 'Mul(Integer(5), Pow(pi, Integer(-5)), Add(Mul(Integer(-1), Integer(288), pi), Mul(Integer(-1), Integer(19), Pow(pi, Integer(2))), Integer(546)))')
(d, 'Mul(Integer(10), Pow(pi, Integer(-4)), Add(Integer(-126), Mul(Integer(5), Pow(pi, Integer(2))), Mul(Integer(64), pi)))')
(a, 'Mul(Integer(28), Pow(pi, Integer(-7)), Add(Mul(Integer(-1), Integer(16), pi), Mul(Integer(-1), Pow(pi, Integer(2))), Integer(30)))')
(e, 'Mul(Integer(6), Pow(pi, Integer(-3)), Add(Mul(Integer(-1), Integer(16), pi), Mul(Integer(-1), Integer(2), Pow(pi, Integer(2))), Integer(35)))')
(g, 'Integer(0)')
(b, 'Mul(Integer(84), Pow(pi, Integer(-6)), Add(Integer(-30), Pow(pi, Integer(2)), Mul(Integer(16), pi)))')
    </pre>
    </td>
    </tr></table>
    <table><tr>
    <td>
    <pre id="code_2">
from sympy import *
from math import pi

a, b, c, d, e, f, g, x = symbols('a b c d e f g x')

sine = a*x**6 + b*x**5 + c*x**4 + d*x**3 + e*x**2 + f*x + g
sine_d = diff(sine, x)
sine_i = integrate(sine, x)

the_system = [
    sine_i.subs(x, pi) - sine_i.subs(x, 0) - 1,  
    sine_d.subs(x, 0) - 1, 
    sine_d.subs(x, pi / 2), 
    sine_d.subs(x, pi) + 1, 
    sine.subs(x, 0), 
    sine.subs(x, pi / 2) - 1, 
    sine.subs(x, pi) 
]

res = solve(the_system, (a, b, c, d, e, f, g))

for var, exp in res.items():
    print(var, srepr(exp))
    </pre>
    </td>
    </tr></table>
    <table><tr>
    <td>
    <pre id="result_2">
(f, "Float('1.0', precision=53)")
(c, "Float('-8.925915472378545', precision=53)")
(d, "Float('12.77190357848305', precision=53)")
(a, "Float('-0.27937103069338581', precision=53)")
(e, "Float('-6.7737300329085137', precision=53)")
(g, "Float('0.0', precision=53)")
(b, "Float('2.633009932956254', precision=53)")
    </pre>
    </td>
    </tr></table>
    
    <h2>
Example 3.
    </h2>
    <table><tr>
    <td>
    <pre id="code_3">
from sympy import *
from math import pi

ax, bx, cx, dx, ay, by, cy, dy, t = symbols('ax bx cx dx ay by cy dy t')
x1, y1, x2, y2, x3, y3, x4, y4 = symbols('x1 y1 x2 y2 x3 y3 x4 y4')

xt = ax*t**3 + bx*t**2 + cx*t + dx
yt = ay*t**3 + by*t**2 + cy*t + dy

the_x_system = [
    xt.subs(t, 0.) - x1,
    diff(xt, t).subs(t, 0.) - (x2 - x1) / 3.,
    xt.subs(t, 1.) - x4,
    diff(xt, t).subs(t, 1.) + (x3 - x4) / 3.
]

the_y_system = [
    yt.subs(t, 0.) - y1,
    diff(yt, t).subs(t, 0.) - (y2 - y1) / 3.,
    yt.subs(t, 1.) - y4,
    diff(yt, t).subs(t, 1.) + (y3 - y4) / 3.
]

resx = solve(the_x_system, (ax, bx, cx, dx), rational = True)
resy = solve(the_y_system, (ay, by, cy, dy), rational = True)

for var, exp in resx.items():
    print(var, srepr(exp))
    print('')

for var, exp in resy.items():
    print(var, srepr(exp))
    print('')
    </pre>
    </td>
    </tr></table>
    <table><tr>
    <td>
    <pre id="result_3">
(bx, "Add(Mul(Integer(-1), Rational(7, 3), Symbol('x1')), Mul(Integer(-1), Rational(2, 3), Symbol('x2')), Mul(Rational(1, 3), Symbol('x3')), Mul(Rational(8, 3), Symbol('x4')))")
(ax, "Add(Mul(Rational(5, 3), Symbol('x1')), Mul(Rational(1, 3), Symbol('x2')), Mul(Integer(-1), Rational(1, 3), Symbol('x3')), Mul(Integer(-1), Rational(5, 3), Symbol('x4')))")
(dx, "Symbol('x1')")
(cx, "Add(Mul(Integer(-1), Rational(1, 3), Symbol('x1')), Mul(Rational(1, 3), Symbol('x2')))")
(cy, "Add(Mul(Integer(-1), Rational(1, 3), Symbol('y1')), Mul(Rational(1, 3), Symbol('y2')))")
(dy, "Symbol('y1')")
(ay, "Add(Mul(Rational(5, 3), Symbol('y1')), Mul(Rational(1, 3), Symbol('y2')), Mul(Integer(-1), Rational(1, 3), Symbol('y3')), Mul(Integer(-1), Rational(5, 3), Symbol('y4')))")
(by, "Add(Mul(Integer(-1), Rational(7, 3), Symbol('y1')), Mul(Integer(-1), Rational(2, 3), Symbol('y2')), Mul(Rational(1, 3), Symbol('y3')), Mul(Rational(8, 3), Symbol('y4')))")
    </pre>
    </td>
    </tr></table>
        
    <h2>
Math to code
    </h2>
    <textarea id="exprs" rows=28>
(bx, "Add(Mul(Integer(-1), Rational(7, 3), Symbol('x1')), Mul(Integer(-1), Rational(2, 3), Symbol('x2')), Mul(Rational(1, 3), Symbol('x3')), Mul(Rational(8, 3), Symbol('x4')))")

(ax, "Add(Mul(Rational(5, 3), Symbol('x1')), Mul(Rational(1, 3), Symbol('x2')), Mul(Integer(-1), Rational(1, 3), Symbol('x3')), Mul(Integer(-1), Rational(5, 3), Symbol('x4')))")

(dx, "Symbol('x1')")

(cx, "Add(Mul(Integer(-1), Rational(1, 3), Symbol('x1')), Mul(Rational(1, 3), Symbol('x2')))")

(cy, "Add(Mul(Integer(-1), Rational(1, 3), Symbol('y1')), Mul(Rational(1, 3), Symbol('y2')))")

(dy, "Symbol('y1')")

(ay, "Add(Mul(Rational(5, 3), Symbol('y1')), Mul(Rational(1, 3), Symbol('y2')), Mul(Integer(-1), Rational(1, 3), Symbol('y3')), Mul(Integer(-1), Rational(5, 3), Symbol('y4')))")

(by, "Add(Mul(Integer(-1), Rational(7, 3), Symbol('y1')), Mul(Integer(-1), Rational(2, 3), Symbol('y2')), Mul(Rational(1, 3), Symbol('y3')), Mul(Rational(8, 3), Symbol('y4')))")
    </textarea>
    <br>
    <button type="button" id="make_js" onclick="make_js();">Make JS</button>
    <p id="make_js_status" class="comment">
    </p>    
    <p>
...
    </p>
    <script language="JavaScript">
    document.getElementById("code_1").innerHTML = colorized(document.getElementById("code_1").innerHTML);
    document.getElementById("code_2").innerHTML = colorized(document.getElementById("code_2").innerHTML);
    document.getElementById("code_3").innerHTML = colorized(document.getElementById("code_3").innerHTML);        
    </script>


    <table class="footer" style="width: 555pt; padding: 64pt 0pt 32pt 0pt; background-color: transparent; font-family: sans-serif; font-size: 16pt; font-style: normal;">
    <tr>
    <td class="footer" style="vertical-align: middle; text-align: left; width: 64px; padding: 0; margin: 0; border: 0;">
        <a href="index.html"><img src="favicon.ico"></a>
    </td>
    <td class="footer" style="vertical-align: middle; text-align: left; width: 200pt; padding: 0; margin: 0; border: 0;">
        &nbsp;&larr; there's more.
    </td>
    <td class="footer" style="vertical-align: middle; text-align: right; width: 300pt; padding: 0; margin: 0; border: 0;">
        +
        <a href="https://github.com/akalenuk/wordsandbuttons">Github</a> &
        <a href="https://twitter.com/wordsandbuttons">Twitter</a> &
        <a href="https://news.ycombinator.com/from?site=wordsandbuttons.online">Hacker News</a>
    </td>
    </tr>
    </table>
    </center>
  </body>
</html>
