<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Challenge your performance intuition with nanosecond sorting</title>
    <meta name="keywords" content="cpp,quiz,game,learning,c++">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
    <style>
body{
    margin: 0 0 0 0;
}

a{
    text-decoration: none;
}

h1 {
    padding-top: 36pt;
    font-size: 24pt;
    width: 600pt;
    text-align: left;
}

h2 {
    padding-top: 64pt;
    font-size: 20pt;
    width: 555pt;
    text-align: left;
}

p {
    line-height: 1.42;
    font-size: 16pt;
    width: 505pt;
    text-align: left;
}

.comment {
    font-size: 14pt;
    text-align:center;
    font-family: sans-serif;
    padding-bottom: 24pt;
}

table.footer {
    padding: 64pt 0pt 32pt 0pt;
    background-color: transparent;
    width: 505pt;
}

td.footer {
    font-family: sans-serif;
    font-size: 16pt;
    font-style: normal;
    padding: 0;
    margin: 0;
    border: 0;
}

pre {
    margin: 0 0 0 0;
    padding-top: 12pt;
    padding-left: 12pt;
    padding-right: 12pt;
    padding-bottom: 12pt;
    font-size: 12pt;
    text-align: left;
    width: 360pt;
}

table {
    text-align: center;
    border-width: 0pt;
}

td {
    padding: 6pt 12pt 6pt 12pt;
    font-size: 16pt;
    border: 1px solid black;
}

button{
    width: 304pt;
    height: 42pt;
    margin-left:4pt;
    margin-right:4pt;
    font-size: 18pt;
}

    </style>
    <script language="JavaScript">
var slider_set = [false, false, false, false,  false, false, false, false,  false, false];
var slider_true_xs = [
    7.6 / (7.6 + 7.6) * 512,
    7.6 / (7.6 + 8.2) * 512,
    7.6 / (7.6 + 3.1) * 512,
    3.1 / (3.1 + 4.2) * 512,

    7.6 / (7.6 + 7.7) * 512,
    3.1 / (3.1 + 4.2) * 512,
    7.7 / (7.6 + 7.6) * 512,
    7.6 / (7.6 + 7.6) * 512
    ];
var slider_user_xs = [256, 256, 256, 256,  256, 256, 256, 256];
var slider_xs = [256, 256, 256, 256,  256, 256, 256, 256];

var slider_down = false;

function comment_on_slider(no){
    var left = document.getElementById("left_" + (no + 1));
    var right = document.getElementById("right_" + (no + 1));
    var x = slider_xs[no]
    var xl = x;
    var xr = 511 - x;
    if(x < 255){
        left.style.backgroundColor = "#" + (Math.round(xl)).toString(16) + "ff" + (Math.round(xl)).toString(16);
        right.style.backgroundColor = "#ff" + (Math.round(xl)).toString(16) + (Math.round(xl)).toString(16);
    }else{
        right.style.backgroundColor = "#" + (Math.round(xr)).toString(16) + "ff" + (Math.round(xr)).toString(16);
        left.style.backgroundColor = "#ff" + (Math.round(xr)).toString(16) + (Math.round(xr)).toString(16);
    }

    var comment = document.getElementById("comment_" + (no + 1));
    if(Math.abs(xl - xr) < 3){
        comment.innerHTML = "They are almost the same.";
    }else if(xl > xr){
        if(xl > 20*xr){
            comment.innerHTML = "Right is more than 20 times faster!";
        }else if(xl > 10*xr){
            comment.innerHTML = "Right is more than 10 times faster!";
        }else if(xl > 5*xr){
            comment.innerHTML = "Right is more than 5 times faster!";
        }else if(xl > 3*xr){
            comment.innerHTML = "Right is more than 3 times faster!";
        }else if(xl > 2*xr){
            comment.innerHTML = "Right is more than 2 times faster!";
        }else if(xl > 1.5*xr){
            comment.innerHTML = "Right is more than 50% faster.";
        }else if(xl > 1.25*xr){
            comment.innerHTML = "Right is more than 25% faster.";
        }else if(xl > 1.1*xr){
            comment.innerHTML = "Right is more than 10% faster.";
        }else{
            comment.innerHTML = "Right is slightly faster.";
        }
    }else if(xr > xl){
        if(xr > 20*xl){
            comment.innerHTML = "Left is more than 20 times faster!";
        }else if(xr > 10*xl){
            comment.innerHTML = "Left is more than 10 times faster!";
        }else if(xr > 5*xl){
            comment.innerHTML = "Left is more than 5 times faster!";
        }else if(xr > 3*xl){
            comment.innerHTML = "Left is more than 3 times faster!";
        }else if(xr > 2*xl){
            comment.innerHTML = "Left is more than 2 times faster!";
        }else if(xr > 1.5*xl){
            comment.innerHTML = "Left is more than 50% faster.";
        }else if(xr > 1.25*xl){
            comment.innerHTML = "Left is more than 25% faster.";
        }else if(xr > 1.1*xl){
            comment.innerHTML = "Left is more than 10% faster.";
        }else{
            comment.innerHTML = "Left is slightly faster.";
        }
    }
}

function position_slider(no, client_x){
    if(!slider_set[no]){
        var slider = document.getElementById("slider_" + (no + 1));
        var canvas_rect = slider.getBoundingClientRect();
        var x = client_x - canvas_rect.left - 48;
        if(x < 16)
            x = 16;
        if(x > 511 - 16)
            x = 511 - 16;
        slider_xs[no] = x;

        comment_on_slider(no);
    }
}

function init_slider(no){
    draw_slider(no);
    var slider = document.getElementById("slider_" + (no + 1));

    slider.addEventListener('mouseleave', function(e){
        slider_down = false;
    }, false);

    slider.addEventListener('mouseup', function(e){
        slider_down = false;
    }, false);

    slider.addEventListener('mousedown', function(e){
        slider_down = true;
        position_slider(no, e.clientX);
        draw_slider(no);
    }, false);

    slider.addEventListener('mousemove', function(e){
        if(slider_down){
            position_slider(no, e.clientX);
            draw_slider(no);
        }
    }, false);
}

function draw_slider(no){
    ctx = document.getElementById("slider_" + (no + 1)).getContext("2d");
    x = slider_xs[no] + 48 + 0.5;

    ctx.clearRect(0, 0, 608, 128);
    ctx.beginPath();
    ctx.moveTo(64.5-16, 32.5);
    ctx.lineTo(0.5 + 16, 127.5 - 32);
    ctx.lineTo(607.5 - 16, 127.5 - 32);
    ctx.lineTo(607.5 - 64 + 16, 32.5);
    ctx.lineTo(64.5-16, 32.5);
    ctx.strokeStyle="#000000";
    ctx.stroke();
    ctx.closePath();
    ctx.fillStyle="#999999";
    ctx.fill();

    if(slider_set[no]){
        x_red = slider_user_xs[no] + 48 + 0.5;
        ctx.beginPath();
        ctx.moveTo(x_red, 0);
        ctx.lineTo(x_red - 64, 127);
        ctx.lineTo(x_red + 64, 127);
        ctx.lineTo(x_red, 0);
        ctx.strokeStyle="#660000";
        ctx.stroke();
        ctx.closePath();
        ctx.fillStyle="#ffcccc";
        ctx.fill();
    }

    ctx.beginPath();
    ctx.moveTo(x, 0);
    ctx.lineTo(x - 64, 127);
    ctx.lineTo(x + 64, 127);
    ctx.lineTo(x, 0);
    ctx.strokeStyle="#000000";
    ctx.stroke();
    ctx.closePath();
    ctx.fillStyle="#cccccc";
    ctx.fill();
}

function reveal(no){
    slider_set[no] = true;
    slider_user_xs[no] = slider_xs[no];
    slider_xs[no] = slider_true_xs[no];
    draw_slider(no);
    comment_on_slider(no);
    document.getElementById("the_truth_" + (no + 1)).style.display = "block";
    document.getElementById("button_" + (no + 1)).style.display = "none";

    for(var i = 0; i < 8; i++){
        if(slider_set[i] == false)
            return;
    }

    document.getElementById("show_in_the_end").style.display = "block";
    var score = 0;
    var default_score = 0;
    for(var i = 0; i < 8; i++){
        score += Math.abs(slider_user_xs[i] - slider_xs[i]);
        default_score += Math.abs(256 - slider_xs[i]);
    }

    document.getElementById("score").innerHTML = "<b>" + score.toFixed(0) + "</b>";
    document.getElementById("default_score").innerHTML = "<b>" + default_score.toFixed(0) + "</b>";
}

function colorized(text) {
    const separators = ['\n', ' ', '\t', '.', ',', ':', '=', '[', ']', '(', ')'];
    const comments = [['/*', '*/'], ['#', '\n']];

    function painted_in(line, color) {
        return line.length == 0 ? "" : "<span style=\"color:#" + color + "\">" + line + "</span>";
    }

    function colorized(token) {
        var code_sum = 0;
        for(var i = 0; i < token.length; ++i)
            code_sum += ([1, 7, 11, 13][i % 4] * token.charCodeAt(i));
        var zero_channel = code_sum % 3;
        var color = '' + (zero_channel == 0 ? '0' : '') + (1 + (code_sum % 5) * 2)
            + (zero_channel == 1 ? '0' : '') + (4 + (code_sum % 2) * 5)
            + (zero_channel == 2 ? '0' : '');
        return painted_in(token, color);
    }

    function separated(line, i) {
        if(i == separators.length)
            return colorized(line);
        return line.split(separators[i]).map(function(subline) {
            return separated(subline, i + 1);}).join(separators[i]);
    }

    function uncommented(line, i) {
        if(i == comments.length)
            return separated(line, 0);
        var chunks = line.split(comments[i][0]);
        return uncommented(chunks[0], i + 1) + chunks.slice(1).map( function(chunk) {
            var in_out_comment = chunk.split(comments[i][1]);
            return painted_in(comments[i][0] + in_out_comment[0] + (in_out_comment.length > 1 ? comments[i][1] : ''), "777")
                + uncommented(in_out_comment.slice(1).join(comments[i][1]), i + 1);}).join('');
    }

    return uncommented(text, 0);
}
    </script>
  </head>
  <body>
    <center>
    <h1>
Challenge your performance intuition with nanosecond sorting
    </h1>
    <p>
In physical world, nanotechnology predictably brings us surprises. Being structured on nano-scale, the most common materials, such as carbon, iron or copper, gain new unforseen properties. What we know about them in the macro-scale world do not apply then.
    </p>
    <p>
Surprisingly, a very similar effect happens in computation. If the operation you want to speed-up already runs in a few nano-seconds, your reasoning about algorithmic complexity and operations count probably don't apply.
    </p>
    <p>
The most effective algorithms become mediocre while the absolutely useless come from the oblivion to shine and amaze. One of these algorithms is the index sort. It has unconditional <i>O(n<sup>2</sup>)</i> complexity and this makes it probably the least performant sorting algorithm you never heard about. It's useless on the macro-scale. But on the nano-scale it excells.
    </p>
    <p>
...
    </p>
    <p>
Here is my benchmark.
    </p>
    <table><tr>
    <td>
    <pre style="width: 505pt;">
constexpr size_t samples = 10'000'000;
std::array&lt;std::array&lt;int, 3&gt;, samples&gt; g_data;

static void ResetData() {
    std::mt19937 rng(0);
    std::uniform_int_distribution&lt;int&gt; random_number(1, 100);
    for (auto& numbers : g_data) {
        numbers[0] = random_number(rng);
        numbers[1] = random_number(rng);
        numbers[2] = random_number(rng);
    }
}

int CheckDataForMissorts() {
    int missorts = 0; 
    for (auto& numbers : g_data) {
        if(numbers[1] &lt; numbers[0] || numbers[2] &lt; numbers[1])
            missorts++;
    }
    return missorts;
}

#define MEASURE(CODE_TO_MEASURE, NAME_TO_PRINT) \
    { \
    ResetData();    \
    auto start = std::chrono::system_clock::now(); \
    for(auto& t : g_data) { \
        CODE_TO_MEASURE \
    }   \
    auto end = std::chrono::system_clock::now(); \
    std::chrono::duration&lt;double&gt; time = end - start; \
    std::cout &lt;&lt; time.count() &lt;&lt; " - " &lt;&lt; NAME_TO_PRINT; \
    std::cout &lt;&lt; "\n"; \
    std::cout &lt;&lt; "missorts: " &lt;&lt; CheckDataForMissorts(); \
    std::cout &lt;&lt; "\n\n"; \
    }
    </pre>
    </td></tr></table>
    <p>
All the pieces of code are compiled with GCC 5.4.0: <i>g++ -std=c++14 -O3</i>, and measured on Intel(R) Core(TM) i7-7700HQ CPU @ 2.80GHz.
    </p>
    <p>
Using your intuition and best judgment, please estimate their relative performance. Please use the slider below the code samples.
    </p>

    <h2>
Round 1.
    </h2>
    <p>
...
    </p>
    <table><tr>
    <td id="left_1">
    <pre>
1
    </pre>
    </td>
    <td id="right_1">
    <pre>
2
    </pre>
    </td></tr></table>
    <canvas id="slider_1" width=608 height=128></canvas>
    <p class="comment" id="comment_1">
They are almost the same.
    </p>
    <button type="button" onclick="reveal(0)" id="button_1">Reveal the truth</button>
    <div id="the_truth_1" style="display:none;">
    <p>
...
    </p>
    <table><tr>
    <td>
    <pre id="code_1_1">
ASM1
    </pre>
    </td>
    <td>
    <pre id="code_1_2">
ASM2
    </pre>
    </td></tr></table>
    <p>
...
    </p>
    </div>
    <script language="JavaScript">
    init_slider(0);
    </script>
    
    <h2>
Round 2.
    </h2>
    <p>
...
    </p>
    <table><tr>
    <td id="left_2">
    <pre>
1
    </pre>
    </td>
    <td id="right_2">
    <pre>
2
    </pre>
    </td></tr></table>
    <canvas id="slider_2" width=608 height=128></canvas>
    <p class="comment" id="comment_2">
They are almost the same.
    </p>
    <button type="button" onclick="reveal(1)" id="button_2">Reveal the truth</button>
    <div id="the_truth_2" style="display:none;">
    <p>
...
    </p>
    <table><tr>
    <td>
    <pre id="code_2_1">
ASM1
    </pre>
    </td>
    <td>
    <pre id="code_2_2">
ASM2
    </pre>
    </td></tr></table>
    <p>
...
    </p>
    </div>
    <script language="JavaScript">
    init_slider(1);
    </script>
    
    
    <h2>
Round 3.
    </h2>
    <p>
...
    </p>
    <table><tr>
    <td id="left_3">
    <pre>
1
    </pre>
    </td>
    <td id="right_3">
    <pre>
2
    </pre>
    </td></tr></table>
    <canvas id="slider_3" width=608 height=128></canvas>
    <p class="comment" id="comment_3">
They are almost the same.
    </p>
    <button type="button" onclick="reveal(2)" id="button_3">Reveal the truth</button>
    <div id="the_truth_3" style="display:none;">
    <p>
...
    </p>
    <table><tr>
    <td>
    <pre id="code_3_1">
ASM1
    </pre>
    </td>
    <td>
    <pre id="code_3_2">
ASM2
    </pre>
    </td></tr></table>
    <p>
...
    </p>
    </div>
    <script language="JavaScript">
    init_slider(2);
    </script>
    
    
    <h2>
Round 4.
    </h2>
    <p>
...
    </p>
    <table><tr>
    <td id="left_4">
    <pre>
1
    </pre>
    </td>
    <td id="right_4">
    <pre>
2
    </pre>
    </td></tr></table>
    <canvas id="slider_4" width=608 height=128></canvas>
    <p class="comment" id="comment_4">
They are almost the same.
    </p>
    <button type="button" onclick="reveal(3)" id="button_4">Reveal the truth</button>
    <div id="the_truth_4" style="display:none;">
    <p>
...
    </p>
    <table><tr>
    <td>
    <pre id="code_4_1">
ASM1
    </pre>
    </td>
    <td>
    <pre id="code_4_2">
ASM2
    </pre>
    </td></tr></table>
    <p>
...
    </p>
    </div>
    <script language="JavaScript">
    init_slider(3);
    </script>
    
    
    <h2>
Round 5.
    </h2>
    <p>
...
    </p>
    <table><tr>
    <td id="left_5">
    <pre>
1
    </pre>
    </td>
    <td id="right_5">
    <pre>
2
    </pre>
    </td></tr></table>
    <canvas id="slider_5" width=608 height=128></canvas>
    <p class="comment" id="comment_5">
They are almost the same.
    </p>
    <button type="button" onclick="reveal(4)" id="button_5">Reveal the truth</button>
    <div id="the_truth_5" style="display:none;">
    <p>
...
    </p>
    <table><tr>
    <td>
    <pre id="code_5_1">
ASM1
    </pre>
    </td>
    <td>
    <pre id="code_5_2">
ASM2
    </pre>
    </td></tr></table>
    <p>
...
    </p>
    </div>
    <script language="JavaScript">
    init_slider(4);
    </script>
    
    
    <h2>
Round 6.
    </h2>
    <p>
...
    </p>
    <table><tr>
    <td id="left_6">
    <pre>
1
    </pre>
    </td>
    <td id="right_6">
    <pre>
2
    </pre>
    </td></tr></table>
    <canvas id="slider_6" width=608 height=128></canvas>
    <p class="comment" id="comment_6">
They are almost the same.
    </p>
    <button type="button" onclick="reveal(5)" id="button_6">Reveal the truth</button>
    <div id="the_truth_6" style="display:none;">
    <p>
...
    </p>
    <table><tr>
    <td>
    <pre id="code_6_1">
ASM1
    </pre>
    </td>
    <td>
    <pre id="code_6_2">
ASM2
    </pre>
    </td></tr></table>
    <p>
...
    </p>
    </div>
    <script language="JavaScript">
    init_slider(5);
    </script>
    
    
    <h2>
Round 7.
    </h2>
    <p>
...
    </p>
    <table><tr>
    <td id="left_7">
    <pre>
1
    </pre>
    </td>
    <td id="right_7">
    <pre>
2
    </pre>
    </td></tr></table>
    <canvas id="slider_7" width=608 height=128></canvas>
    <p class="comment" id="comment_7">
They are almost the same.
    </p>
    <button type="button" onclick="reveal(6)" id="button_7">Reveal the truth</button>
    <div id="the_truth_7" style="display:none;">
    <p>
...
    </p>
    <table><tr>
    <td>
    <pre id="code_7_1">
ASM1
    </pre>
    </td>
    <td>
    <pre id="code_7_2">
ASM2
    </pre>
    </td></tr></table>
    <p>
...
    </p>
    </div>
    <script language="JavaScript">
    init_slider(6);
    </script>
    
    
    <h2>
Round 8.
    </h2>
    <p>
...
    </p>
    <table><tr>
    <td id="left_8">
    <pre>
1
    </pre>
    </td>
    <td id="right_8">
    <pre>
2
    </pre>
    </td></tr></table>
    <canvas id="slider_8" width=608 height=128></canvas>
    <p class="comment" id="comment_8">
They are almost the same.
    </p>
    <button type="button" onclick="reveal(7)" id="button_8">Reveal the truth</button>
    <div id="the_truth_8" style="display:none;">
    <p>
...
    </p>
    <table><tr>
    <td>
    <pre id="code_8_1">
ASM1
    </pre>
    </td>
    <td>
    <pre id="code_8_2">
ASM2
    </pre>
    </td></tr></table>
    <p>
...
    </p>
    </div>
    <script language="JavaScript">
    init_slider(7);
    </script>                            



    <div id="show_in_the_end" style="display:none;">
    <h2>
Congratulations!
    </h2>
    <p>
You scored <span id="score"></span> pixels of error. As a reference, if you leave every slider untouched there would be exactly <span id="default_score"></span> pixels of error.
    </p>

    <h2>
Conclusion
    </h2>
    <p>
...
    </p>
    </div>
    <script language="JavaScript">
    document.getElementById("code_1_1").innerHTML = colorized(document.getElementById("code_1_1").innerHTML);
    document.getElementById("code_1_2").innerHTML = colorized(document.getElementById("code_1_2").innerHTML);
    </script>


    <table class="footer" style="width: 555pt; padding: 64pt 0pt 32pt 0pt; background-color: transparent; font-family: sans-serif; font-size: 16pt; font-style: normal;">
    <tr>
    <td class="footer" style="vertical-align: middle; text-align: left; width: 64px; padding: 0; margin: 0; border: 0;">
        <a href="index.html"><img src="favicon.ico"></a>
    </td>
    <td class="footer" style="vertical-align: middle; text-align: left; width: 200pt; padding: 0; margin: 0; border: 0;">
        &nbsp;&larr; there's more.
    </td>
    <td class="footer" style="vertical-align: middle; text-align: right; width: 300pt; padding: 0; margin: 0; border: 0;">
        +
        <a href="https://github.com/akalenuk/wordsandbuttons">Github</a> &
        <a href="https://twitter.com/wordsandbuttons">Twitter</a> &
        <a href="https://news.ycombinator.com/from?site=wordsandbuttons.online">Hacker News</a>
    </td>
    </tr>
    </table>
    </center>
  </body>
</html>
