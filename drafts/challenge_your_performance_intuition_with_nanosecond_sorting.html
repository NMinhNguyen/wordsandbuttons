<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Challenge your performance intuition with nanosecond sorting</title>
    <meta name="keywords" content="cpp,quiz,game,learning,c++">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
    <style>
body{
    margin: 0 0 0 0;
}

a{
    text-decoration: none;
}

h1 {
    padding-top: 36pt;
    font-size: 24pt;
    width: 600pt;
    text-align: left;
}

h2 {
    padding-top: 64pt;
    font-size: 20pt;
    width: 555pt;
    text-align: left;
}

p {
    line-height: 1.42;
    font-size: 16pt;
    width: 505pt;
    text-align: left;
}

.comment {
    font-size: 14pt;
    text-align:center;
    font-family: sans-serif;
    padding-bottom: 24pt;
}

table.footer {
    padding: 64pt 0pt 32pt 0pt;
    background-color: transparent;
    width: 505pt;
}

td.footer {
    font-family: sans-serif;
    font-size: 16pt;
    font-style: normal;
    padding: 0;
    margin: 0;
    border: 0;
}

pre {
    margin: 0 0 0 0;
    padding-top: 12pt;
    padding-left: 12pt;
    padding-right: 12pt;
    padding-bottom: 12pt;
    font-size: 12pt;
    text-align: left;
    width: 360pt;
}

table {
    text-align: center;
    border-width: 0pt;
}

td {
    padding: 6pt 12pt 6pt 12pt;
    font-size: 16pt;
    border: 1px solid black;
}

button{
    width: 304pt;
    height: 42pt;
    margin-left:4pt;
    margin-right:4pt;
    font-size: 18pt;
}

u {
    text-decoration: none;
    font-weight: bold;
    color: #e30707;
}
    </style>
    <script language="JavaScript">
const slider_set = [false, false, false, false, false, false, false];
const slider_true_xs = [
    0.1446586 / (0.1446586 + 0.02240006) * 512,
    0.02240006 / (0.02240006 + 0.020363) * 512,
    0.020363 / (0.020363 + 0.08614054) * 512,
    
    0.08614054 / (0.08614054 + 0.0899975) * 512,
    0.0899975 / (0.0899975 + 0.04408498) * 512,
    0.04408498 / (0.04408498 + 0.02030048) * 512,
    
    0.020363 / (0.020363 + 0.02052882) * 512,
    ];
const slider_user_xs = [256, 256, 256, 256, 256, 256, 256];
const slider_xs = [256, 256, 256, 256, 256, 256, 256];
const sliders = slider_true_xs.length;

var slider_down = false;

function comment_on_slider(no){
    var left = document.getElementById("left_" + (no + 1));
    var right = document.getElementById("right_" + (no + 1));
    var x = slider_xs[no]
    var xl = x;
    var xr = 511 - x;
    if(x < 255){
        left.style.backgroundColor = "#" + (Math.round(xl)).toString(16) + "ff" + (Math.round(xl)).toString(16);
        right.style.backgroundColor = "#ff" + (Math.round(xl)).toString(16) + (Math.round(xl)).toString(16);
    }else{
        right.style.backgroundColor = "#" + (Math.round(xr)).toString(16) + "ff" + (Math.round(xr)).toString(16);
        left.style.backgroundColor = "#ff" + (Math.round(xr)).toString(16) + (Math.round(xr)).toString(16);
    }

    var comment = document.getElementById("comment_" + (no + 1));
    if(Math.abs(xl - xr) < 3){
        comment.innerHTML = "They are almost the same.";
    }else if(xl > xr){
        if(xl > 20*xr){
            comment.innerHTML = "Right is more than 20 times faster!";
        }else if(xl > 10*xr){
            comment.innerHTML = "Right is more than 10 times faster!";
        }else if(xl > 5*xr){
            comment.innerHTML = "Right is more than 5 times faster!";
        }else if(xl > 3*xr){
            comment.innerHTML = "Right is more than 3 times faster!";
        }else if(xl > 2*xr){
            comment.innerHTML = "Right is more than 2 times faster!";
        }else if(xl > 1.5*xr){
            comment.innerHTML = "Right is more than 50% faster.";
        }else if(xl > 1.25*xr){
            comment.innerHTML = "Right is more than 25% faster.";
        }else if(xl > 1.1*xr){
            comment.innerHTML = "Right is more than 10% faster.";
        }else{
            comment.innerHTML = "Right is slightly faster.";
        }
    }else if(xr > xl){
        if(xr > 20*xl){
            comment.innerHTML = "Left is more than 20 times faster!";
        }else if(xr > 10*xl){
            comment.innerHTML = "Left is more than 10 times faster!";
        }else if(xr > 5*xl){
            comment.innerHTML = "Left is more than 5 times faster!";
        }else if(xr > 3*xl){
            comment.innerHTML = "Left is more than 3 times faster!";
        }else if(xr > 2*xl){
            comment.innerHTML = "Left is more than 2 times faster!";
        }else if(xr > 1.5*xl){
            comment.innerHTML = "Left is more than 50% faster.";
        }else if(xr > 1.25*xl){
            comment.innerHTML = "Left is more than 25% faster.";
        }else if(xr > 1.1*xl){
            comment.innerHTML = "Left is more than 10% faster.";
        }else{
            comment.innerHTML = "Left is slightly faster.";
        }
    }
}

function position_slider(no, client_x){
    if(!slider_set[no]){
        var slider = document.getElementById("slider_" + (no + 1));
        var canvas_rect = slider.getBoundingClientRect();
        var x = client_x - canvas_rect.left - 48;
        if(x < 16)
            x = 16;
        if(x > 511 - 16)
            x = 511 - 16;
        slider_xs[no] = x;

        comment_on_slider(no);
    }
}

function init_slider(no){
    draw_slider(no);
    var slider = document.getElementById("slider_" + (no + 1));

    slider.addEventListener('mouseleave', function(e){
        slider_down = false;
    }, false);

    slider.addEventListener('mouseup', function(e){
        slider_down = false;
    }, false);

    slider.addEventListener('mousedown', function(e){
        slider_down = true;
        position_slider(no, e.clientX);
        draw_slider(no);
    }, false);

    slider.addEventListener('mousemove', function(e){
        if(slider_down){
            position_slider(no, e.clientX);
            draw_slider(no);
        }
    }, false);
}

function draw_slider(no){
    ctx = document.getElementById("slider_" + (no + 1)).getContext("2d");
    x = slider_xs[no] + 48 + 0.5;

    ctx.clearRect(0, 0, 608, 128);
    ctx.beginPath();
    ctx.moveTo(64.5-16, 32.5);
    ctx.lineTo(0.5 + 16, 127.5 - 32);
    ctx.lineTo(607.5 - 16, 127.5 - 32);
    ctx.lineTo(607.5 - 64 + 16, 32.5);
    ctx.lineTo(64.5-16, 32.5);
    ctx.strokeStyle="#000000";
    ctx.stroke();
    ctx.closePath();
    ctx.fillStyle="#999999";
    ctx.fill();

    if(slider_set[no]){
        x_red = slider_user_xs[no] + 48 + 0.5;
        ctx.beginPath();
        ctx.moveTo(x_red, 0);
        ctx.lineTo(x_red - 64, 127);
        ctx.lineTo(x_red + 64, 127);
        ctx.lineTo(x_red, 0);
        ctx.strokeStyle="#660000";
        ctx.stroke();
        ctx.closePath();
        ctx.fillStyle="#ffcccc";
        ctx.fill();
    }

    ctx.beginPath();
    ctx.moveTo(x, 0);
    ctx.lineTo(x - 64, 127);
    ctx.lineTo(x + 64, 127);
    ctx.lineTo(x, 0);
    ctx.strokeStyle="#000000";
    ctx.stroke();
    ctx.closePath();
    ctx.fillStyle="#cccccc";
    ctx.fill();
}

function reveal(no){
    slider_set[no] = true;
    slider_user_xs[no] = slider_xs[no];
    slider_xs[no] = slider_true_xs[no];
    draw_slider(no);
    comment_on_slider(no);
    document.getElementById("the_truth_" + (no + 1)).style.display = "block";
    document.getElementById("button_" + (no + 1)).style.display = "none";

    for(var i = 0; i < sliders; i++){
        if(slider_set[i] == false)
            return;
    }

    document.getElementById("show_in_the_end").style.display = "block";
    var score = 0;
    var default_score = 0;
    for(var i = 0; i < sliders; i++){
        score += Math.abs(slider_user_xs[i] - slider_xs[i]);
        default_score += Math.abs(256 - slider_xs[i]);
    }

    document.getElementById("score").innerHTML = "<b>" + score.toFixed(0) + "</b>";
    document.getElementById("default_score").innerHTML = "<b>" + default_score.toFixed(0) + "</b>";
}

function next(slides){
    // show the next slide
    var first_slide = document.getElementById(slides + "_" + 1);
    for(var i = 1; i < 9; ++i)
    {
        var this_slide = document.getElementById(slides + "_" + i);
        var next_slide = document.getElementById(slides + "_" + (i+1));
        if(this_slide)
            if(this_slide.style.display == "block")
                {
                this_slide.style.display = "none";
                if(next_slide)
                    next_slide.style.display = "block";
                else
                    first_slide.style.display = "block";
                break;
                }
    }
    // name the button
    var button = document.getElementById(slides + "_button")
    for(var i = 1; i < 9; ++i)
    {
        var this_slide = document.getElementById(slides + "_" + i);
        var next_slide = document.getElementById(slides + "_" + (i+1));
        if (this_slide && !next_slide && this_slide.style.display == "block") {
            button.innerHTML = "Back to the 1-st slide";
            break;
        }
        else
            button.innerHTML = "Next slide";
    }
}

function colorized(text) {
    const separators = ['\n', ' ', '\t', '.', ',', ':', '=', '[', ']', '(', ')'];
    const comments = [['/*', '*/'], ['#', '\n']];

    function painted_in(line, color) {
        return line.length == 0 ? "" : "<span style=\"color:#" + color + "\">" + line + "</span>";
    }

    function colorized(token) {
        var code_sum = 0;
        for(var i = 0; i < token.length; ++i)
            code_sum += ([1, 7, 11, 13][i % 4] * token.charCodeAt(i));
        var zero_channel = code_sum % 3;
        var color = '' + (zero_channel == 0 ? '0' : '') + (1 + (code_sum % 5) * 2)
            + (zero_channel == 1 ? '0' : '') + (4 + (code_sum % 2) * 5)
            + (zero_channel == 2 ? '0' : '');
        return painted_in(token, color);
    }

    function separated(line, i) {
        if(i == separators.length)
            return colorized(line);
        return line.split(separators[i]).map(function(subline) {
            return separated(subline, i + 1);}).join(separators[i]);
    }

    function uncommented(line, i) {
        if(i == comments.length)
            return separated(line, 0);
        var chunks = line.split(comments[i][0]);
        return uncommented(chunks[0], i + 1) + chunks.slice(1).map( function(chunk) {
            var in_out_comment = chunk.split(comments[i][1]);
            return painted_in(comments[i][0] + in_out_comment[0] + (in_out_comment.length > 1 ? comments[i][1] : ''), "777")
                + uncommented(in_out_comment.slice(1).join(comments[i][1]), i + 1);}).join('');
    }

    return uncommented(text, 0);
}
    </script>
  </head>
  <body>
    <center>
    <h1>
Challenge your performance intuition with nanosecond sorting
    </h1>
    <p>
In physical world, nanotechnology predictably brings us surprises. Being structured on nano-scale, the most common materials, such as carbon, iron or copper, gain new unforseen properties. What we know about them in the macro-scale world do not apply then.
    </p>
    <p>
Surprisingly, a very similar effect happens in computation. If the operation you want to speed-up already runs in a few nano-seconds, your reasoning about algorithmic complexity and operations count probably don't apply.
    </p>
    <p>
The most effective algorithms become mediocre while the absolutely useless come from the oblivion to shine and amaze. One of these algorithms is the index sort. It has unconditional <i>O(n<sup>2</sup>)</i> complexity and this makes it probably the least performant sorting algorithm you never heard about. It's useless on the macro-scale. But on the nano-scale it excells.
    </p>
    <h2>
Index sort
    </h2>
    <p>
The idea of index sort is this. For every item in the assorted array you can find its index in the sorder array by comparing it to all the others. 
    </p>
    
    <table><tr>
    <td style="width:505pt;">
    <pre><span id="slides_is_1" style="display:block;"><div style="color:#994466"><b>Example</b></div>
Assorted: 6 4 8 4

   Xi   Comparisons                     Index
        6       4       8       4
    6           >       >       >       ?

    4   >=              >       >       ?

    8   >=      >=              >       ?

    4   >=      >=      >=              ?




</span><span id="slides_is_2" style="display:none;"><div style="color:#994466"><b>Example</b></div>
Assorted: 6 4 8 4

   Xi   Comparisons                     Index
        6       4       8       4
    6           <u>></u>       >       >       1+?

    4   >=              >       >       ?

    8   >=      >=              >       ?

    4   >=      >=      >=              ?




</span><span id="slides_is_3" style="display:none;"><div style="color:#994466"><b>Example</b></div>
Assorted: 6 4 8 4

   Xi   Comparisons                     Index
        6       4       8       4
    6           <b>></b>       >       <u>></u>       <u>2</u>

    4   >=              >       >       ?

    8   >=      >=              >       ?

    4   >=      >=      >=              ?




</span><span id="slides_is_4" style="display:none;"><div style="color:#994466"><b>Example</b></div>
Assorted: 6 4 8 4

   Xi   Comparisons                     Index
        6       4       8       4
    6           <b>></b>       >       <b>></b>       2

    4   >=              >       >       <u>0</u>

    8   >=      >=              >       ?

    4   >=      >=      >=              ?




</span><span id="slides_is_5" style="display:none;"><div style="color:#994466"><b>Example</b></div>
Assorted: 6 4 8 4

   Xi   Comparisons                     Index
        6       4       8       4
    6           <b>></b>       >       <b>></b>       2

    4   >=              >       >       0

    8   <u>>=</u>      >=              >       1+?

    4   >=      >=      >=              ?




</span><span id="slides_is_6" style="display:none;"><div style="color:#994466"><b>Example</b></div>
Assorted: 6 4 8 4

   Xi   Comparisons                     Index
        6       4       8       4
    6           <b>></b>       >       <b>></b>       2

    4   >=              >       >       0

    8   <b>>=</b>      <u>>=</u>              >       2+?

    4   >=      >=      >=              ?




</span><span id="slides_is_3" style="display:none;"><div style="color:#994466"><b>Example</b></div>
Assorted: 6 4 8 4

   Xi   Comparisons                     Index
        6       4       8       4
    6           <b>></b>       >       <b>></b>       2

    4   >=              >       >       0

    8   <b>>=</b>      <b>>=</b>              <u>></u>       <u>3</u>

    4   >=      >=      >=              ?




</span><span id="slides_is_7" style="display:none;"><div style="color:#994466"><b>Example</b></div>
Assorted: 6 4 8 4

   Xi   Comparisons                     Index
        6       4       8       4
    6           <b>></b>       >       <b>></b>       2

    4   >=              >       >       0

    8   <b>>=</b>      <b>>=</b>              <b>></b>       3

    4   >=      <u>>=</u>      >=              <u>1</u>




</span><span id="slides_is_8" style="display:none;"><div style="color:#994466"><b>Example</b></div>
Assorted: 6 4 8 4

   Xi   Comparisons                     Index
        6       4       8       4
    6           >       >       >       2

    4   >=              >       >       0

    8   >=      >=              >       3

    4   >=      >=      >=              1


                                Sorted: <u>4 4 6 8</u>

</span></pre></td>
    </td></tr></table>
    <p style="text-align:right">
    <button type="button" id="slides_is_button" onclick="next('slides_is')">Next step</button>
    </p>
    <p>
It's not algorithmically elegant. But it's deterministic meaning that you can avoid branching completely. On small arrays this should be a noticeable advantage.
    </p>
    <h2>
And now for the challenge
    </h2>
    <p>
Let's compare how different sorting work on triplets — arrays of three elements. You might think that this is a rare task but when you work with 3D graphics it's comes up surprisingly often. Last year alone I did triplet sorting for triangles' indices, for cubic equation roots, and for axis-oriented bounding box dimensions. 
    </p>
    <p>
Tasks like that are rarely bottlenecks but if you can speed up your algorihtm for even 5% with no measurable effort, it's probably worth doing.
    </p>
    <p>
Anyway, here is my benchmark.
    </p>
    <table><tr>
    <td>
    <pre style="width: 505pt;">
constexpr size_t samples = 10'000'000;
std::array&lt;std::array&lt;int, 3&gt;, samples&gt; g_data;

static void ResetData() {
    std::mt19937 rng(0);
    std::uniform_int_distribution&lt;int&gt; random_number(1, 100);
    for (auto& numbers : g_data) {
        numbers[0] = random_number(rng);
        numbers[1] = random_number(rng);
        numbers[2] = random_number(rng);
    }
}

int CheckDataForMissorts() {
    int missorts = 0; 
    for (auto& numbers : g_data) {
        if(numbers[1] &lt; numbers[0] || numbers[2] &lt; numbers[1])
            missorts++;
    }
    return missorts;
}

#define MEASURE(CODE_TO_MEASURE, NAME_TO_PRINT) \
    { \
    ResetData();    \
    auto start = std::chrono::system_clock::now(); \
    for(auto& t : g_data) { \
        CODE_TO_MEASURE \
    }   \
    auto end = std::chrono::system_clock::now(); \
    std::chrono::duration&lt;double&gt; time = end - start; \
    std::cout &lt;&lt; time.count() &lt;&lt; " - " &lt;&lt; NAME_TO_PRINT; \
    std::cout &lt;&lt; "\n"; \
    std::cout &lt;&lt; "missorts: " &lt;&lt; CheckDataForMissorts(); \
    std::cout &lt;&lt; "\n\n"; \
    }
    </pre>
    </td></tr></table>
    <p>
It generates a lot of triplets, runs a piece of code a lot of times(I deliberately made it as a macro to avoid contextual compiler optimizations with inlined functions), and reports the total running time.
    </p>
    <p>
All the pieces of code are compiled with GCC 5.4.0: <i>g++ -std=c++14 -O3</i>, and measured on Intel(R) Core(TM) i7-7700HQ CPU @ 2.80GHz.
    </p>
    <p>
Using your intuition and best judgment, please estimate their relative performance. Please use the slider below the code samples.
    </p>

    <h2>
Round 1.
    </h2>
    <p>
...
    </p>
    <table><tr>
    <td id="left_1">
    <pre>
std::sort(t.begin(), t.end());
    </pre>
    </td>
    <td id="right_1">
    <pre>
const auto a = t[0];
const auto b = t[1];
const auto c = t[2];
t[int(a > b) + int(a > c)] = a;
t[int(b >= a) + int(b > c)] = b;
t[int(c >= a) + int(c >= b)] = c;
    </pre>
    </td></tr></table>
    <canvas id="slider_1" width=608 height=128></canvas>
    <p class="comment" id="comment_1">
They are almost the same.
    </p>
    <button type="button" onclick="reveal(0)" id="button_1">Reveal the truth</button>
    <div id="the_truth_1" style="display:none;">
    <p>
...
    </p>
    <table><tr>
    <td>
    <pre id="code_1_1">
ASM1
    </pre>
    </td>
    <td>
    <pre id="code_1_2">
ASM2
    </pre>
    </td></tr></table>
    <p>
...
    </p>
    </div>
    <script language="JavaScript">
    init_slider(0);
    </script>
    
    <h2>
Round 2.
    </h2>
    <p>
...
    </p>
    <table><tr>
    <td id="left_2">
    <pre>
const auto a = t[0];
const auto b = t[1];
const auto c = t[2];
t[int(a &gt; b) + int(a &gt; c)] = a;
t[int(b &gt;= a) + int(b &gt; c)] = b;
t[int(c &gt;= a) + int(c &gt;= b)] = c;
    </pre>
    </td>
    <td id="right_2">
    <pre>
template &lt;size_t N&gt; 
void index_sort(std::array&lt;int, N&gt;& t) {
    std::array&lt;int, N&gt; a = t;
    for(auto i = 0u; i &lt; N; ++i) {
        auto k = 0u;
        for(auto j = 0u; j &lt; N; ++j) {
            if(j &gt; i)
                k += int(a[i] &gt; a[j]);
            else if(j &lt; i)
                k += int(a[i] &gt;= a[j]);
        }
        t[k] = a[i];
    }
}
    </pre>
    </td></tr></table>
    <canvas id="slider_2" width=608 height=128></canvas>
    <p class="comment" id="comment_2">
They are almost the same.
    </p>
    <button type="button" onclick="reveal(1)" id="button_2">Reveal the truth</button>
    <div id="the_truth_2" style="display:none;">
    <p>
...
    </p>
    <table><tr>
    <td>
    <pre id="code_2_1">
ASM1
    </pre>
    </td>
    <td>
    <pre id="code_2_2">
ASM2
    </pre>
    </td></tr></table>
    <p>
...
    </p>
    </div>
    <script language="JavaScript">
    init_slider(1);
    </script>
    
    
    <h2>
Round 3.
    </h2>
    <p>
...
    </p>
    <table><tr>
    <td id="left_3">
    <pre>
template &lt;size_t N&gt; 
void index_sort(std::array&lt;int, N&gt;& t) {
    std::array&lt;int, N&gt; a = t;
    for(auto i = 0u; i &lt; N; ++i) {
        auto k = 0u;
        for(auto j = 0u; j &lt; N; ++j) {
            if(j &gt; i)
                k += int(a[i] &gt; a[j]);
            else if(j &lt; i)
                k += int(a[i] &gt;= a[j]);
        }
        t[k] = a[i];
    }
}
    </pre>
    </td>
    <td id="right_3">
    <pre>
void swap_sort(std::array&lt;int, 3&gt;& t) {
    auto sort_ = [](auto& a, auto& b) {
        if (a &gt; b)
            std::swap(a, b);
    };
    sort_(t[0], t[1]);
    sort_(t[1], t[2]);
    sort_(t[0], t[1]);
}
    </pre>
    </td></tr></table>
    <canvas id="slider_3" width=608 height=128></canvas>
    <p class="comment" id="comment_3">
They are almost the same.
    </p>
    <button type="button" onclick="reveal(2)" id="button_3">Reveal the truth</button>
    <div id="the_truth_3" style="display:none;">
    <p>
...
    </p>
    <table><tr>
    <td>
    <pre id="code_3_1">
ASM1
    </pre>
    </td>
    <td>
    <pre id="code_3_2">
ASM2
    </pre>
    </td></tr></table>
    <p>
...
    </p>
    </div>
    <script language="JavaScript">
    init_slider(2);
    </script>
    
    
    <h2>
Round 4.
    </h2>
    <p>
...
    </p>
    <table><tr>
    <td id="left_4">
    <pre>
void swap_sort(std::array&lt;int, 3&gt;& t) {
    auto sort_ = [](auto& a, auto& b) {
        if (a &gt; b)
            std::swap(a, b);
    };
    sort_(t[0], t[1]);
    sort_(t[1], t[2]);
    sort_(t[0], t[1]);
}
    </pre>
    </td>
    <td id="right_4">
    <pre>
void swap_sort_no_ifs(std::array&lt;int, 3&gt;& t) {
    auto sort_ = [](auto& a, auto& b) {
        const auto temp = std::min(a, b);
        b = std::max(a, b);
        a = temp;
    };
    sort_(t[0], t[1]);
    sort_(t[1], t[2]);
    sort_(t[0], t[1]);
}
    </pre>
    </td></tr></table>
    <canvas id="slider_4" width=608 height=128></canvas>
    <p class="comment" id="comment_4">
They are almost the same.
    </p>
    <button type="button" onclick="reveal(3)" id="button_4">Reveal the truth</button>
    <div id="the_truth_4" style="display:none;">
    <p>
...
    </p>
    <table><tr>
    <td>
    <pre id="code_4_1">
ASM1
    </pre>
    </td>
    <td>
    <pre id="code_4_2">
ASM2
    </pre>
    </td></tr></table>
    <p>
...
    </p>
    </div>
    <script language="JavaScript">
    init_slider(3);
    </script>
    
    
    <h2>
Round 5.
    </h2>
    <p>
...
    </p>
    <table><tr>
    <td id="left_5">
    <pre>
void swap_sort_no_ifs(std::array&lt;int, 3&gt;& t) {
    auto sort_ = [](auto& a, auto& b) {
        const auto temp = std::min(a, b);
        b = std::max(a, b);
        a = temp;
    };
    sort_(t[0], t[1]);
    sort_(t[1], t[2]);
    sort_(t[0], t[1]);
}
    </pre>
    </td>
    <td id="right_5">
    <pre>
void swap_sort_arithmetic_hack(std::array&lt;int, 3&gt;& t) {
    auto sort_ = [](auto& a, auto& b) {
        auto sum = a+b;
        auto diff = std::abs(a-b);
        a = (sum - diff) / 2;
        b = (sum + diff) / 2;
    };
    sort_(t[0], t[1]);
    sort_(t[1], t[2]);
    sort_(t[0], t[1]);
}
    </pre>
    </td></tr></table>
    <canvas id="slider_5" width=608 height=128></canvas>
    <p class="comment" id="comment_5">
They are almost the same.
    </p>
    <button type="button" onclick="reveal(4)" id="button_5">Reveal the truth</button>
    <div id="the_truth_5" style="display:none;">
    <p>
...
    </p>
    <table><tr>
    <td>
    <pre id="code_5_1">
ASM1
    </pre>
    </td>
    <td>
    <pre id="code_5_2">
ASM2
    </pre>
    </td></tr></table>
    <p>
...
    </p>
    </div>
    <script language="JavaScript">
    init_slider(4);
    </script>
    
    
    <h2>
Round 6.
    </h2>
    <p>
...
    </p>
    <table><tr>
    <td id="left_6">
    <pre>
void swap_sort_arithmetic_hack(std::array&lt;int, 3&gt;& t) {
    auto sort_ = [](auto& a, auto& b) {
        auto sum = a+b;
        auto diff = std::abs(a-b);
        a = (sum - diff) / 2;
        b = (sum + diff) / 2;
    };
    sort_(t[0], t[1]);
    sort_(t[1], t[2]);
    sort_(t[0], t[1]);
}
    </pre>
    </td>
    <td id="right_6">
    <pre>
void swap_sort_bit_hack(std::array&lt;int, 3&gt;& t) {
    auto sort_ = [](auto& x, auto& y) {
        constexpr auto shift = (sizeof(int) * CHAR_BIT - 1);
        const auto temp = y + ((x - y) & ((x - y) &gt;&gt; shift));
        y = x - ((x - y) & ((x - y) &gt;&gt; shift));
        x = temp;
    };
    sort_(t[0], t[1]);
    sort_(t[1], t[2]);
    sort_(t[0], t[1]);
}
    </pre>
    </td></tr></table>
    <canvas id="slider_6" width=608 height=128></canvas>
    <p class="comment" id="comment_6">
They are almost the same.
    </p>
    <button type="button" onclick="reveal(5)" id="button_6">Reveal the truth</button>
    <div id="the_truth_6" style="display:none;">
    <p>
...
    </p>
    <table><tr>
    <td>
    <pre id="code_6_1">
ASM1
    </pre>
    </td>
    <td>
    <pre id="code_6_2">
ASM2
    </pre>
    </td></tr></table>
    <p>
...
    </p>
    </div>
    <script language="JavaScript">
    init_slider(5);
    </script>
    
    
    <h2>
Round 7.
    </h2>
    <p>
...
    </p>
    <table><tr>
    <td id="left_7">
    <pre>
template &lt;size_t N&gt; 
void index_sort(std::array&lt;int, N&gt;& t) {
    std::array&lt;int, N&gt; a = t;
    for(auto i = 0u; i &lt; N; ++i) {
        auto k = 0u;
        for(auto j = 0u; j &lt; N; ++j) {
            if(j &gt; i)
                k += int(a[i] &gt; a[j]);
            else if(j &lt; i)
                k += int(a[i] &gt;= a[j]);
        }
        t[k] = a[i];
    }
}
    </pre>
    </td>
    <td id="right_7">
    <pre>
template &lt;size_t N&gt; 
void index_sort_fast_t(std::array&lt;int, N&gt;& t) {
    std::array&lt;int, N&gt; a = t;
    for(uint_fast8_t i = 0u; i &lt; N; ++i) {
        uint_fast8_t k = 0u;
        for(uint_fast8_t j = 0u; j &lt; N; ++j) {
            if(j &gt; i)
                k += uint_fast8_t(a[i] &gt; a[j]);
            else if(j &lt; i)
                k += uint_fast8_t(a[i] &gt;= a[j]);
        }
        t[k] = a[i];
    }
}
    </pre>
    </td></tr></table>
    <canvas id="slider_7" width=608 height=128></canvas>
    <p class="comment" id="comment_7">
They are almost the same.
    </p>
    <button type="button" onclick="reveal(6)" id="button_7">Reveal the truth</button>
    <div id="the_truth_7" style="display:none;">
    <p>
...
    </p>
    <table><tr>
    <td>
    <pre id="code_7_1">
ASM1
    </pre>
    </td>
    <td>
    <pre id="code_7_2">
ASM2
    </pre>
    </td></tr></table>
    <p>
...
    </p>
    </div>
    <script language="JavaScript">
    init_slider(6);
    </script>


    <div id="show_in_the_end" style="display:none;">
    <h2>
Congratulations!
    </h2>
    <p>
You scored <span id="score"></span> pixels of error. As a reference, if you leave every slider untouched there would be exactly <span id="default_score"></span> pixels of error.
    </p>

    <h2>
Conclusion
    </h2>
    <p>
...
    </p>
    </div>
    <script language="JavaScript">
    document.getElementById("code_1_1").innerHTML = colorized(document.getElementById("code_1_1").innerHTML);
    document.getElementById("code_1_2").innerHTML = colorized(document.getElementById("code_1_2").innerHTML);
    </script>


    <table class="footer" style="width: 555pt; padding: 64pt 0pt 32pt 0pt; background-color: transparent; font-family: sans-serif; font-size: 16pt; font-style: normal;">
    <tr>
    <td class="footer" style="vertical-align: middle; text-align: left; width: 64px; padding: 0; margin: 0; border: 0;">
        <a href="index.html"><img src="favicon.ico"></a>
    </td>
    <td class="footer" style="vertical-align: middle; text-align: left; width: 200pt; padding: 0; margin: 0; border: 0;">
        &nbsp;&larr; there's more.
    </td>
    <td class="footer" style="vertical-align: middle; text-align: right; width: 300pt; padding: 0; margin: 0; border: 0;">
        +
        <a href="https://github.com/akalenuk/wordsandbuttons">Github</a> &
        <a href="https://twitter.com/wordsandbuttons">Twitter</a> &
        <a href="https://news.ycombinator.com/from?site=wordsandbuttons.online">Hacker News</a>
    </td>
    </tr>
    </table>
    </center>
  </body>
</html>
