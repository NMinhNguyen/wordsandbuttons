<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Marching cubes and dual contouring contouring</title>
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
    <style>
body{
    margin: 0 0 0 0;
}

a{
    text-decoration: none;
}

h1 {
    padding-top: 32pt;
    font-size: 24pt;
    width: 600pt;
    text-align: left;
}

h2 {
    padding-top: 16pt;
    font-size: 20pt;
    width: 555pt;
    text-align: left;
}

p {
    font-size: 16pt;
    width: 505pt;
    text-align: left;
}

pre {
    margin: 0 0 0 0;
    padding-top: 12pt;
    padding-left: 12pt;
    padding-right: 12pt;
    padding-bottom: 12pt;
    font-size: 12pt;
    text-align: left;
    width: 300pt;
}

.code_piece {
    font-family: monospace;
    padding-left: 4pt;
    padding-right: 4pt;
}

.formula {
    font-family: sans-serif;
    font-size: 15pt;
    font-style: italic;
    text-align: center;
    padding-top: 6pt;
    padding-bottom: 6pt;
}

table {
    border-width: 0pt;
}

td {
    vertical-align: top;
    padding: 6pt 12pt 6pt 12pt;
    font-size: 16pt;
    border: 1px solid black;
    width: 600pt;
}

button{
    width: 248pt;
    height: 42pt;
    margin-left:4pt;
    margin-right:4pt;
    font-size: 16pt;
}

u {
    border-bottom: 1px dotted #000;
    text-decoration: none;
    cursor: pointer;
}
    </style>
    <script language="JavaScript">
const w = 640;
const h = 480;

function draw_one_cube(context, j, i, grid_size, d_f, distance, do_interpolation) {
    var d00 = d_f(j, i);
    var d01 = d_f(j, i + grid_size);
    var d11 = d_f(j + grid_size, i + grid_size);
    var d10 = d_f(j + grid_size, i);
    var t00_01 = do_interpolation ? (distance - d00) / (d01 - d00) : 0.5;
    var t01_11 = do_interpolation ? (distance - d01) / (d11 - d01) : 0.5;
    var t11_10 = do_interpolation ? (distance - d11) / (d10 - d11) : 0.5;
    var t10_00 = do_interpolation ? (distance - d10) / (d00 - d10) : 0.5;
    var in_00 = d00 < distance;
    var out_00 = !in_00;
    var in_01 = d01 < distance;
    var out_01 = !in_01;
    var in_11 = d11 < distance;
    var out_11 = !in_11;
    var in_10 = d10 < distance;
    var out_10 = !in_10;
    
    if(out_00 && in_01 && in_11 && in_10) {
        context.moveTo(j + grid_size * (1.0 - t10_00), i); // top
        context.lineTo(j, i + grid_size * t00_01);
    }            
    if(in_00 && out_01 && in_11 && in_10) {
        context.moveTo(j, i + grid_size * t00_01); // left
        context.lineTo(j + grid_size * t01_11, i + grid_size);
    }
    if(out_00 && out_01 && in_11 && in_10) {
        context.moveTo(j + grid_size * (1.0 - t10_00), i);
        context.lineTo(j + grid_size * t01_11, i + grid_size); // bottom
    }
    if(in_00 && in_01 && out_11 && in_10) {            
        context.moveTo(j + grid_size * t01_11, i + grid_size);
        context.lineTo(j + grid_size, i + grid_size * (1.0 - t11_10)); // right
    }
    if(out_00 && in_01 && out_11 && in_10) {  
        context.moveTo(j + grid_size * (1.0 - t10_00), i);
        context.lineTo(j + grid_size, i + grid_size * (1.0 - t11_10));
        context.moveTo(j, i + grid_size * t00_01);
        context.lineTo(j + grid_size * t01_11, i + grid_size);
    }
    if(in_00 && out_01 && out_11 && in_10) {  
        context.moveTo(j + grid_size, i + grid_size * (1.0 - t11_10));
        context.lineTo(j, i + grid_size * t00_01);
    }
    if(out_00 && out_01 && out_11 && in_10) {
        context.moveTo(j + grid_size, i + grid_size * (1.0 - t11_10));
        context.lineTo(j + grid_size * (1.0 - t10_00), i);
    }
    if(in_00 && in_01 && in_11 && out_10) {
        context.moveTo(j + grid_size * (1.0 - t10_00), i);
        context.lineTo(j + grid_size, i + grid_size * (1.0 - t11_10));
    }
    if(out_00 && in_01 && in_11 && out_10) {
        context.moveTo(j, i + grid_size * t00_01);
        context.lineTo(j + grid_size, i + grid_size * (1.0 - t11_10));
    }
    if(in_00 && out_01 && in_11 && out_10) {
        context.moveTo(j + grid_size, i + grid_size * (1.0 - t11_10));
        context.lineTo(j + grid_size * t01_11, i + grid_size);
        context.moveTo(j, i + grid_size * t00_01);
        context.lineTo(j + grid_size * (1.0 - t10_00), i);
    }
    if(out_00 && out_01 && in_11 && out_10) {
        context.moveTo(j + grid_size, i + grid_size * (1.0 - t11_10));
        context.lineTo(j + grid_size * t01_11, i + grid_size);
    }
    if(in_00 && in_01 && out_11 && out_10) {
        context.moveTo(j + grid_size * t01_11, i + grid_size);
        context.lineTo(j + grid_size * (1.0 - t10_00), i);
    }
    if(out_00 && in_01 && out_11 && out_10) {
        context.moveTo(j + grid_size * t01_11, i + grid_size);
        context.lineTo(j, i + grid_size * t00_01);
    }
    if(in_00 && out_01 && out_11 && out_10) {
        context.moveTo(j, i + grid_size * t00_01);
        context.lineTo(j + grid_size * (1.0 - t10_00), i);
    }
}

function draw_marching_cubes(context, d_f, do_interpolation, w, h, grid_size, distance) {
    context.beginPath();
    for(var i = 0; i <= h - grid_size; i += grid_size) {
        for(var j = 0; j <= w - grid_size; j += grid_size) {
            draw_one_cube(context, j, i, grid_size, d_f, distance, do_interpolation);
        }
    }
    context.strokeStyle = "#3333AA";
    context.lineWidth = 3;
    context.stroke();
    context.closePath(); 
    context.lineWidth = 1;
}

var do_contour = false;
function draw_contour() {
    var contour = document.getElementById("contour");
    var context = contour.getContext("2d");
    // background
    context.fillStyle="#eeeeee";
    context.fillRect(0, 0, w, h);
    context.font = "16px sans-serif";

    // circle function
    var distance_field = context.createImageData(w, h);
    for (var i = 0; i < distance_field.data.length; ++i)
        distance_field.data[i] = 0;
    for (var i = 0; i <= h; ++i)
        for (var j = 0; j <= w; ++j) {
            var d = Math.pow(Math.pow(i - h/2, 2) + Math.pow(j - w/2, 2), 0.5) - 160;
            if (Math.abs(d) < 1.4) {
                distance_field.data[(i*w + j) * 4 + 0] = 0xAA;
                distance_field.data[(i*w + j) * 4 + 1] = 0x55;
                distance_field.data[(i*w + j) * 4 + 2] = 0x55;
                distance_field.data[(i*w + j) * 4 + 3] = 0xFF;
            }
        }
    context.putImageData(distance_field, -0.5, -0.5);

    if(do_contour) {
        draw_marching_cubes(context, function (x, y) {
            return Math.pow(Math.pow(x - w/2, 2) + Math.pow(y - h/2, 2), 0.5);},
            true,
            w, h, 80, 160);
    }

    // grid
    const client_y_center = h /2 + 0.5;
    const client_x_center = w / 2 + 0.5;
    const x_min = -4;
    const x_max = +4;
    const y_min = -3;
    const y_max = +3;
    const client_x_step = w / (x_max - x_min);
    const client_y_step = h / (y_max - y_min);
    context.beginPath();
    context.moveTo(0, client_y_center);
    context.lineTo(w, client_y_center);
    context.lineTo(w - 12, client_y_center - 5);
    context.moveTo(w, client_y_center);
    context.lineTo(w - 12, client_y_center + 5);
    context.moveTo(client_x_center, h);
    context.lineTo(client_x_center, 0);
    context.lineTo(client_x_center - 5, 12);
    context.moveTo(client_x_center, 0);
    context.lineTo(client_x_center + 5, 12);
    context.fillStyle="#000000";
    for(var i = x_min + 1; i <= x_max - 1; i++){
        context.moveTo(client_x_center + i*client_x_step, client_y_center);
        context.lineTo(client_x_center + i*client_x_step, client_y_center - 5);
        context.fillText(i, client_x_center + i*client_x_step + 4, client_y_center + 16);
    }
    for(var i = y_min + 1; i <= y_max - 1; i++){
        context.moveTo(client_x_center, client_y_center - i*client_y_step);
        context.lineTo(client_x_center + 5, client_y_center - i*client_y_step);
        context.fillText(i, client_x_center + 5, client_y_center - i*client_y_step + 16);
    }
    context.strokeStyle="#000000";
    context.stroke();
    context.closePath();
}

function toggle_contour() {
    do_contour = !do_contour;
    draw_contour();
    var toggle_contour = document.getElementById("toggle_contour");
    if(do_contour)
        toggle_contour.innerHTML = "Undo contour";
    else
        toggle_contour.innerHTML = "Do contour";
}

function draw_grid_border(context, d_f, w, h, grid_size, distance) {
    context.beginPath();
    for(var i = 0.5; i <= h - grid_size; i += grid_size) {
        for(var j = 0.5; j <= w - grid_size; j += grid_size) {
            var do_horizontal = 
        (d_f(j + 0.5 * grid_size, i - 0.5 * grid_size) - distance ) *
        (d_f(j + 0.5 * grid_size, i + 0.5 * grid_size) - distance ) < 0 ? true : false;
            var do_vertical = 
        (d_f(j - 0.5 * grid_size, i + 0.5 * grid_size) - distance ) *
        (d_f(j + 0.5 * grid_size, i + 0.5 * grid_size) - distance ) < 0 ? true : false;
            if(do_horizontal) {
                context.moveTo(j, i);
                context.lineTo(j + grid_size, i);
            }
            if(do_vertical) {
                context.moveTo(j, i);
                context.lineTo(j, i + grid_size);                
            }            
        }
    }
    context.strokeStyle="#224477";
    context.lineWidth=3;
    context.stroke();
    context.closePath();
    context.lineWidth=1;
}

function draw_grid_border_contour() {
    var grid_border = document.getElementById("grid_border");
    var context = grid_border.getContext("2d");
    // background
    context.fillStyle="#eeeeee";
    context.fillRect(0, 0, w, h);
    context.font = "16px sans-serif";

    // circle function
    var distance_field = context.createImageData(w, h);
    for (var i = 0; i < distance_field.data.length; ++i)
        distance_field.data[i] = 0;
    for (var i = 0; i <= h; ++i)
        for (var j = 0; j <= w; ++j) {
            var d = Math.pow(Math.pow(i - h/2, 2) + Math.pow(j - w/2, 2), 0.5) - 160;
            if (Math.abs(d) < 1.4) {
                distance_field.data[(i*w + j) * 4 + 0] = 0xAA;
                distance_field.data[(i*w + j) * 4 + 1] = 0x55;
                distance_field.data[(i*w + j) * 4 + 2] = 0x55;
                distance_field.data[(i*w + j) * 4 + 3] = 0xFF;
            }
        }
    context.putImageData(distance_field, -0.5, -0.5);

    // grid
    const grid_size = 32;
    context.beginPath();
    for(var i = 0; i <= h; i += grid_size) {
        context.moveTo(0.0, i);
        context.lineTo(w, i);
    }
    for(var j = 0; j <= w; j += grid_size) {
        context.moveTo(j, 0.0);
        context.lineTo(j, h);
    }
    context.strokeStyle="#000000";
    context.lineWidth=1;
    context.stroke();
    context.closePath();
    
    draw_grid_border(context, function (x, y) {
            return Math.pow(Math.pow(x - w/2, 2) + Math.pow(y - h/2, 2), 0.5);},
            w, h, grid_size, 160);   
    }
    
function draw_marching_cubes_contour(element, do_interpolation) {
    var context = document.getElementById(element).getContext("2d");
    // background
    context.fillStyle="#eeeeee";
    context.fillRect(0, 0, w, h);
    context.font = "16px sans-serif";

    // circle function
    var distance_field = context.createImageData(w, h);
    for (var i = 0; i < distance_field.data.length; ++i)
        distance_field.data[i] = 0;
    for (var i = 0; i <= h; ++i)
        for (var j = 0; j <= w; ++j) {
            var d = Math.pow(Math.pow(i - h/2, 2) + Math.pow(j - w/2, 2), 0.5) - 160;
            if (Math.abs(d) < 1.4) {
                distance_field.data[(i*w + j) * 4 + 0] = 0xAA;
                distance_field.data[(i*w + j) * 4 + 1] = 0x55;
                distance_field.data[(i*w + j) * 4 + 2] = 0x55;
                distance_field.data[(i*w + j) * 4 + 3] = 0xFF;
            }
        }
    context.putImageData(distance_field, -0.5, -0.5);

    // grid
    const grid_size = 80;
    context.beginPath();
    for(var i = 0; i <= h; i += grid_size) {
        context.moveTo(0.0, i);
        context.lineTo(w, i);
    }
    for(var j = 0; j <= w; j += grid_size) {
        context.moveTo(j, 0.0);
        context.lineTo(j, h);
    }
    context.strokeStyle="#000000";
    context.lineWidth=1;
    context.stroke();
    context.closePath();
    
    draw_marching_cubes(context, 
            function (x, y) {return Math.pow(Math.pow(x - w/2, 2) + Math.pow(y - h/2, 2), 0.5);},
            do_interpolation,
            w, h, grid_size, 160);   
}
    
    
var marching_cube_signs = [[0, 1], [1, 1]];
var marching_cube_buttons_xy = [[[160, 80], [480, 80]], [[160, 400], [480, 400]]];
var marching_cube_buttons_r = 24.0;
function init_marching_cube_no_interpolation() {
    var marching_cube = document.getElementById("marching_cube_no_interpolation");
    draw_marching_cube("marching_cube_no_interpolation", false, 0, 0, false);

    marching_cube.addEventListener('mousemove', function(e) {
        var canvas_rect = marching_cube.getBoundingClientRect();
        var client_x = e.clientX - canvas_rect.left;
        var client_y = e.clientY - canvas_rect.top;
        draw_marching_cube("marching_cube_no_interpolation", false, client_x, client_y, true);
        draw_marching_cube("marching_cube_interpolation", true, client_x, client_y, true);
    }, false);
    
    marching_cube.addEventListener('mouseup', function(e) {
        var canvas_rect = marching_cube.getBoundingClientRect();
        var client_x = e.clientX - canvas_rect.left;
        var client_y = e.clientY - canvas_rect.top;
        for(var i = 0; i <= 1; ++i)
            for(var j = 0; j <= 1; ++j) {
                if(Math.pow(client_x - marching_cube_buttons_xy[i][j][0], 2) 
                 + Math.pow(client_y - marching_cube_buttons_xy[i][j][1], 2) 
                <= Math.pow(marching_cube_buttons_r, 2)) {
                    marching_cube_signs[i][j] = 1 - marching_cube_signs[i][j];
                }
            }
        draw_marching_cube("marching_cube_no_interpolation", false, client_x, client_y, true);
        draw_marching_cube("marching_cube_interpolation", true, client_x, client_y, true);
    }, false);
}

function init_marching_cube_interpolation() {
    var marching_cube = document.getElementById("marching_cube_interpolation");
    draw_marching_cube("marching_cube_interpolation", true, 0, 0, false);

    marching_cube.addEventListener('mousemove', function(e) {
        var canvas_rect = marching_cube.getBoundingClientRect();
        var client_x = e.clientX - canvas_rect.left;
        var client_y = e.clientY - canvas_rect.top;
        draw_marching_cube("marching_cube_interpolation", true, client_x, client_y, true);
        draw_marching_cube("marching_cube_no_interpolation", false, client_x, client_y, true);
    }, false);
    
    marching_cube.addEventListener('mouseup', function(e) {
        var canvas_rect = marching_cube.getBoundingClientRect();
        var client_x = e.clientX - canvas_rect.left;
        var client_y = e.clientY - canvas_rect.top;
        for(var i = 0; i <= 1; ++i)
            for(var j = 0; j <= 1; ++j) {
                if(Math.pow(client_x - marching_cube_buttons_xy[i][j][0], 2) 
                 + Math.pow(client_y - marching_cube_buttons_xy[i][j][1], 2) 
                <= Math.pow(marching_cube_buttons_r, 2)) {
                    marching_cube_signs[i][j] = 1 - marching_cube_signs[i][j];
                }
            }
        draw_marching_cube("marching_cube_interpolation", true, client_x, client_y, true);
        draw_marching_cube("marching_cube_no_interpolation", false, client_x, client_y, true);
    }, false);
}

function draw_marching_cube(element, do_interpolation, client_x, client_y, do_highlight) {
    var context = document.getElementById(element).getContext("2d");
    context.font = "16px sans-serif";
    context.textAlign = 'left';
    context.textBaseline = 'bottom';
    
    // function
    var signed_distance_function = function(x, y, d) {
        return Math.sqrt(x*x + y*y) - d;
    };
    
    var sample_function = function(x, y) {return signed_distance_function(x - w*0.5, y + h*0.6, 340);};
    
    if(marching_cube_signs[0][0] == 0 && marching_cube_signs[0][1] == 1 && marching_cube_signs[1][0] == 1 && marching_cube_signs[1][1] == 1) 
        sample_function = function(x, y) {return signed_distance_function(x - w*0.0, y + h*0.3, 340);};

    if(marching_cube_signs[0][0] == 1 && marching_cube_signs[0][1] == 0 && marching_cube_signs[1][0] == 1 && marching_cube_signs[1][1] == 1) 
        sample_function = function(x, y) {return signed_distance_function(x - w*0.9, y + h*0.1, 340);};

    if(marching_cube_signs[0][0] == 0 && marching_cube_signs[0][1] == 0 && marching_cube_signs[1][0] == 1 && marching_cube_signs[1][1] == 1) 
        sample_function = function(x, y) {return signed_distance_function(x - w*0.6, y + h*0.3, 440);};
    
    if(marching_cube_signs[0][0] == 1 && marching_cube_signs[0][1] == 1 && marching_cube_signs[1][0] == 0 && marching_cube_signs[1][1] == 1)     
        sample_function = function(x, y) {return signed_distance_function(x - w*0.1, y - h*1.1, 340);};
 
    if(marching_cube_signs[0][0] == 0 && marching_cube_signs[0][1] == 1 && marching_cube_signs[1][0] == 0 && marching_cube_signs[1][1] == 1)     
        sample_function = function(x, y) {return signed_distance_function(x - w*0.0, y - h*0.4, 380);};
        
    if(marching_cube_signs[0][0] == 1 && marching_cube_signs[0][1] == 0 && marching_cube_signs[1][0] == 0 && marching_cube_signs[1][1] == 1)
        sample_function = function(x, y) {return y < x ? signed_distance_function(x - w*1.0, y + h*0.1, 320)
                                                       : signed_distance_function(x - w*0.0, y - h*1.1, 320);};

    if(marching_cube_signs[0][0] == 0 && marching_cube_signs[0][1] == 0 && marching_cube_signs[1][0] == 0 && marching_cube_signs[1][1] == 1)
        sample_function = function(x, y) {return signed_distance_function(x - w*0.0, y + h*0.1, 540);};
        
    if(marching_cube_signs[0][0] == 1 && marching_cube_signs[0][1] == 1 && marching_cube_signs[1][0] == 1 && marching_cube_signs[1][1] == 0)        
        sample_function = function(x, y) {return signed_distance_function(x - w*1.0, y - h*1.1, 410);};
        
    if(marching_cube_signs[0][0] == 0 && marching_cube_signs[0][1] == 1 && marching_cube_signs[1][0] == 1 && marching_cube_signs[1][1] == 0)           
        sample_function = function(x, y) {return y < w-x ? signed_distance_function(x - w*0.0, y + h*0.2, 365)
                                                         : signed_distance_function(x - w*1.0, y - h*1.2, 365);};
                                                         
    if(marching_cube_signs[0][0] == 1 && marching_cube_signs[0][1] == 0 && marching_cube_signs[1][0] == 1 && marching_cube_signs[1][1] == 0)                                                           
        sample_function = function(x, y) {return signed_distance_function(x - w*1.0, y - h*0.6, 380);};
    
    if(marching_cube_signs[0][0] == 0 && marching_cube_signs[0][1] == 0 && marching_cube_signs[1][0] == 1 && marching_cube_signs[1][1] == 0)  
        sample_function = function(x, y) {return signed_distance_function(x - w*1.0, y + h*0.1, 540);};
    
    if(marching_cube_signs[0][0] == 1 && marching_cube_signs[0][1] == 1 && marching_cube_signs[1][0] == 0 && marching_cube_signs[1][1] == 0)  
        sample_function = function(x, y) {return signed_distance_function(x - w*0.4, y - h*1.3, 440);};
        
    if(marching_cube_signs[0][0] == 0 && marching_cube_signs[0][1] == 1 && marching_cube_signs[1][0] == 0 && marching_cube_signs[1][1] == 0)      
        sample_function = function(x, y) {return signed_distance_function(x - w*0.0, y - h*1.1, 540);};
        
    if(marching_cube_signs[0][0] == 1 && marching_cube_signs[0][1] == 0 && marching_cube_signs[1][0] == 0 && marching_cube_signs[1][1] == 0)          
        sample_function = function(x, y) {return signed_distance_function(x - w*1.0, y - h*1.1, 540);};
    
    if(marching_cube_signs[0][0] == 0 && marching_cube_signs[0][1] == 0 && marching_cube_signs[1][0] == 0 && marching_cube_signs[1][1] == 0)     
        sample_function = function(x, y) {return signed_distance_function(x - w*0.5, y - h*0.5, 340);};
        
    var sample_function_image = context.createImageData(w, h);
    for (var i = 0; i < sample_function_image.data.length; ++i)
        sample_function_image.data[i] = 0;
    for (var i = 0; i <= h; ++i)
        for (var j = 0; j <= w; ++j) {
            var d = sample_function(j, i);
            if (Math.abs(d) < 1.4) {
                sample_function_image.data[(i*w + j) * 4 + 0] = 0xAA;
                sample_function_image.data[(i*w + j) * 4 + 1] = 0x55;
                sample_function_image.data[(i*w + j) * 4 + 2] = 0x55;
                sample_function_image.data[(i*w + j) * 4 + 3] = 0xFF;
            }
        }
    context.putImageData(sample_function_image, -0.5, -0.5);
    
    // cell
    context.beginPath();
    context.moveTo(0.0, marching_cube_buttons_xy[0][0][1]);
    context.lineTo(w, marching_cube_buttons_xy[0][0][1]);
    context.moveTo(0.0, marching_cube_buttons_xy[1][0][1]);
    context.lineTo(w, marching_cube_buttons_xy[1][0][1]);
    
    context.moveTo(marching_cube_buttons_xy[0][0][0], 0.0);
    context.lineTo(marching_cube_buttons_xy[0][0][0], h);
    context.moveTo(marching_cube_buttons_xy[0][1][0], 0.0);
    context.lineTo(marching_cube_buttons_xy[0][1][0], h)
    
    context.strokeStyle="#000000";
    context.lineWidth=1;
    context.stroke();
    context.closePath();

    // draw the line segment(s)
    context.beginPath();
    var one_cube_size = marching_cube_buttons_xy[0][1][0] - marching_cube_buttons_xy[0][0][0];
    draw_one_cube(context, marching_cube_buttons_xy[0][0][0], marching_cube_buttons_xy[0][0][1], one_cube_size, sample_function, 0, do_interpolation);
    context.strokeStyle = "#3333AA";
    context.lineWidth = 3;
    context.stroke();
    context.closePath(); 
    context.lineWidth = 1;
    
    // signs
    for(var i = 0; i <= 1; ++i)
        for(var j = 0; j <= 1; ++j) {
            context.beginPath();
            context.arc(marching_cube_buttons_xy[i][j][0], marching_cube_buttons_xy[i][j][1], marching_cube_buttons_r, 0, 2*Math.PI);
            if(do_highlight && true && 
               Math.pow(client_x - marching_cube_buttons_xy[i][j][0], 2) 
             + Math.pow(client_y - marching_cube_buttons_xy[i][j][1], 2) 
            <= Math.pow(marching_cube_buttons_r, 2)) { // highlight
                if(marching_cube_signs[i][j] == 1) {
                    context.fillStyle="#ff0000";
                } else {
                    context.fillStyle="#0000ff";
                }
            } else {
                if(marching_cube_signs[i][j] == 1) {
                    context.fillStyle="#660000";
                } else {
                    context.fillStyle="#000066";
                }
            }
            context.closePath();
            context.fill();
        
            // minus
            context.fillStyle="#eeeeee";
            context.fillRect(marching_cube_buttons_xy[i][j][0] - 12, marching_cube_buttons_xy[i][j][1] - 2, 24, 4);
            // plus           
            if(marching_cube_signs[i][j] == 1) {
                context.fillRect(marching_cube_buttons_xy[i][j][0] - 2, marching_cube_buttons_xy[i][j][1] - 12, 4, 24);
            }
            if(do_interpolation) {
                context.fillStyle="#222222";
                context.fillText(
                    Math.floor(sample_function(marching_cube_buttons_xy[i][j][0], marching_cube_buttons_xy[i][j][1])), 
                    marching_cube_buttons_xy[i][j][0] + 24, 
                    marching_cube_buttons_xy[i][j][1] - 6);
            }
        }
}

// interactive
var metaballs = [[[150, 516], [150, 516]], [[206, 454], [219, 438]], [[322, 398], [315, 464]], [[497, 109], [497, 109]], [[461, 145], [461, 145]], [[491, 227], [506, 224]]];

function d_metaballs(x, y) {
    var d = 0;
    for (var i = 0; i < metaballs.length; ++i) {
        d += 1.0 / Math.sqrt((metaballs[i][1][0]-x)*(metaballs[i][1][0]-x) + (metaballs[i][1][1]-y)*(metaballs[i][1][1]-y));
    }
    return (1.0 / d) * Math.sqrt(metaballs.length);
}

function init_interactive_marching_cubes(){
    var canvas = document.getElementById("interactive_marching_cubes");
    canvas.addEventListener('mousedown', function(e){
        canvas_rect = canvas.getBoundingClientRect();
        metaballs.push([[e.clientX - canvas_rect.left, e.clientY - canvas_rect.top],[e.clientX - canvas_rect.left, e.clientY - canvas_rect.top]]);
    }, false);
     
    canvas.addEventListener('mousemove', function(e){
        if(e.buttons == 1){
            canvas_rect = canvas.getBoundingClientRect();
            metaballs[metaballs.length-1][1] = [e.clientX - canvas_rect.left, e.clientY - canvas_rect.top];
            draw_interactive_marching_cubes();
        }
    }, false);
    
    canvas.addEventListener('mouseup', function(e){
        canvas_rect = canvas.getBoundingClientRect();
        metaballs[metaballs.length-1][1] = [e.clientX - canvas_rect.left, e.clientY - canvas_rect.top];
        draw_interactive_marching_cubes();
    }, false);
    
    draw_interactive_marching_cubes();
}

function draw_interactive_marching_cubes(){
    var canvas = document.getElementById("interactive_marching_cubes");
    var context = canvas.getContext("2d");
    // background
    context.fillStyle="#eeeeee";
    context.fillRect(0, 0, w, h);

    var h = 640;
    var grid_size = 32;
    var distance = 64;
    
    // distance function
    var distance_field = context.createImageData(w, h);
    for (var i = 0; i < distance_field.data.length; ++i)
        distance_field.data[i] = 0;
    
    for (var i = 0; i <= h; i += 2.0)
        for (var j = 0; j <= w; j += 2.0) {
            d = d_metaballs(j, i);
            if (d <= distance) {
                distance_field.data[(i*w + j) * 4 + 0] = 0x55;
                distance_field.data[(i*w + j) * 4 + 1] = 0x55;
                distance_field.data[(i*w + j) * 4 + 2] = 0xAA;
                distance_field.data[(i*w + j) * 4 + 3] = 0xFF;
            }
        }
    context.putImageData(distance_field, -0.5, -0.5);
    
    // grid
    context.beginPath();
    for(var i = 0; i <= h; i += grid_size) {
        context.moveTo(0.0, i);
        context.lineTo(w, i);
    }
    for(var j = 0; j <= w; j += grid_size) {
        context.moveTo(j, 0.0);
        context.lineTo(j, h);
    }
    context.strokeStyle="#000000";
    context.lineWidth=1;
    context.stroke();
    context.closePath();
 
    draw_marching_cubes(context, d_metaballs, true, w, h, grid_size, distance);
}

function reset_all_metaballs() {
    metaballs = [];
    draw_interactive_marching_cubes();
}

function undo_last_metaball() {
    metaballs.splice(-1,1);
    draw_interactive_marching_cubes();
}


// not interactive
function draw_marching_cubes_square_contour() {
    var context = document.getElementById("marching_cubes_square").getContext("2d");
    // background
    context.fillStyle="#eeeeee";
    context.fillRect(0, 0, w, h);
    context.font = "16px sans-serif";

    // square function
    var d_f = function(x, y) {
        return Math.max(Math.abs(y - h/2) - 130, Math.abs(x - w/2) - 170); 
    }
    
    var distance_field = context.createImageData(w, h);
    for (var i = 0; i < distance_field.data.length; ++i)
        distance_field.data[i] = 0;
    for (var i = 0; i <= h; ++i)
        for (var j = 0; j <= w; ++j) {
            var d = d_f(j, i);
            if (Math.abs(d) < 1.4) {
                distance_field.data[(i*w + j) * 4 + 0] = 0xAA;
                distance_field.data[(i*w + j) * 4 + 1] = 0x55;
                distance_field.data[(i*w + j) * 4 + 2] = 0x55;
                distance_field.data[(i*w + j) * 4 + 3] = 0xFF;
            }
        }
    context.putImageData(distance_field, -0.5, -0.5);

    // grid
    const grid_size = 80;
    context.beginPath();
    for(var i = 0; i <= h; i += grid_size) {
        context.moveTo(0.0, i);
        context.lineTo(w, i);
    }
    for(var j = 0; j <= w; j += grid_size) {
        context.moveTo(j, 0.0);
        context.lineTo(j, h);
    }
    context.strokeStyle="#000000";
    context.lineWidth=1;
    context.stroke();
    context.closePath();
    
    draw_marching_cubes(context, 
            d_f,
            true,
            w, h, grid_size, 0);  
}

// dual contouring variant
function sign_change_in_cube(d_f, x, y, grid_size) {
    var signs = 0;
    if( d_f(x, y) > 0 )
        ++signs;
    if( d_f(x + grid_size, y) > 0 )
        ++signs;
    if( d_f(x + grid_size, y + grid_size) > 0 )
        ++signs;
    if( d_f(x, y + grid_size) > 0 )
        ++signs;        
    if (signs == 0 || signs == 4)
        return false;
    return true;
}

function optimum_in_cube_brute(d_f, x, y, grid_size, gradient_step) {
    // this is the optimizer alternative that you can use to craft your own optimum criteria
    var optimum = [0, 0];
    var optimum_value = Number.MAX_VALUE;
    for (var i = y; i < y + grid_size; i += gradient_step) {
        for (var j = x; j < x + grid_size; j += gradient_step) {
            var estimate = Math.pow(d_f(j, i), 2); // this puts the point on the contour
            estimate += 2.0 * Math.pow(d_f(j - gradient_step, i) - d_f(j + gradient_step, i), 2) + Math.pow(d_f(j, i - gradient_step) - d_f(j, i + gradient_step), 2); // this finds features
            estimate += 0.01 * (Math.pow(j - (x + grid_size / 2), 2) + Math.pow(i - (y + grid_size / 2), 2) ); // this drags the point to the cell's center if there are no better alternatives
            if (estimate < optimum_value) {
                optimum_value = estimate;
                optimum = [j, i];
            }
        }    
    }
    return optimum;
}

function draw_dual_contouring(context, d_f, j0, i0, w, h, grid_size) {
    context.beginPath();
    for(var i = i0; i <= h - grid_size; i += grid_size) {
        for(var j = j0; j <= w - grid_size; j += grid_size) {
            if(d_f(j, i) < 0 != d_f(j, i + grid_size) < 0) {
                var opt1 = optimum_in_cube_brute(d_f, j, i, grid_size, 1.0);
                var opt2 = optimum_in_cube_brute(d_f, j - grid_size, i, grid_size, 1.0);
                context.moveTo(opt1[0], opt1[1]);
                context.lineTo(opt2[0], opt2[1]);
            }
            if(d_f(j, i) < 0 != d_f(j + grid_size, i) < 0) {
                var opt1 = optimum_in_cube_brute(d_f, j, i ,grid_size, 1.0);
                var opt2 = optimum_in_cube_brute(d_f, j, i - grid_size, grid_size, 1.0);
                context.moveTo(opt1[0], opt1[1]);
                context.lineTo(opt2[0], opt2[1]);
            }
        }
    }
    context.strokeStyle="#338833";
    context.lineWidth=3;
    context.stroke();
    context.closePath();
}

var dual_cube_signs = [[0, 1], [1, 1]];
var dual_cube_buttons_xy = [[[160, 80], [480, 80]], [[160, 400], [480, 400]]];
var dual_cube_buttons_r = 24.0;
function init_dual_cube() {
    var dual_cube = document.getElementById("dual_cube");
    draw_dual_cube(0, 0, false);

    dual_cube.addEventListener('mousemove', function(e) {
        var canvas_rect = dual_cube.getBoundingClientRect();
        var client_x = e.clientX - canvas_rect.left;
        var client_y = e.clientY - canvas_rect.top;
        draw_dual_cube(client_x, client_y, true);
    }, false);
    
    dual_cube.addEventListener('mouseup', function(e) {
        var canvas_rect = dual_cube.getBoundingClientRect();
        var client_x = e.clientX - canvas_rect.left;
        var client_y = e.clientY - canvas_rect.top;
        for(var i = 0; i <= 1; ++i)
            for(var j = 0; j <= 1; ++j) {
                if(Math.pow(client_x - dual_cube_buttons_xy[i][j][0], 2) 
                 + Math.pow(client_y - dual_cube_buttons_xy[i][j][1], 2) 
                <= Math.pow(dual_cube_buttons_r, 2)) {
                    dual_cube_signs[i][j] = 1 - dual_cube_signs[i][j];
                }
            }
        draw_dual_cube(client_x, client_y, true);
    }, false);
}

function draw_dual_cube(client_x, client_y, do_highlight) {
    var context = document.getElementById("dual_cube").getContext("2d");
    context.font = "16px sans-serif";
    context.textAlign = 'left';
    context.textBaseline = 'bottom';
    
    // function
    var signed_distance_function = function(x, y, d) {
        return Math.sqrt(x*x + y*y) - d;
    };
    
    var sample_function = function(x, y) {return signed_distance_function(x - w*0.5, y + h*0.6, 340);};
    
    if(dual_cube_signs[0][0] == 0 && dual_cube_signs[0][1] == 1 && dual_cube_signs[1][0] == 1 && dual_cube_signs[1][1] == 1) 
        sample_function = function(x, y) {return signed_distance_function(x - w*0.0, y + h*0.3, 340);};

    if(dual_cube_signs[0][0] == 1 && dual_cube_signs[0][1] == 0 && dual_cube_signs[1][0] == 1 && dual_cube_signs[1][1] == 1) 
        sample_function = function(x, y) {return signed_distance_function(x - w*0.9, y + h*0.1, 340);};

    if(dual_cube_signs[0][0] == 0 && dual_cube_signs[0][1] == 0 && dual_cube_signs[1][0] == 1 && dual_cube_signs[1][1] == 1) 
        sample_function = function(x, y) {return signed_distance_function(x - w*0.6, y + h*0.3, 440);};
    
    if(dual_cube_signs[0][0] == 1 && dual_cube_signs[0][1] == 1 && dual_cube_signs[1][0] == 0 && dual_cube_signs[1][1] == 1)     
        sample_function = function(x, y) {return signed_distance_function(x - w*0.1, y - h*1.1, 340);};
 
    if(dual_cube_signs[0][0] == 0 && dual_cube_signs[0][1] == 1 && dual_cube_signs[1][0] == 0 && dual_cube_signs[1][1] == 1)     
        sample_function = function(x, y) {return signed_distance_function(x - w*0.0, y - h*0.4, 380);};
        
    if(dual_cube_signs[0][0] == 1 && dual_cube_signs[0][1] == 0 && dual_cube_signs[1][0] == 0 && dual_cube_signs[1][1] == 1)
        sample_function = function(x, y) {return y < x ? signed_distance_function(x - w*1.0, y + h*0.1, 320)
                                                       : signed_distance_function(x - w*0.0, y - h*1.1, 320);};

    if(dual_cube_signs[0][0] == 0 && dual_cube_signs[0][1] == 0 && dual_cube_signs[1][0] == 0 && dual_cube_signs[1][1] == 1)
        sample_function = function(x, y) {return signed_distance_function(x - w*0.0, y + h*0.1, 540);};
        
    if(dual_cube_signs[0][0] == 1 && dual_cube_signs[0][1] == 1 && dual_cube_signs[1][0] == 1 && dual_cube_signs[1][1] == 0)        
        sample_function = function(x, y) {return signed_distance_function(x - w*1.0, y - h*1.1, 410);};
        
    if(dual_cube_signs[0][0] == 0 && dual_cube_signs[0][1] == 1 && dual_cube_signs[1][0] == 1 && dual_cube_signs[1][1] == 0)           
        sample_function = function(x, y) {return y < w-x ? signed_distance_function(x - w*0.0, y + h*0.2, 365)
                                                         : signed_distance_function(x - w*1.0, y - h*1.2, 365);};
                                                         
    if(dual_cube_signs[0][0] == 1 && dual_cube_signs[0][1] == 0 && dual_cube_signs[1][0] == 1 && dual_cube_signs[1][1] == 0)                                                           
        sample_function = function(x, y) {return signed_distance_function(x - w*1.0, y - h*0.6, 380);};
    
    if(dual_cube_signs[0][0] == 0 && dual_cube_signs[0][1] == 0 && dual_cube_signs[1][0] == 1 && dual_cube_signs[1][1] == 0)  
        sample_function = function(x, y) {return signed_distance_function(x - w*1.0, y + h*0.1, 540);};
    
    if(dual_cube_signs[0][0] == 1 && dual_cube_signs[0][1] == 1 && dual_cube_signs[1][0] == 0 && dual_cube_signs[1][1] == 0)  
        sample_function = function(x, y) {return signed_distance_function(x - w*0.4, y - h*1.3, 440);};
        
    if(dual_cube_signs[0][0] == 0 && dual_cube_signs[0][1] == 1 && dual_cube_signs[1][0] == 0 && dual_cube_signs[1][1] == 0)      
        sample_function = function(x, y) {return signed_distance_function(x - w*0.0, y - h*1.1, 540);};
        
    if(dual_cube_signs[0][0] == 1 && dual_cube_signs[0][1] == 0 && dual_cube_signs[1][0] == 0 && dual_cube_signs[1][1] == 0)          
        sample_function = function(x, y) {return signed_distance_function(x - w*1.0, y - h*1.1, 540);};
    
    if(dual_cube_signs[0][0] == 0 && dual_cube_signs[0][1] == 0 && dual_cube_signs[1][0] == 0 && dual_cube_signs[1][1] == 0)     
        sample_function = function(x, y) {return signed_distance_function(x - w*0.5, y - h*0.5, 340);};
        
    var sample_function_image = context.createImageData(w, h);
    for (var i = 0; i < sample_function_image.data.length; ++i)
        sample_function_image.data[i] = 0;
    for (var i = 0; i <= h; ++i)
        for (var j = 0; j <= w; ++j) {
            var d = sample_function(j, i);
            if (Math.abs(d) < 1.4) {
                sample_function_image.data[(i*w + j) * 4 + 0] = 0xAA;
                sample_function_image.data[(i*w + j) * 4 + 1] = 0x55;
                sample_function_image.data[(i*w + j) * 4 + 2] = 0x55;
                sample_function_image.data[(i*w + j) * 4 + 3] = 0xFF;
            }
        }
    context.putImageData(sample_function_image, -0.5, -0.5);
    
    // cell
    context.beginPath();
    context.moveTo(0.0, dual_cube_buttons_xy[0][0][1]);
    context.lineTo(w, dual_cube_buttons_xy[0][0][1]);
    context.moveTo(0.0, dual_cube_buttons_xy[1][0][1]);
    context.lineTo(w, dual_cube_buttons_xy[1][0][1]);
    
    context.moveTo(dual_cube_buttons_xy[0][0][0], 0.0);
    context.lineTo(dual_cube_buttons_xy[0][0][0], h);
    context.moveTo(dual_cube_buttons_xy[0][1][0], 0.0);
    context.lineTo(dual_cube_buttons_xy[0][1][0], h)
    
    context.strokeStyle="#000000";
    context.lineWidth=1;
    context.stroke();
    context.closePath();

    // draw the line segment(s)
    var one_cube_size = dual_cube_buttons_xy[0][1][0] - dual_cube_buttons_xy[0][0][0];
    draw_dual_contouring(context, 
            sample_function,
            dual_cube_buttons_xy[0][0][0] - (dual_cube_buttons_xy[1][1][0] - dual_cube_buttons_xy[0][0][0]), 
            dual_cube_buttons_xy[0][0][1] - (dual_cube_buttons_xy[1][1][1] - dual_cube_buttons_xy[0][0][1]), 
            (dual_cube_buttons_xy[1][1][0] - dual_cube_buttons_xy[0][0][0]) * 3, 
            (dual_cube_buttons_xy[1][1][1] - dual_cube_buttons_xy[0][0][1]) * 3, 
            one_cube_size);
    
    // signs
    for(var i = 0; i <= 1; ++i)
        for(var j = 0; j <= 1; ++j) {
            context.beginPath();
            context.arc(dual_cube_buttons_xy[i][j][0], dual_cube_buttons_xy[i][j][1], dual_cube_buttons_r, 0, 2*Math.PI);
            if(do_highlight && true && 
               Math.pow(client_x - dual_cube_buttons_xy[i][j][0], 2) 
             + Math.pow(client_y - dual_cube_buttons_xy[i][j][1], 2) 
            <= Math.pow(dual_cube_buttons_r, 2)) { // highlight
                if(dual_cube_signs[i][j] == 1) {
                    context.fillStyle="#ff0000";
                } else {
                    context.fillStyle="#0000ff";
                }
            } else {
                if(dual_cube_signs[i][j] == 1) {
                    context.fillStyle="#660000";
                } else {
                    context.fillStyle="#000066";
                }
            }
            context.closePath();
            context.fill();
        
            // minus
            context.fillStyle="#eeeeee";
            context.fillRect(dual_cube_buttons_xy[i][j][0] - 12, dual_cube_buttons_xy[i][j][1] - 2, 24, 4);
            // plus           
            if(dual_cube_signs[i][j] == 1) {
                context.fillRect(dual_cube_buttons_xy[i][j][0] - 2, dual_cube_buttons_xy[i][j][1] - 12, 4, 24);
            }
            context.fillStyle="#222222";
            context.fillText(
                Math.floor(sample_function(dual_cube_buttons_xy[i][j][0], dual_cube_buttons_xy[i][j][1])), 
                dual_cube_buttons_xy[i][j][0] + 24, 
                dual_cube_buttons_xy[i][j][1] - 6);
        }
}

function draw_dual_square_contour() {
    var context = document.getElementById("dual_square").getContext("2d");
    // background
    context.fillStyle="#eeeeee";
    context.fillRect(0, 0, w, h);
    context.font = "16px sans-serif";

    // square function
    var d_f = function(x, y) {
        return Math.max(Math.abs(y - h/2) - 130, Math.abs(x - w/2) - 170); 
    }
    
    var distance_field = context.createImageData(w, h);
    for (var i = 0; i < distance_field.data.length; ++i)
        distance_field.data[i] = 0;
    for (var i = 0; i <= h; ++i)
        for (var j = 0; j <= w; ++j) {
            var d = d_f(j, i);
            if (Math.abs(d) < 1.4) {
                distance_field.data[(i*w + j) * 4 + 0] = 0xAA;
                distance_field.data[(i*w + j) * 4 + 1] = 0x55;
                distance_field.data[(i*w + j) * 4 + 2] = 0x55;
                distance_field.data[(i*w + j) * 4 + 3] = 0xFF;
            }
        }
    context.putImageData(distance_field, -0.5, -0.5);

    // grid
    const grid_size = 80;
    context.beginPath();
    for(var i = 0; i <= h; i += grid_size) {
        context.moveTo(0.0, i);
        context.lineTo(w, i);
    }
    for(var j = 0; j <= w; j += grid_size) {
        context.moveTo(j, 0.0);
        context.lineTo(j, h);
    }
    context.strokeStyle="#000000";
    context.lineWidth=1;
    context.stroke();
    context.closePath();
    
    draw_dual_contouring(context, 
            d_f,
            0, 0, w, h, grid_size);
}

// interactive
var lines = [[[92, 169], [542, 313]], [[432, 96], [166, 492]]];

function dot(a1, a2, b1, b2) {
    return a1 * b1 + a2 * b2; 
}

function distance_to_segment(lp1x, lp1y, lp2x, lp2y, px, py) {
    var t_proj = dot(px - lp1x, py - lp1y, lp2x - lp1x, lp2y - lp1y) / dot(lp2x - lp1x, lp2y - lp1y, lp2x - lp1x, lp2y - lp1y);
    if (isNaN(t_proj))
        t_proj = 0.0;
    else if (t_proj < 0.0)
        t_proj = 0.0;
    else if (t_proj > 1.0)
        t_proj = 1.0;
    var p_proj_x = lp1x + (lp2x - lp1x) * t_proj;
    var p_proj_y = lp1y + (lp2y - lp1y) * t_proj;
    return Math.sqrt(dot(p_proj_x - px, p_proj_y - py, p_proj_x - px, p_proj_y - py));
}

function distance_to_line_segment(line, px, py) {
    return distance_to_segment(line[0][0], line[0][1], line[1][0], line[1][1], px, py);
}

function d_lines(x, y) {
    var d = Number.MAX_VALUE; // everything is out
    for (var i = 0; i < lines.length; ++i) {
        var di = distance_to_line_segment(lines[i], x, y);
        if (di < d)
            d = di;
    }
    return d - 64;
}

function init_interactive_dual_contouring(){
    var canvas = document.getElementById("interactive_dual_contouring");
    canvas.addEventListener('mousedown', function(e){
        canvas_rect = canvas.getBoundingClientRect();
        lines.push([[e.clientX - canvas_rect.left, e.clientY - canvas_rect.top],[e.clientX - canvas_rect.left, e.clientY - canvas_rect.top]]);
    }, false);
     
    canvas.addEventListener('mousemove', function(e){
        if(e.buttons == 1){
            canvas_rect = canvas.getBoundingClientRect();
            lines[lines.length-1][1] = [e.clientX - canvas_rect.left, e.clientY - canvas_rect.top];
            draw_interactive_dual_contouring();
        }
    }, false);
    
    canvas.addEventListener('mouseup', function(e){
        canvas_rect = canvas.getBoundingClientRect();
        lines[lines.length-1][1] = [e.clientX - canvas_rect.left, e.clientY - canvas_rect.top];
        draw_interactive_dual_contouring();
    }, false);
    
    draw_interactive_dual_contouring();
}

function draw_interactive_dual_contouring(){
    var canvas = document.getElementById("interactive_dual_contouring");
    var context = canvas.getContext("2d");
    // background
    context.fillStyle="#eeeeee";
    context.fillRect(0, 0, w, h);

    var h = 640;
    var grid_size = 32;
    
    // distance function
    var distance_field = context.createImageData(w, h);
    for (var i = 0; i < distance_field.data.length; ++i)
        distance_field.data[i] = 0;
    
    for (var i = 0; i <= h; i += 2.0)
        for (var j = 0; j <= w; j += 2.0) {
            d = d_lines(j, i);
            if (d <= 0) {
                distance_field.data[(i*w + j) * 4 + 0] = 0x55;
                distance_field.data[(i*w + j) * 4 + 1] = 0x55;
                distance_field.data[(i*w + j) * 4 + 2] = 0xAA;
                distance_field.data[(i*w + j) * 4 + 3] = 0xFF;
            }
        }
    context.putImageData(distance_field, -0.5, -0.5);
    
    // grid
    context.beginPath();
    for(var i = 0; i <= h; i += grid_size) {
        context.moveTo(0.0, i);
        context.lineTo(w, i);
    }
    for(var j = 0; j <= w; j += grid_size) {
        context.moveTo(j, 0.0);
        context.lineTo(j, h);
    }
    context.strokeStyle="#000000";
    context.lineWidth=1;
    context.stroke();
    context.closePath();
 
    draw_dual_contouring(context, 
        d_lines,
        0, 0, w, h, grid_size);
}

function reset_all_lines() {
    lines = [];
    draw_interactive_dual_contouring();
}

function undo_last_line() {
    lines.splice(-1,1);
    draw_interactive_dual_contouring();
}
    </script>
  </head>
  <body>
    <center>
    <h1>
Marching cubes and dual contouring contouring
    </h1>
    <p>
This is a basic introduction into the marching cubes and the dual contouring techniques. They are mostly known as 3D mesh generating algorithms but since it's hard to explain 3D things using 2D display, we will concentrate on planar analogue of the mesh generation which itself is called contouring.
    </p>
    <p>
The second “contouring” in the title is not a mistake.
    </p>
       
    <h2>
What is contouring?
    </h2>
    <p>
Let's say we have a function.
    </p>
    <p class="formula">
x<sup>2</sup> + y<sup>2</sup> = 4
    </p>
    <p>
This function represents a circle. Now let's say we don't want a perfect circle, but its contour, — a set of line segments that represent the circle within some tolerable error.  
    </p>
    <canvas id="contour" width=640 height=480></canvas>
    <div style="text-align:right; width:640px; padding-bottom:12pt;">
        <button type="button" id="toggle_contour" onclick="toggle_contour()">Do contour</button>
    </div>
    <script language="JavaScript">
    draw_contour();
    </script>
    <p>
We can then do things with the contour that would be tricky to do with the circle itself. Like intersecting it with a square or storing it in the same structure as other contours regardless of their original nature. 
    </p>
    <p>
Conceptually, contouring is very easy. Let's rewrite our function:
    </p>
    <p class="formula">
F(x, y) = x<sup>2</sup> + y<sup>2</sup> - 4
    </p>
    <p>
Now we cover some part of a plane with a grid. For every two adjacent cells we can add their common border as a contour line segment if the function <i>F(x,y)</i> changes sign between these two cell's centers.
    </p>
    <canvas id="grid_border" width=640 height=480></canvas>
    <script language="JavaScript">
    draw_grid_border_contour();
    </script>
    <p>
Well, technically it does represent the curve. And the error is predictable, it doesn't exceed half of the cell's diagonal. But this contour has way too many corners as for a circle.
    </p>
    <p>
We need something better.
    </p>
    <h2>
Marching cubes    
    </h2>

    <p>
What if we add line segments that go across the cells? we can measure a function sign in four corners of a square, and add line segments accordingly. There are 4 squares, 2 signs, there are only 16 combinations of sign change possible
    </p>
    <canvas id="marching_cube_no_interpolation" width=640 height=480></canvas>
    <script language="JavaScript">
    init_marching_cube_no_interpolation();
    </script>
    <p>
...
    </p>
    <canvas id="marching_cubes_no_interpolation" width=640 height=480></canvas>
    <script language="JavaScript">
    draw_marching_cubes_contour("marching_cubes_no_interpolation", false);
    </script>
    <p>
...    
    </p>
    <canvas id="marching_cube_interpolation" width=640 height=480></canvas>
    <script language="JavaScript">
    init_marching_cube_interpolation();
    </script>
    <p>
...
    </p>
    <canvas id="marching_cubes_interpolation" width=640 height=480></canvas>
    <script language="JavaScript">
    draw_marching_cubes_contour("marching_cubes_interpolation", true);
    </script>
    <p>
...
    </p>
    <canvas id="interactive_marching_cubes" width=640 height=640></canvas>
    <script language="JavaScript">
    init_interactive_marching_cubes();
    </script>
    <div style="text-align:right; width:640px; padding-bottom:12pt;">
        <button type="button" style="width: 108pt;" onclick="undo_last_metaball()">Undo last</button>
        <button type="button" style="width: 108pt;" onclick="reset_all_metaballs()">Reset all</button>
    </div>
    <p>
...
    </p>   
    <canvas id="marching_cubes_square" width=640 height=480></canvas>
    <script language="JavaScript">
    draw_marching_cubes_square_contour();
    </script>    
    <h2>
Dual contouring
    </h2>
    <p>
...
    </p>
    <canvas id="dual_cube" width=640 height=480></canvas>
    <script language="JavaScript">
    init_dual_cube();
    </script>    
    <p>
...
    </p>
    <canvas id="dual_square" width=640 height=480></canvas>
    <script language="JavaScript">
    draw_dual_square_contour();
    </script>     
    <p>
...    
    </p>
    <p>
...
    </p>
    <canvas id="interactive_dual_contouring" width=640 height=640></canvas>
    <script language="JavaScript">
    init_interactive_dual_contouring();
    </script>
    <div style="text-align:right; width:640px; padding-bottom:12pt;">
        <button type="button" style="width: 108pt;" onclick="undo_last_line()">Undo last</button>
        <button type="button" style="width: 108pt;" onclick="reset_all_lines()">Reset all</button>
    </div>
    

    <table class="footer" style="width: 555pt; padding: 64pt 0pt 32pt 0pt; background-color: transparent; font-family: sans-serif; font-size: 16pt; font-style: normal;">
    <tr>
    <td class="footer" style="vertical-align: middle; text-align: left; width: 64px; padding: 0; margin: 0; border: 0;">
        <a href="index.html"><img src="favicon.ico"></a> 
    </td>
    <td class="footer" style="vertical-align: middle; text-align: left; width: 200pt; padding: 0; margin: 0; border: 0;">
        &nbsp;&larr; there's more.
    </td>
    <td class="footer" style="vertical-align: middle; text-align: right; width: 300pt; padding: 0; margin: 0; border: 0;">
        + 
        <a href="https://github.com/akalenuk/wordsandbuttons">Github</a> & 
        <a href="https://twitter.com/wordsandbuttons">Twitter</a> & 
        <a href="https://news.ycombinator.com/from?site=wordsandbuttons.online">Hacker News</a>
    </td>
    </tr>
    </table>
    </center>
  </body>
</html>
