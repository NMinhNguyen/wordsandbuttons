<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Yet another floating point tutorial</title>
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
    <style>
body{
    margin: 0 0 0 0;
}

a{
    text-decoration: none;
}

h1 {
    padding-top: 32pt;
    font-size: 24pt;
    width: 600pt;
    text-align: left;
}

h2 {
    padding-top: 16pt;
    font-size: 20pt;
    width: 555pt;
    text-align: left;
}

p {
    font-size: 16pt;
    width: 505pt;
    text-align: left;
}

.comment {
    font-size: 12pt;
    text-align:center;
    font-family: sans-serif;
    padding-bottom: 24pt;
}

.formula {
    font-family: sans-serif;
    font-size: 15pt;
    font-style: italic;
    text-align: center;
    padding-top: 6pt;
    padding-bottom: 6pt;
}

.footer {
    margin-top: 64pt;
    padding-bottom: 32pt;
    font-family: sans-serif;
    font-size: 16pt;
    text-align: left;
}

table {
    font-family: sans-serif;
    font-size: 13pt;
    font-style: italic;
    width: 505pt;
    text-align: center;
}

th {
    vertical-align: text-top;
    padding-top: 6pt;
    padding-bottom: 6pt;
    font-style: bold;
}

td {
    vertical-align: text-top;
    padding-top: 6pt;
    padding-bottom: 6pt;
}

form {
    margin: 0 0 0 0;
    padding-top: 12pt;
    padding-left: 12pt;
    padding-right: 12pt;
    padding-bottom: 12pt;
    font-size: 16pt;
    text-align: left;
    width: 505pt;
    background-color: #eeee99;
}

input[type="text"] {
    width: 32pt;
    height: 22pt;
    font-size: 16pt;
    text-align: center;
}

button {
    width: 32pt;
    height: 26pt;
    font-size: 16pt;
    text-align: center;
}

pre {
    font-style: normal;
    text-align: left;
    font-size: 16pt;
}
    </style>
    <script language="JavaScript">
const w = 640;
const h = 200;    
const cell_width = 64;    
const cell_height = 64;
const cell_y = 20;
    
// integer point
integer_cell_xs = [20, 20 + 90 + 43, 20 + 90*2 + 43 + 11, 20 + 90*3 + 43 + 11*2, 20 + 90*4 + 43 + 11*3, 20 + 90*5 + 43 + 11*4];
integer_cell_colors = ["#dba0ac", "#cfa0db", "#cfa0db", "#cfa0db", "#cfa0db", "#cfa0db"];
integer_cell_bits = [0, 0, 0, 1, 1, 0];

function init_integer() {
    var integer = document.getElementById("integer");
    integer_draw();
    
    integer.addEventListener('click', function(e){
        var canvas_rect = integer.getBoundingClientRect();
        var x = e.clientX - canvas_rect.left;
        var y = e.clientY - canvas_rect.top;
        for(var i = 0; i < integer_cell_xs.length; ++i) {
            if (x > integer_cell_xs[i] && x < integer_cell_xs[i] + cell_width && y > cell_y && y < cell_y + cell_height)
                integer_cell_bits[i] = 1 - integer_cell_bits[i];
        }
        integer_draw();
    }, false);
}

function integer_draw() {
    var integer = document.getElementById("integer");
    var integer_context = integer.getContext("2d");

    // background
    integer_context.fillStyle="#dbd5a0";
    integer_context.fillRect(0, 0, w, h);
    
    // cells
    for(var i = 0; i < integer_cell_xs.length; ++i) {
        integer_context.fillStyle = integer_cell_colors[i];
        integer_context.fillRect(integer_cell_xs[i], cell_y, cell_width, cell_height);
        
        integer_context.textAlign = "center";
        integer_context.textBaseline = "middle"; 
        integer_context.font = "48px sans-serif";
        integer_context.fillStyle = "#222222";        
        integer_context.fillText(integer_cell_bits[i], integer_cell_xs[i] + cell_width / 2.0, cell_y + cell_height / 2.0 + 4);
    }
    
    // the number
    var sign = integer_cell_bits[0] ? -1.0 : 1.0;    
    var n = integer_cell_bits[5] + 2*integer_cell_bits[4] + 4*integer_cell_bits[3] + 8*integer_cell_bits[2] + 16*integer_cell_bits[1];
    if(sign == -1.0)
      n = 32 - n;
    
    // comment
    integer_context.fillStyle = "#914853"
    integer_context.textAlign = "left";
    integer_context.textBaseline = "alphabetic"; 
    integer_context.font = "20px sans-serif";
    integer_context.fillText(sign == -1.0 ? "Negative number" : "Positive number", 20, 120);
    integer_context.fillText("which is " + sign * n + ".", 20, 170);
    
    integer_context.fillStyle = "#673670";
    integer_context.fillText("of " + n + " things,", 20, 145);
}

// fixed point
fixed_cell_xs = [20, 20 + 90 + 43, 20 + 90*2 + 43, 20 + 90*3 + 43, 20 + 90*4 + 43*2, 20 + 90*5 + 43*2];
fixed_cell_colors = ["#dba0ac", "#cfa0db", "#cfa0db", "#cfa0db", "#cfa0db", "#cfa0db"];
fixed_cell_bits = [0, 0, 0, 1, 1, 0];

function init_fixed() {
    var fixed = document.getElementById("fixed");
    fixed_draw();
    
    fixed.addEventListener('click', function(e){
        var canvas_rect = fixed.getBoundingClientRect();
        var x = e.clientX - canvas_rect.left;
        var y = e.clientY - canvas_rect.top;
        for(var i = 0; i < fixed_cell_xs.length; ++i) {
            if (x > fixed_cell_xs[i] && x < fixed_cell_xs[i] + cell_width && y > cell_y && y < cell_y + cell_height)
                fixed_cell_bits[i] = 1 - fixed_cell_bits[i];
        }
        fixed_draw();
    }, false);
}

function fixed_draw() {
    var fixed = document.getElementById("fixed");
    var fixed_context = fixed.getContext("2d");

    // background
    fixed_context.fillStyle="#dbd5a0";
    fixed_context.fillRect(0, 0, w, h);
    
    // cells
    for(var i = 0; i < fixed_cell_xs.length; ++i) {
        fixed_context.fillStyle = fixed_cell_colors[i];
        fixed_context.fillRect(fixed_cell_xs[i], cell_y, cell_width, cell_height);
        
        fixed_context.textAlign = "center";
        fixed_context.textBaseline = "middle"; 
        fixed_context.font = "48px sans-serif";
        fixed_context.fillStyle = "#222222";        
        fixed_context.fillText(fixed_cell_bits[i], fixed_cell_xs[i] + cell_width / 2.0, cell_y + cell_height / 2.0 + 4);
    }
    
    // the number
    var sign = fixed_cell_bits[0] ? -1.0 : 1.0;    
    var n = fixed_cell_bits[5] + 2*fixed_cell_bits[4] + 4*fixed_cell_bits[3] + 8*fixed_cell_bits[2] + 16*fixed_cell_bits[1];
    if(sign == -1.0)
        n = 32 - n;
    
    // explicit point
    fixed_context.fillStyle = "#597052";
    fixed_context.fillText(".", 430, cell_y + cell_height / 2.0 + 4);
    
    // comment
    fixed_context.fillStyle = "#914853"
    fixed_context.textAlign = "left";
    fixed_context.textBaseline = "alphabetic"; 
    fixed_context.font = "20px sans-serif";
    fixed_context.fillText(sign == -1.0 ? "Negative number" : "Positive number", 20, 120);

    fixed_context.fillStyle = "#673670"
    fixed_context.fillText("of " + n + " quarters,", 20, 145);
    fixed_context.fillText("which is " + sign * (n / 4.0).toFixed(2) + " in real numbers.", 20, 170);
}

// floating point
floating_cell_xs = [20, 20 + 90 + 43 - 32, 20 + 90*2 + 43 - 32, 20 + 90*3 + 43 - 32, 20 + 90*4 + 43*2, 20 + 90*5 + 43*2];
floating_cell_colors = ["#dba0ac", "#acdba0", "#acdba0", "#acdba0", "#cfa0db", "#cfa0db"];
floating_cell_bits = [0, 0, 0, 1, 1, 0];

function init_floating() {
    var floating = document.getElementById("floating");
    floating_draw();
    
    floating.addEventListener('click', function(e){
        var canvas_rect = floating.getBoundingClientRect();
        var x = e.clientX - canvas_rect.left;
        var y = e.clientY - canvas_rect.top;
        for(var i = 0; i < floating_cell_xs.length; ++i) {
            if (x > floating_cell_xs[i] && x < floating_cell_xs[i] + cell_width && y > cell_y && y < cell_y + cell_height)
                floating_cell_bits[i] = 1 - floating_cell_bits[i];
        }
        floating_draw();
    }, false);
}

function floating_draw() {
    var floating = document.getElementById("floating");
    var floating_context = floating.getContext("2d");

    // background
    floating_context.fillStyle="#dbd5a0";
    floating_context.fillRect(0, 0, w, h);
    
    // cells
    for(var i = 0; i < floating_cell_xs.length; ++i) {
        floating_context.fillStyle = floating_cell_colors[i];
        floating_context.fillRect(floating_cell_xs[i], cell_y, cell_width, cell_height);
        
        floating_context.textAlign = "center";
        floating_context.textBaseline = "middle"; 
        floating_context.font = "48px sans-serif";
        floating_context.fillStyle = "#222222";        
        floating_context.fillText(floating_cell_bits[i], floating_cell_xs[i] + cell_width / 2.0, cell_y + cell_height / 2.0 + 4);
    }
    
    // the number
    var sign = floating_cell_bits[0] ? -1.0 : 1.0;
    var e = floating_cell_bits[3] + floating_cell_bits[2] * 2 + floating_cell_bits[1] * 4;
    var n = floating_cell_bits[5] + floating_cell_bits[4] * 2 + ((e != 0 && e != 7) ? 4 : 0);
    
    // explicit point
    if (e != 0 && e != 7) {
        floating_context.fillStyle = "#673670";
        floating_context.fillText("1", 420, cell_y + cell_height / 2.0 + 4);    
    }
    
    // comment
    floating_context.textAlign = "left";
    floating_context.textBaseline = "alphabetic"; 
    floating_context.font = "20px sans-serif";
            
    if( e == 7 ) {
        if ( n == 0 ) {
            floating_context.fillStyle = "#914853";
            floating_context.fillText(sign == -1.0 ? "Negative" : "Positive", 20, 120);
            floating_context.fillStyle = "#673670";
            floating_context.fillText("infinite number.", 20, 145);
        } else {
            floating_context.fillStyle = "#673670";
            floating_context.fillText("Not a number.", 20, 120);
        }
    } else {
        floating_context.fillStyle = "#914853";
        floating_context.fillText(sign == -1.0 ? "Negative number" : "Positive number", 20, 120);
        
        floating_context.fillStyle = "#673670"
        floating_context.fillText("of " + n, 20, 145);
        floating_context.fillStyle = "#597052";
        var measures = "quarters,";
        if(e == 2)
            measures = "halves,";
        if(e == 3)
            measures = "wholes,";
        if(e == 4)
            measures = "pairs,";
        if(e == 5)
            measures = "four-packs,";
        if(e == 6)
            measures = "eight-packs,";
        floating_context.fillText(measures, 64, 145);
        
        floating_context.fillStyle = "#673670"
        floating_context.fillText("which is " + sign * (n * Math.pow(2, e - 2 - (e > 0 ? 1 : 0))).toFixed(2) + " in real numbers", 20, 170);
    }
}


var number_as_string = "";
function instrumental_error_draw() {
    var instrumental_error = document.getElementById("instrumental_error");
    var context = instrumental_error.getContext("2d");
    
    context.fillStyle="#cedecc";
    context.fillRect(0, 0, 300, 48);
    
    context.fillStyle = "#220000";
    context.textAlign = "left";
    context.textBaseline = "alphabetic"; 
    context.font = "20px sans-serif";
    context.fillText(number_as_string, 20, 20);
}


function number_clear() {
    number_as_string = "";
    instrumental_error_draw();
}

function number_backspace() {
    number_as_string = number_as_string.substr(0, number_as_string.length - 1);
    instrumental_error_draw();
}

function number_add(digit) {
    number_as_string += digit;
    instrumental_error_draw();
}

function number_invert_sign() {
    if(number_as_string.length == 0)
        return;
    if(number_as_string[0] == '-')
        number_as_string = number_as_string.substr(1, number_as_string.length - 1);
    else 
        number_as_string = '-' + number_as_string;
    instrumental_error_draw();
}

function number_place_point() {
    number_as_string = number_as_string.split('.').join('') + '.';
    instrumental_error_draw();
}
    </script>
  </head>
  <body>
    <center>
    <h1>
Yet another floating point tutorial
    </h1>
    <p>
...
    </p>

    <h2>
6-bit integer number
    </h2>
    <p class="formula">
<br>    
1000 mm = 100 cm = 1 m
<br><br>
    </p>
    <canvas id="integer" width=640 height=200></canvas>
    <script language="JavaScript">
        init_integer();
    </script>
    
    <table>
    <tr><td><b>Unsigned 1-digit decimal</b></td><td><b>Signed 1-digit decimal<b></td></tr>
    <tr><td>0</td><td>0</td></tr>
    <tr><td>1</td><td>1</td></tr>
    <tr><td>2</td><td>2</td></tr>
    <tr><td>3</td><td>3</td></tr>
    <tr><td>4</td><td>4</td></tr>
    <tr><td>5</td><td><b>-5</b></td></tr>
    <tr><td>6</td><td>-4</td></tr>
    <tr><td>7</td><td>-3</td></tr>
    <tr><td>8</td><td>-2</td></tr>
    <tr><td>9</td><td>-1</td></tr>
    </table>

    <table>
    <tr>
    <td style="border: 1px solid black;">
    <pre>
  uint16_t a = 50'000;
  uint16_t b = 50'000;
  uint64_t c = a*b;
  std::cout &lt;&lt; c &lt;&lt; "\n";</pre>
    </td>
    </tr>
    </table>

    <p>
18446744071914584320
    </p>

    <h2>
6-bit fixed point number
    </h2>
    <p class="formula">
    <br>    
    $ <b>9.<sup>99</sup></b>
    <br><br>
    <b>1'050</b> mm
    <br><br>
    </p>
    <canvas id="fixed" width=640 height=200></canvas>
    <script language="JavaScript">
        init_fixed();
    </script>
    <p>
...
    </p>

    <h2>
6-bit floating point number
    </h2>
    <p class="formula">
    <br>
    N<sub>A</sub>: <b>6.0221367e+23</b> particles/mol 
    <br><br>
    m<sub>e</sub>: <b>9.1093897e-31</b> kg 
    <br><br>
    </p>
    <canvas id="floating" width=640 height=200></canvas>
    <script language="JavaScript">
        init_floating();
    </script>    
    <br><br>
    <table>
    <tr><th>Binary</th><th>Fixed point</th><th>Floating point</th></tr> 
    <tr><td>000001</td><td>0.25</td><td>0.25</td></tr>
    <tr><td>000010</td><td>0.50</td><td>0.5</td></tr>
    <tr><td>000011</td><td>0.75</td><td>0.75</td></tr>
    <tr><td>000100</td><td>1.00</td><td>1</td></tr>
    <tr><td>000101</td><td>1.25</td><td>1.25</td></tr>
    <tr><td>000110</td><td>1.50</td><td>1.5</td></tr>
    <tr><td>000111</td><td>1.75</td><td>1.75</td></tr>
    <tr><td>001000</td><td>2.00</td><td>2</td></tr>
    <tr><td>001001</td><td>2.25</td><td>2.5</td></tr>
    <tr><td>001010</td><td>2.50</td><td>3</td></tr>
    <tr><td>001011</td><td>2.75</td><td>3.5</td></tr>
    <tr><td>001100</td><td>3.00</td><td>4</td></tr>
    <tr><td>001101</td><td>3.25</td><td>5</td></tr>
    <tr><td>001110</td><td>3.50</td><td>6</td></tr>
    <tr><td>001111</td><td>3.75</td><td>7</td></tr>
    <tr><td>010000</td><td>4.00</td><td>8</td></tr>
    <tr><td>010001</td><td>4.25</td><td>10</td></tr>
    <tr><td>010010</td><td>4.50</td><td>12</td></tr>
    <tr><td>010011</td><td>4.75</td><td>14</td></tr>
    <tr><td>010100</td><td>5.00</td><td>16</td></tr>
    <tr><td>010101</td><td>5.25</td><td>20</td></tr>
    <tr><td>010110</td><td>5.50</td><td>24</td></tr>
    <tr><td>010111</td><td>5.75</td><td>28</td></tr>
    <tr><td>011000</td><td>6.00</td><td>32</td></tr>
    <tr><td>011001</td><td>6.25</td><td>40</td></tr>
    <tr><td>011010</td><td>6.50</td><td>48</td></tr>    
    <tr><td>011011</td><td>6.75</td><td>56</td></tr>
    <tr><td>011100</td><td>7.00</td><td>positive infinite</td></tr>
    <tr><td>011101</td><td>7.25</td><td>not a number</td></tr>
    <tr><td>011110</td><td>7.50</td><td>not a number</td></tr>
    <tr><td>011111</td><td>7.75</td><td>not a number</td></tr>
    </table>
    
    <h2>
    Instrumental error
    </h2>
    <form>
    <table>
    <tr>
    <td align="right">
    <button type="button" id="button_clear" onclick="number_clear();" >C</button>
    <button type="button" id="button_backspace" onclick="number_backspace();">&larr;</button>
    <button type="button" id="button_7" onclick="number_add('7');">7</button>
    <button type="button" id="button_8" onclick="number_add('8');">8</button>
    <button type="button" id="button_9" onclick="number_add('9');">9</button>
    <br>
    <button type="button" id="button_4" onclick="number_add('4');">4</button>
    <button type="button" id="button_5" onclick="number_add('5');">5</button>
    <button type="button" id="button_6" onclick="number_add('6');">6</button>
    <br>
    <button type="button" id="button_1" onclick="number_add('1');">1</button>
    <button type="button" id="button_2" onclick="number_add('2');">2</button>
    <button type="button" id="button_3" onclick="number_add('3');">3</button>
    <br>
    <button type="button" id="button_minus" onclick="number_invert_sign();">-</button>
    <button type="button" id="button_0" onclick="number_add('0');">0</button>
    <button type="button" id="button_dot" onclick="number_place_point();">.</button>
    </td>
    <td>
    <canvas id="instrumental_error" width=300 height=48></canvas>
    </td>
    </tr>
    </table>    
    </form>
    
    <script language="JavaScript">
        instrumental_error_draw();
    </script>  
    

    <table class="footer" style="width: 555pt; padding: 64pt 0pt 32pt 0pt; background-color: transparent; font-family: sans-serif; font-size: 16pt; font-style: normal;">
    <tr>
    <td class="footer" style="vertical-align: middle; text-align: left; width: 64px; padding: 0; margin: 0; border: 0;">
        <a href="index.html"><img src="favicon.ico"></a>
    </td>
    <td class="footer" style="vertical-align: middle; text-align: left; width: 200pt; padding: 0; margin: 0; border: 0;">
        &nbsp;&larr; there's more.
    </td>
    <td class="footer" style="vertical-align: middle; text-align: right; width: 300pt; padding: 0; margin: 0; border: 0;">
        +
        <a href="https://github.com/akalenuk/wordsandbuttons">Github</a> &
        <a href="https://twitter.com/wordsandbuttons">Twitter</a> &
        <a href="https://news.ycombinator.com/from?site=wordsandbuttons.online">Hacker News</a>
    </td>
    </tr>
    </table>
    </center>
  </body>
</html>
