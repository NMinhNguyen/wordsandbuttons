<HTML> 
<HEAD> 
    <TITLE>Quadratic splines demo</TITLE> 
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html;charset=UTF-8"> 
    <META HTTP-EQUIV="KEYWORDS" CONTENT="canvas testing"> 
    <LINK REV="MAIL:" HREF="mailto:akalenuk@gmail.com"> 
</HEAD> 
<BODY topmargin=0 leftmargin=0 marginwidth=0 marginheight=0> 
    <canvas id='teca' width=1024 height=768 style="float: left;"></canvas> 
    <script language="JavaScript"> 
    <!--	

	var magic_number = 2;

	var pattern_x= new Array(312,712,712,312);
	var pattern_y= new Array(184,184,584,584);

	var Xs = new Array(512,512);
	var Ys = new Array(512,512);

	var _turns=1;
	var _100500=500;

	rebuild_arrays();
	function rebuild_arrays(){
		Xs = new Array(Xs[0], Xs[1]);
		Ys = new Array(Ys[0], Ys[1]);
		for(var i=0;i<_turns;i++){
			for(var j=0; j<pattern_x.length; j++){
				Xs[Xs.length]=pattern_x[j];
				Ys[Ys.length]=pattern_y[j];
			}
		}
	}

	var T=0;
	var nT=0;
	var ax,bx,cx,ay,by,cy;
	var d_x=0;
	var d_y=0;
	var ox=Xs[0];
	var oy=Ys[0];

	var point_to_change=0;

	var teca = document.getElementById("teca");
	var teca_context = teca.getContext("2d");      

	draw();
	function draw(){
		teca_context.fillStyle="#eeeeee";
		teca_context.fillRect(0,0,1024,768);
	 	teca_context.beginPath();
		for(var i=0; i<Xs.length; i++){
		        teca_context.moveTo(Xs[i],Ys[i]);
		        teca_context.lineTo(Xs[i]+3,Ys[i]+3);
		        teca_context.moveTo(Xs[i],Ys[i]);
		        teca_context.lineTo(Xs[i]-3,Ys[i]+3);
		        teca_context.moveTo(Xs[i],Ys[i]);
		        teca_context.lineTo(Xs[i]-3,Ys[i]-3);
		        teca_context.moveTo(Xs[i],Ys[i]);
		        teca_context.lineTo(Xs[i]+3,Ys[i]-3);
		}
	        teca_context.strokeStyle="#000000";
	        teca_context.stroke();

	 	teca_context.beginPath();
		for(var i=0; i<_100500; i++){
			T=i/_100500*(Xs.length-1);
			if(T>=nT){
				cx=Xs[nT];
				bx=d_x;
				ax=Xs[nT+1]-cx-bx;
				cy=Ys[nT];
				by=d_y;
				ay=Ys[nT+1]-cy-by;
				nT++;			
			}
			var t01=T-(nT-1);
			var x=ax*t01*t01+bx*t01+cx;
			var y=ay*t01*t01+by*t01+cy;
		        teca_context.moveTo(ox,oy);
		        teca_context.lineTo(x, y);

			var l=(1+(magic_number-1)*Math.pow((1-t01),magic_number));
			d_x=(2*ax*t01+bx)/magic_number;
			d_y=(2*ay*t01+by)/magic_number;
		        teca_context.lineTo(x+d_y*l/2, y+d_x*l/2);
			ox=x;
			oy=y;
		}
	        teca_context.strokeStyle="#222222";
	        teca_context.stroke();
	}

        teca.addEventListener('mousedown', function(e){
		pattern_x[point_to_change%pattern_x.length]=e.clientX;
		pattern_y[point_to_change%pattern_x.length]=e.clientY;
		point_to_change++;
		rebuild_arrays();
		start_from(e.clientX, e.clientY);
	}, false);


        teca.addEventListener('mousemove', function(e){
		start_from(e.clientX, e.clientY);
	}, false);


	function start_from(x,y){
  		Xs[1]=Xs[0]=x;
		Ys[1]=Ys[0]=y;
		d_x=0;
		d_y=0;
		ox=Xs[0];
		oy=Ys[0];
		nT=0;
        	draw();
	}
    // -->
    </script>  
</BODY> 